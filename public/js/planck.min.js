/*
 * Planck.js v0.1.37
 * 
 * Copyright (c) 2016-2018 Ali Shakiba http://shakiba.me/planck.js
 * Copyright (c) 2006-2013 Erin Catto  http://www.gphysics.com
 * 
 * This software is provided 'as-is', without any express or implied
 * warranty.  In no event will the authors be held liable for any damages
 * arising from the use of this software.
 * 
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 * 
 * 1. The origin of this software must not be misrepresented; you must not
 * claim that you wrote the original software. If you use this software
 * in a product, an acknowledgment in the product documentation would be
 * appreciated but is not required.
 * 2. Altered source versions must be plainly marked as such, and must not be
 * misrepresented as being the original software.
 * 3. This notice may not be removed or altered from any source distribution.
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.planck=t()}}(function(){return function n(r,m,a){function h(e,t){if(!m[e]){if(!r[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(c)return c(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var s=m[e]={exports:{}};r[e][0].call(s.exports,function(t){var i=r[e][1][t];return h(i||t)},s,s.exports,n,r,m,a)}return m[e].exports}for(var c="function"==typeof require&&require,t=0;t<a.length;t++)h(a[t]);return h}({1:[function(t,i,e){e.internal={},e.Math=t("./common/Math"),e.Vec2=t("./common/Vec2"),e.Transform=t("./common/Transform"),e.Rot=t("./common/Rot"),e.AABB=t("./collision/AABB"),e.Shape=t("./Shape"),e.Fixture=t("./Fixture"),e.Body=t("./Body"),e.Contact=t("./Contact"),e.Joint=t("./Joint"),e.World=t("./World"),e.Circle=t("./shape/CircleShape"),e.Edge=t("./shape/EdgeShape"),e.Polygon=t("./shape/PolygonShape"),e.Chain=t("./shape/ChainShape"),e.Box=t("./shape/BoxShape"),t("./shape/CollideCircle"),t("./shape/CollideEdgeCircle"),e.internal.CollidePolygons=t("./shape/CollidePolygon"),t("./shape/CollideCirclePolygone"),t("./shape/CollideEdgePolygon"),e.DistanceJoint=t("./joint/DistanceJoint"),e.FrictionJoint=t("./joint/FrictionJoint"),e.GearJoint=t("./joint/GearJoint"),e.MotorJoint=t("./joint/MotorJoint"),e.MouseJoint=t("./joint/MouseJoint"),e.PrismaticJoint=t("./joint/PrismaticJoint"),e.PulleyJoint=t("./joint/PulleyJoint"),e.RevoluteJoint=t("./joint/RevoluteJoint"),e.RopeJoint=t("./joint/RopeJoint"),e.WeldJoint=t("./joint/WeldJoint"),e.WheelJoint=t("./joint/WheelJoint"),e.internal.Sweep=t("./common/Sweep"),e.internal.stats=t("./common/stats"),e.internal.Manifold=t("./Manifold"),e.internal.Distance=t("./collision/Distance"),e.internal.TimeOfImpact=t("./collision/TimeOfImpact"),e.internal.DynamicTree=t("./collision/DynamicTree"),e.internal.Settings=t("./Settings")},{"./Body":2,"./Contact":3,"./Fixture":4,"./Joint":5,"./Manifold":6,"./Settings":7,"./Shape":8,"./World":10,"./collision/AABB":11,"./collision/Distance":13,"./collision/DynamicTree":14,"./collision/TimeOfImpact":15,"./common/Math":18,"./common/Rot":20,"./common/Sweep":21,"./common/Transform":22,"./common/Vec2":23,"./common/stats":26,"./joint/DistanceJoint":27,"./joint/FrictionJoint":28,"./joint/GearJoint":29,"./joint/MotorJoint":30,"./joint/MouseJoint":31,"./joint/PrismaticJoint":32,"./joint/PulleyJoint":33,"./joint/RevoluteJoint":34,"./joint/RopeJoint":35,"./joint/WeldJoint":36,"./joint/WheelJoint":37,"./shape/BoxShape":38,"./shape/ChainShape":39,"./shape/CircleShape":40,"./shape/CollideCircle":41,"./shape/CollideCirclePolygone":42,"./shape/CollideEdgeCircle":43,"./shape/CollideEdgePolygon":44,"./shape/CollidePolygon":45,"./shape/EdgeShape":46,"./shape/PolygonShape":47}],2:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===a)var a=!1;i.exports=x;var h=t("./util/common"),s=t("./util/options"),n=t("./common/Vec2"),r=t("./common/Rot"),m=t("./common/Math"),c=t("./common/Sweep"),_=t("./common/Transform"),l=t("./common/Velocity"),u=t("./common/Position"),p=t("./Fixture"),d=(t("./Shape"),t("./World"),x.STATIC="static"),y=x.KINEMATIC="kinematic",v=x.DYNAMIC="dynamic",f={type:d,position:n.zero(),angle:0,linearVelocity:n.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};function x(t,i){i=s(i,f),a&&h.assert(n.isValid(i.position)),a&&h.assert(n.isValid(i.linearVelocity)),a&&h.assert(m.isFinite(i.angle)),a&&h.assert(m.isFinite(i.angularVelocity)),a&&h.assert(m.isFinite(i.angularDamping)&&0<=i.angularDamping),a&&h.assert(m.isFinite(i.linearDamping)&&0<=i.linearDamping),this.m_world=t,this.m_awakeFlag=i.awake,this.m_autoSleepFlag=i.allowSleep,this.m_bulletFlag=i.bullet,this.m_fixedRotationFlag=i.fixedRotation,this.m_activeFlag=i.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=i.userData,this.m_type=i.type,this.m_type==v?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=_.identity(),this.m_xf.p=n.clone(i.position),this.m_xf.q.setAngle(i.angle),this.m_sweep=new c,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new l,this.c_position=new u,this.m_force=n.zero(),this.m_torque=0,this.m_linearVelocity=n.clone(i.linearVelocity),this.m_angularVelocity=i.angularVelocity,this.m_linearDamping=i.linearDamping,this.m_angularDamping=i.angularDamping,this.m_gravityScale=i.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null}function g(){this.mass=0,this.center=n.zero(),this.I=0}x.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},x.prototype.getWorld=function(){return this.m_world},x.prototype.getNext=function(){return this.m_next},x.prototype.setUserData=function(t){this.m_userData=t},x.prototype.getUserData=function(){return this.m_userData},x.prototype.getFixtureList=function(){return this.m_fixtureList},x.prototype.getJointList=function(){return this.m_jointList},x.prototype.getContactList=function(){return this.m_contactList},x.prototype.isStatic=function(){return this.m_type==d},x.prototype.isDynamic=function(){return this.m_type==v},x.prototype.isKinematic=function(){return this.m_type==y},x.prototype.setStatic=function(){return this.setType(d),this},x.prototype.setDynamic=function(){return this.setType(v),this},x.prototype.setKinematic=function(){return this.setType(y),this},x.prototype.getType=function(){return this.m_type},x.prototype.setType=function(t){if(a&&h.assert(t===d||t===y||t===v),a&&h.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==d&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var i=this.m_contactList;i;){var e=i;i=i.next,this.m_world.destroyContact(e.contact)}this.m_contactList=null;for(var o=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var n=s.m_proxyCount,r=0;r<n;++r)o.touchProxy(s.m_proxies[r].proxyId)}},x.prototype.isBullet=function(){return this.m_bulletFlag},x.prototype.setBullet=function(t){this.m_bulletFlag=!!t},x.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},x.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)},x.prototype.isAwake=function(){return this.m_awakeFlag},x.prototype.setAwake=function(t){t?0==this.m_awakeFlag&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},x.prototype.isActive=function(){return this.m_activeFlag},x.prototype.setActive=function(t){if(a&&h.assert(0==this.isWorldLocked()),t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag)for(var i=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.createProxies(i,this.m_xf);else{for(i=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.destroyProxies(i);for(var o=this.m_contactList;o;){var s=o;o=o.next,this.m_world.destroyContact(s.contact)}this.m_contactList=null}},x.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},x.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},x.prototype.getTransform=function(){return this.m_xf},x.prototype.setTransform=function(t,i){if(a&&h.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()){this.m_xf.set(t,i),this.m_sweep.setTransform(this.m_xf);for(var e=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.synchronize(e,this.m_xf,this.m_xf)}},x.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},x.prototype.synchronizeFixtures=function(){var t=_.identity();this.m_sweep.getTransform(t,0);for(var i=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(i,t,this.m_xf)},x.prototype.advance=function(t){this.m_sweep.advance(t),this.m_sweep.c.set(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},x.prototype.getPosition=function(){return this.m_xf.p},x.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},x.prototype.getAngle=function(){return this.m_sweep.a},x.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},x.prototype.getWorldCenter=function(){return this.m_sweep.c},x.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},x.prototype.getLinearVelocity=function(){return this.m_linearVelocity},x.prototype.getLinearVelocityFromWorldPoint=function(t){var i=n.sub(t,this.m_sweep.c);return n.add(this.m_linearVelocity,n.cross(this.m_angularVelocity,i))},x.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},x.prototype.setLinearVelocity=function(t){this.m_type!=d&&(0<n.dot(t,t)&&this.setAwake(!0),this.m_linearVelocity.set(t))},x.prototype.getAngularVelocity=function(){return this.m_angularVelocity},x.prototype.setAngularVelocity=function(t){this.m_type!=d&&(0<t*t&&this.setAwake(!0),this.m_angularVelocity=t)},x.prototype.getLinearDamping=function(){return this.m_linearDamping},x.prototype.setLinearDamping=function(t){this.m_linearDamping=t},x.prototype.getAngularDamping=function(){return this.m_angularDamping},x.prototype.setAngularDamping=function(t){this.m_angularDamping=t},x.prototype.getGravityScale=function(){return this.m_gravityScale},x.prototype.setGravityScale=function(t){this.m_gravityScale=t},x.prototype.getMass=function(){return this.m_mass},x.prototype.getInertia=function(){return this.m_I+this.m_mass*n.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},x.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.set(this.m_sweep.localCenter)},x.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic())return this.m_sweep.c0.set(this.m_xf.p),this.m_sweep.c.set(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);a&&h.assert(this.isDynamic());for(var t=n.zero(),i=this.m_fixtureList;i;i=i.m_next)if(0!=i.m_density){var e=new g;i.getMassData(e),this.m_mass+=e.mass,t.wAdd(e.mass,e.center),this.m_I+=e.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,t.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*n.dot(t,t),a&&h.assert(0<this.m_I),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var o=n.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t,this.m_xf),this.m_linearVelocity.add(n.cross(this.m_angularVelocity,n.sub(this.m_sweep.c,o)))},x.prototype.setMassData=function(t){if(a&&h.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()&&this.m_type==v){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<t.I&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*n.dot(t.center,t.center),a&&h.assert(0<this.m_I),this.m_invI=1/this.m_I);var i=n.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t.center,this.m_xf),this.m_linearVelocity.add(n.cross(this.m_angularVelocity,n.sub(this.m_sweep.c,i)))}},x.prototype.applyForce=function(t,i,e){this.m_type==v&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=n.cross(n.sub(i,this.m_sweep.c),t)))},x.prototype.applyForceToCenter=function(t,i){this.m_type==v&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},x.prototype.applyTorque=function(t,i){this.m_type==v&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},x.prototype.applyLinearImpulse=function(t,i,e){this.m_type==v&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.wAdd(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*n.cross(n.sub(i,this.m_sweep.c),t)))},x.prototype.applyAngularImpulse=function(t,i){this.m_type==v&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},x.prototype.shouldCollide=function(t){if(this.m_type!=v&&t.m_type!=v)return!1;for(var i=this.m_jointList;i;i=i.next)if(i.other==t&&0==i.joint.m_collideConnected)return!1;return!0},x.prototype.createFixture=function(t,i){if(a&&h.assert(0==this.isWorldLocked()),1==this.isWorldLocked())return null;var e=new p(this,t,i);if(this.m_activeFlag){var o=this.m_world.m_broadPhase;e.createProxies(o,this.m_xf)}return e.m_next=this.m_fixtureList,0<(this.m_fixtureList=e).m_density&&this.resetMassData(),this.m_world.m_newFixture=!0,e},x.prototype.destroyFixture=function(t){if(a&&h.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()){a&&h.assert(t.m_body==this);for(var i=this.m_fixtureList,e=!1;null!=i;){if(i==t){i=t.m_next,e=!0;break}i=i.m_next}a&&h.assert(e);for(var o=this.m_contactList;o;){var s=o.contact;o=o.next;var n=s.getFixtureA(),r=s.getFixtureB();t!=n&&t!=r||this.m_world.destroyContact(s)}if(this.m_activeFlag){var m=this.m_world.m_broadPhase;t.destroyProxies(m)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},x.prototype.getWorldPoint=function(t){return _.mul(this.m_xf,t)},x.prototype.getWorldVector=function(t){return r.mul(this.m_xf.q,t)},x.prototype.getLocalPoint=function(t){return _.mulT(this.m_xf,t)},x.prototype.getLocalVector=function(t){return r.mulT(this.m_xf.q,t)}},{"./Fixture":4,"./Shape":8,"./World":10,"./common/Math":18,"./common/Position":19,"./common/Rot":20,"./common/Sweep":21,"./common/Transform":22,"./common/Vec2":23,"./common/Velocity":25,"./util/common":50,"./util/options":52}],3:[function(t,i,e){if(void 0===K)var K=!1;if(void 0===G)var G=!1;var U=t("./util/common"),O=t("./common/Math"),X=t("./common/Vec2"),Q=t("./common/Transform"),R=t("./common/Mat22"),$=t("./common/Rot"),tt=t("./Settings"),N=t("./Manifold"),v=t("./collision/Distance");function n(t){this.contact=t,this.prev,this.next,this.other}function c(t,i,e,o,s){this.m_nodeA=new n(this),this.m_nodeB=new n(this),this.m_fixtureA=t,this.m_fixtureB=e,this.m_indexA=i,this.m_indexB=o,this.m_evaluateFcn=s,this.m_manifold=new N,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=r(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=m(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.v_points=[],this.v_normal=X.zero(),this.v_normalMass=new R,this.v_K=new R,this.v_pointCount,this.v_tangentSpeed,this.v_friction,this.v_restitution,this.v_invMassA,this.v_invMassB,this.v_invIA,this.v_invIB,this.p_localPoints=[],this.p_localNormal=X.zero(),this.p_localPoint=X.zero(),this.p_localCenterA=X.zero(),this.p_localCenterB=X.zero(),this.p_type,this.p_radiusA,this.p_radiusB,this.p_pointCount,this.p_invMassA,this.p_invMassB,this.p_invIA,this.p_invIB}function l(){this.rA=X.zero(),this.rB=X.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function r(t,i){return O.sqrt(t*i)}function m(t,i){return i<t?t:i}(i.exports=c).prototype.initConstraint=function(t){var i=this.m_fixtureA,e=this.m_fixtureB,o=i.getShape(),s=e.getShape(),n=i.getBody(),r=e.getBody(),m=this.getManifold(),a=m.pointCount;G&&U.assert(0<a),this.v_invMassA=n.m_invMass,this.v_invMassB=r.m_invMass,this.v_invIA=n.m_invI,this.v_invIB=r.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=a,K&&U.debug("pc",this.v_pointCount,a),this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=n.m_invMass,this.p_invMassB=r.m_invMass,this.p_invIA=n.m_invI,this.p_invIB=r.m_invI,this.p_localCenterA=X.clone(n.m_sweep.localCenter),this.p_localCenterB=X.clone(r.m_sweep.localCenter),this.p_radiusA=o.m_radius,this.p_radiusB=s.m_radius,this.p_type=m.type,this.p_localNormal=X.clone(m.localNormal),this.p_localPoint=X.clone(m.localPoint),this.p_pointCount=a;for(var h=0;h<a;++h){var c=m.points[h],_=this.v_points[h]=new l;t.warmStarting?(_.normalImpulse=t.dtRatio*c.normalImpulse,_.tangentImpulse=t.dtRatio*c.tangentImpulse):(_.normalImpulse=0,_.tangentImpulse=0),_.rA.setZero(),_.rB.setZero(),_.normalMass=0,_.tangentMass=0,_.velocityBias=0,this.p_localPoints[h]=X.clone(c.localPoint)}},c.prototype.getManifold=function(){return this.m_manifold},c.prototype.getWorldManifold=function(t){var i=this.m_fixtureA.getBody(),e=this.m_fixtureB.getBody(),o=this.m_fixtureA.getShape(),s=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(t,i.getTransform(),o.m_radius,e.getTransform(),s.m_radius)},c.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},c.prototype.isEnabled=function(){return this.m_enabledFlag},c.prototype.isTouching=function(){return this.m_touchingFlag},c.prototype.getNext=function(){return this.m_next},c.prototype.getFixtureA=function(){return this.m_fixtureA},c.prototype.getFixtureB=function(){return this.m_fixtureB},c.prototype.getChildIndexA=function(){return this.m_indexA},c.prototype.getChildIndexB=function(){return this.m_indexB},c.prototype.flagForFiltering=function(){this.m_filterFlag=!0},c.prototype.setFriction=function(t){this.m_friction=t},c.prototype.getFriction=function(){return this.m_friction},c.prototype.resetFriction=function(){this.m_friction=r(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},c.prototype.setRestitution=function(t){this.m_restitution=t},c.prototype.getRestitution=function(){return this.m_restitution},c.prototype.resetRestitution=function(){this.m_restitution=m(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},c.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},c.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},c.prototype.evaluate=function(t,i,e){this.m_evaluateFcn(t,i,this.m_fixtureA,this.m_indexA,e,this.m_fixtureB,this.m_indexB)},c.prototype.update=function(t){var i=!(this.m_enabledFlag=!0),e=this.m_touchingFlag,o=this.m_fixtureA.isSensor(),s=this.m_fixtureB.isSensor(),n=o||s,r=this.m_fixtureA.getBody(),m=this.m_fixtureB.getBody(),a=r.getTransform(),h=m.getTransform();if(n){var c=this.m_fixtureA.getShape(),_=this.m_fixtureB.getShape();i=v.testOverlap(c,this.m_indexA,_,this.m_indexB,a,h),this.m_manifold.pointCount=0}else{var l=this.m_manifold;this.m_manifold=new N,this.evaluate(this.m_manifold,a,h),i=0<this.m_manifold.pointCount;for(var u=0;u<this.m_manifold.pointCount;++u){var p=this.m_manifold.points[u];p.normalImpulse=0;for(var d=p.tangentImpulse=0;d<l.pointCount;++d){var y=l.points[d];if(y.id.key==p.id.key){p.normalImpulse=y.normalImpulse,p.tangentImpulse=y.tangentImpulse;break}}}i!=e&&(r.setAwake(!0),m.setAwake(!0))}this.m_touchingFlag=i,0==e&&1==i&&t&&t.beginContact(this),1==e&&0==i&&t&&t.endContact(this),0==n&&i&&t&&t.preSolve(this,l)},c.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,!1)},c.prototype.solvePositionConstraintTOI=function(t,i,e){return this._solvePositionConstraint(t,!0,i,e)},c.prototype._solvePositionConstraint=function(t,i,e,o){var s=this.m_fixtureA,n=this.m_fixtureB,r=s.getBody(),m=n.getBody(),a=(r.c_velocity,m.c_velocity,r.c_position),h=m.c_position,c=X.clone(this.p_localCenterA),_=X.clone(this.p_localCenterB),l=0,u=0;i&&r!=e&&r!=o||(l=this.p_invMassA,u=this.p_invIA);var p=0,d=0;i&&m!=e&&m!=o||(p=this.p_invMassB,d=this.p_invIB);for(var y=X.clone(a.c),v=a.a,f=X.clone(h.c),x=h.a,g=0,A=0;A<this.p_pointCount;++A){var b,B,w,S=Q.identity(),C=Q.identity();switch(S.q.set(v),C.q.set(x),S.p=X.sub(y,$.mul(S.q,c)),C.p=X.sub(f,$.mul(C.q,_)),this.p_type){case N.e_circles:var M=Q.mul(S,this.p_localPoint),I=Q.mul(C,this.p_localPoints[0]);(b=X.sub(I,M)).normalize(),B=X.wAdd(.5,M,.5,I),w=X.dot(X.sub(I,M),b)-this.p_radiusA-this.p_radiusB;break;case N.e_faceA:b=$.mul(S.q,this.p_localNormal);var P=Q.mul(S,this.p_localPoint),T=Q.mul(C,this.p_localPoints[A]);w=X.dot(X.sub(T,P),b)-this.p_radiusA-this.p_radiusB,B=T;break;case N.e_faceB:b=$.mul(C.q,this.p_localNormal);P=Q.mul(C,this.p_localPoint),T=Q.mul(S,this.p_localPoints[A]);w=X.dot(X.sub(T,P),b)-this.p_radiusA-this.p_radiusB,B=T,b.mul(-1)}var V=X.sub(B,y),z=X.sub(B,f);g=O.min(g,w);var L=i?tt.toiBaugarte:tt.baumgarte,F=tt.linearSlop,q=tt.maxLinearCorrection,k=O.clamp(L*(w+F),-q,0),D=X.cross(V,b),R=X.cross(z,b),E=l+p+u*D*D+d*R*R,j=0<E?-k/E:0,J=X.mul(j,b);y.wSub(l,J),v-=u*X.cross(V,J),f.wAdd(p,J),x+=d*X.cross(z,J)}return a.c.set(y),a.a=v,h.c.set(f),h.a=x,g},c.prototype.initVelocityConstraint=function(t){var i=this.m_fixtureA,e=this.m_fixtureB,o=i.getBody(),s=e.getBody(),n=o.c_velocity,r=s.c_velocity,m=o.c_position,a=s.c_position,h=this.p_radiusA,c=this.p_radiusB,_=this.getManifold(),l=this.v_invMassA,u=this.v_invMassB,p=this.v_invIA,d=this.v_invIB,y=X.clone(this.p_localCenterA),v=X.clone(this.p_localCenterB),f=X.clone(m.c),x=m.a,g=X.clone(n.v),A=n.w,b=X.clone(a.c),B=a.a,w=X.clone(r.v),S=r.w;G&&U.assert(0<_.pointCount);var C=Q.identity(),M=Q.identity();C.q.set(x),M.q.set(B),C.p.wSet(1,f,-1,$.mul(C.q,y)),M.p.wSet(1,b,-1,$.mul(M.q,v));var I=_.getWorldManifold(null,C,h,M,c);this.v_normal.set(I.normal);for(var P=0;P<this.v_pointCount;++P){var T=this.v_points[P];T.rA.set(X.sub(I.points[P],f)),T.rB.set(X.sub(I.points[P],b)),K&&U.debug("vcp.rA",I.points[P].x,I.points[P].y,f.x,f.y,T.rA.x,T.rA.y);var V=X.cross(T.rA,this.v_normal),z=X.cross(T.rB,this.v_normal),L=l+u+p*V*V+d*z*z;T.normalMass=0<L?1/L:0;var F=X.cross(this.v_normal,1),q=X.cross(T.rA,F),k=X.cross(T.rB,F),D=l+u+p*q*q+d*k*k;T.tangentMass=0<D?1/D:0,T.velocityBias=0;var R=X.dot(this.v_normal,w)+X.dot(this.v_normal,X.cross(S,T.rB))-X.dot(this.v_normal,g)-X.dot(this.v_normal,X.cross(A,T.rA));R<-tt.velocityThreshold&&(T.velocityBias=-this.v_restitution*R)}if(2==this.v_pointCount&&t.blockSolve){var E=this.v_points[0],j=this.v_points[1],J=X.cross(E.rA,this.v_normal),O=X.cross(E.rB,this.v_normal),N=X.cross(j.rA,this.v_normal),Y=X.cross(j.rB,this.v_normal),W=l+u+p*J*J+d*O*O,H=l+u+p*N*N+d*Y*Y,Z=l+u+p*J*N+d*O*Y;K&&U.debug("k1x2: ",W,H,Z,l,u,p,J,N,d,O,Y),W*W<1e3*(W*H-Z*Z)?(this.v_K.ex.set(W,Z),this.v_K.ey.set(Z,H),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}m.c.set(f),m.a=x,n.v.set(g),n.w=A,a.c.set(b),a.a=B,r.v.set(w),r.w=S},c.prototype.warmStartConstraint=function(t){for(var i=this.m_fixtureA,e=this.m_fixtureB,o=i.getBody(),s=e.getBody(),n=o.c_velocity,r=s.c_velocity,m=(o.c_position,s.c_position,this.v_invMassA),a=this.v_invIA,h=this.v_invMassB,c=this.v_invIB,_=X.clone(n.v),l=n.w,u=X.clone(r.v),p=r.w,d=this.v_normal,y=X.cross(d,1),v=0;v<this.v_pointCount;++v){var f=this.v_points[v],x=X.wAdd(f.normalImpulse,d,f.tangentImpulse,y);K&&U.debug(a,c,f.rA.x,f.rA.y,f.rB.x,f.rB.y,x.x,x.y),l-=a*X.cross(f.rA,x),_.wSub(m,x),p+=c*X.cross(f.rB,x),u.wAdd(h,x)}n.v.set(_),n.w=l,r.v.set(u),r.w=p},c.prototype.storeConstraintImpulses=function(t){for(var i=this.m_manifold,e=0;e<this.v_pointCount;++e)i.points[e].normalImpulse=this.v_points[e].normalImpulse,i.points[e].tangentImpulse=this.v_points[e].tangentImpulse},c.prototype.solveVelocityConstraint=function(t){var i=this.m_fixtureA.m_body,e=this.m_fixtureB.m_body,o=i.c_velocity,s=(i.c_position,e.c_velocity),n=(e.c_position,this.v_invMassA),r=this.v_invIA,m=this.v_invMassB,a=this.v_invIB,h=X.clone(o.v),c=o.w,_=X.clone(s.v),l=s.w,u=this.v_normal,p=X.cross(u,1),d=this.v_friction;G&&U.assert(1==this.v_pointCount||2==this.v_pointCount);for(var y=0;y<this.v_pointCount;++y){var v=this.v_points[y];(B=X.zero()).wAdd(1,_,1,X.cross(l,v.rB)),B.wSub(1,h,1,X.cross(c,v.rA));var f=X.dot(B,p)-this.v_tangentSpeed,x=v.tangentMass*-f,g=d*v.normalImpulse;x=(w=O.clamp(v.tangentImpulse+x,-g,g))-v.tangentImpulse,v.tangentImpulse=w;var A=X.mul(x,p);h.wSub(n,A),c-=r*X.cross(v.rA,A),_.wAdd(m,A),l+=a*X.cross(v.rB,A)}if(1==this.v_pointCount||0==t.blockSolve)for(var b=0;b<this.v_pointCount;++b){var B;v=this.v_points[b];(B=X.zero()).wAdd(1,_,1,X.cross(l,v.rB)),B.wSub(1,h,1,X.cross(c,v.rA));var w,S=X.dot(B,u);x=-v.normalMass*(S-v.velocityBias);x=(w=O.max(v.normalImpulse+x,0))-v.normalImpulse,v.normalImpulse=w;A=X.mul(x,u);h.wSub(n,A),c-=r*X.cross(v.rA,A),_.wAdd(m,A),l+=a*X.cross(v.rB,A)}else{var C=this.v_points[0],M=this.v_points[1],I=X.neo(C.normalImpulse,M.normalImpulse);G&&U.assert(0<=I.x&&0<=I.y);var P=X.zero().add(_).add(X.cross(l,C.rB)).sub(h).sub(X.cross(c,C.rA)),T=X.zero().add(_).add(X.cross(l,M.rB)).sub(h).sub(X.cross(c,M.rA)),V=X.dot(P,u),z=X.dot(T,u),L=X.neo(V-C.velocityBias,z-M.velocityBias);L.sub(R.mul(this.v_K,I));for(;;){var F=X.neg(R.mul(this.v_normalMass,L));if(0<=F.x&&0<=F.y){var q=X.sub(F,I),k=X.mul(q.x,u),D=X.mul(q.y,u);h.wSub(n,k,n,D),c-=r*(X.cross(C.rA,k)+X.cross(M.rA,D)),_.wAdd(m,k,m,D),l+=a*(X.cross(C.rB,k)+X.cross(M.rB,D)),C.normalImpulse=F.x,M.normalImpulse=F.y;break}if(F.x=-C.normalMass*L.x,V=F.y=0,z=this.v_K.ex.y*F.x+L.y,0<=F.x&&0<=z){q=X.sub(F,I),k=X.mul(q.x,u),D=X.mul(q.y,u);h.wSub(n,k,n,D),c-=r*(X.cross(C.rA,k)+X.cross(M.rA,D)),_.wAdd(m,k,m,D),l+=a*(X.cross(C.rB,k)+X.cross(M.rB,D)),C.normalImpulse=F.x,M.normalImpulse=F.y;break}if(F.x=0,F.y=-M.normalMass*L.y,V=this.v_K.ey.x*F.y+L.x,(z=0)<=F.y&&0<=V){q=X.sub(F,I),k=X.mul(q.x,u),D=X.mul(q.y,u);h.wSub(n,k,n,D),c-=r*(X.cross(C.rA,k)+X.cross(M.rA,D)),_.wAdd(m,k,m,D),l+=a*(X.cross(C.rB,k)+X.cross(M.rB,D)),C.normalImpulse=F.x,M.normalImpulse=F.y;break}if(F.x=0,F.y=0,V=L.x,z=L.y,0<=V&&0<=z){q=X.sub(F,I),k=X.mul(q.x,u),D=X.mul(q.y,u);h.wSub(n,k,n,D),c-=r*(X.cross(C.rA,k)+X.cross(M.rA,D)),_.wAdd(m,k,m,D),l+=a*(X.cross(C.rB,k)+X.cross(M.rB,D)),C.normalImpulse=F.x,M.normalImpulse=F.y;break}break}}o.v.set(h),o.w=c,s.v.set(_),s.w=l};var _=[];c.addType=function(t,i,e){_[t]=_[t]||{},_[t][i]=e},c.create=function(t,i,e,o){var s,n,r=t.getType(),m=e.getType();if(n=_[r]&&_[r][m])s=new c(t,i,e,o,n);else{if(!(n=_[m]&&_[m][r]))return null;s=new c(e,o,t,i,n)}t=s.getFixtureA(),e=s.getFixtureB(),i=s.getChildIndexA(),o=s.getChildIndexB();var a=t.getBody(),h=e.getBody();return(s.m_nodeA.contact=s).m_nodeA.other=h,s.m_nodeA.prev=null,s.m_nodeA.next=a.m_contactList,null!=a.m_contactList&&(a.m_contactList.prev=s.m_nodeA),a.m_contactList=s.m_nodeA,(s.m_nodeB.contact=s).m_nodeB.other=a,s.m_nodeB.prev=null,s.m_nodeB.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=s.m_nodeB),h.m_contactList=s.m_nodeB,0==t.isSensor()&&0==e.isSensor()&&(a.setAwake(!0),h.setAwake(!0)),s},c.destroy=function(t,i){var e=t.m_fixtureA,o=t.m_fixtureB,s=e.getBody(),n=o.getBody();t.isTouching()&&i.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),0<t.m_manifold.pointCount&&0==e.isSensor()&&0==o.isSensor()&&(s.setAwake(!0),n.setAwake(!0));var r=e.getType(),m=o.getType(),a=_[r][m].destroyFcn;"function"==typeof a&&a(t)}},{"./Manifold":6,"./Settings":7,"./collision/Distance":13,"./common/Mat22":16,"./common/Math":18,"./common/Rot":20,"./common/Transform":22,"./common/Vec2":23,"./util/common":50}],4:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=_;var n=t("./util/common"),r=t("./util/options"),a=t("./common/Vec2"),h=t("./collision/AABB"),m={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};function c(t,i){this.aabb=new h,this.fixture=t,this.childIndex=i,this.proxyId}function _(t,i,e){i.shape?i=(e=i).shape:"number"==typeof e&&(e={density:e}),e=r(e,m),this.m_body=t,this.m_friction=e.friction,this.m_restitution=e.restitution,this.m_density=e.density,this.m_isSensor=e.isSensor,this.m_filterGroupIndex=e.filterGroupIndex,this.m_filterCategoryBits=e.filterCategoryBits,this.m_filterMaskBits=e.filterMaskBits,this.m_shape=i,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var o=this.m_shape.getChildCount(),s=0;s<o;++s)this.m_proxies[s]=new c(this,s);this.m_userData=e.userData}_.prototype.getType=function(){return this.m_shape.getType()},_.prototype.getShape=function(){return this.m_shape},_.prototype.isSensor=function(){return this.m_isSensor},_.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},_.prototype.getUserData=function(){return this.m_userData},_.prototype.setUserData=function(t){this.m_userData=t},_.prototype.getBody=function(){return this.m_body},_.prototype.getNext=function(){return this.m_next},_.prototype.getDensity=function(){return this.m_density},_.prototype.setDensity=function(t){s&&n.assert(Math.isFinite(t)&&0<=t),this.m_density=t},_.prototype.getFriction=function(){return this.m_friction},_.prototype.setFriction=function(t){this.m_friction=t},_.prototype.getRestitution=function(){return this.m_restitution},_.prototype.setRestitution=function(t){this.m_restitution=t},_.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},_.prototype.rayCast=function(t,i,e){return this.m_shape.rayCast(t,i,this.m_body.getTransform(),e)},_.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},_.prototype.getAABB=function(t){return s&&n.assert(0<=t&&t<this.m_proxyCount),this.m_proxies[t].aabb},_.prototype.createProxies=function(t,i){s&&n.assert(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.getChildCount();for(var e=0;e<this.m_proxyCount;++e){var o=this.m_proxies[e];this.m_shape.computeAABB(o.aabb,i,e),o.proxyId=t.createProxy(o.aabb,o)}},_.prototype.destroyProxies=function(t){for(var i=0;i<this.m_proxyCount;++i){var e=this.m_proxies[i];t.destroyProxy(e.proxyId),e.proxyId=null}this.m_proxyCount=0},_.prototype.synchronize=function(t,i,e){for(var o=0;o<this.m_proxyCount;++o){var s=this.m_proxies[o],n=new h,r=new h;this.m_shape.computeAABB(n,i,s.childIndex),this.m_shape.computeAABB(r,e,s.childIndex),s.aabb.combine(n,r);var m=a.sub(e.p,i.p);t.moveProxy(s.proxyId,s.aabb,m)}},_.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},_.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},_.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},_.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},_.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var i=t.contact,e=i.getFixtureA(),o=i.getFixtureB();e!=this&&o!=this||i.flagForFiltering(),t=t.next}var s=this.m_body.getWorld();if(null!=s)for(var n=s.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},_.prototype.shouldCollide=function(t){return t.m_filterGroupIndex==this.m_filterGroupIndex&&0!=t.m_filterGroupIndex?0<t.m_filterGroupIndex:0!=(t.m_filterMaskBits&this.m_filterCategoryBits)&&0!=(t.m_filterCategoryBits&this.m_filterMaskBits)}},{"./collision/AABB":11,"./common/Vec2":23,"./util/common":50,"./util/options":52}],5:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=m;var n=t("./util/common");function r(){this.other=null,this.joint=null,this.prev=null,this.next=null}function m(t,i,e){i=t.bodyA||i,e=t.bodyB||e,s&&n.assert(i),s&&n.assert(e),s&&n.assert(i!=e),this.m_type="unknown-joint",this.m_bodyA=i,this.m_bodyB=e,this.m_index=0,this.m_collideConnected=!!t.collideConnected,this.m_prev=null,this.m_next=null,this.m_edgeA=new r,this.m_edgeB=new r,this.m_islandFlag=!1,this.m_userData=t.userData}m.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},m.prototype.getType=function(){return this.m_type},m.prototype.getBodyA=function(){return this.m_bodyA},m.prototype.getBodyB=function(){return this.m_bodyB},m.prototype.getNext=function(){return this.m_next},m.prototype.getUserData=function(){return this.m_userData},m.prototype.setUserData=function(t){this.m_userData=t},m.prototype.getCollideConnected=function(){return this.m_collideConnected},m.prototype.getAnchorA=function(){},m.prototype.getAnchorB=function(){},m.prototype.getReactionForce=function(t){},m.prototype.getReactionTorque=function(t){},m.prototype.shiftOrigin=function(t){},m.prototype.initVelocityConstraints=function(t){},m.prototype.solveVelocityConstraints=function(t){},m.prototype.solvePositionConstraints=function(t){}},{"./util/common":50}],6:[function(t,i,e){if(void 0===y)var y=!1;if(void 0===o)var o=!1;var v=t("./util/common"),f=t("./common/Vec2"),x=t("./common/Transform"),g=t("./common/Math"),A=t("./common/Rot");function b(){this.type,this.localNormal=f.zero(),this.localPoint=f.zero(),this.points=[new s,new s],this.pointCount=0}function s(){this.localPoint=f.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new n}function n(){this.cf=new h,this.key}function h(){this.indexA,this.indexB,this.typeA,this.typeB}function B(){this.normal,this.points=[],this.separations=[]}i.exports=b,i.exports.clipSegmentToLine=function(t,i,e,o,s){var n=0,r=f.dot(e,i[0].v)-o,m=f.dot(e,i[1].v)-o;r<=0&&t[n++].set(i[0]);m<=0&&t[n++].set(i[1]);if(r*m<0){var a=r/(r-m);t[n].v.wSet(1-a,i[0].v,a,i[1].v),t[n].id.cf.indexA=s,t[n].id.cf.indexB=i[0].id.cf.indexB,t[n].id.cf.typeA=h.e_vertex,t[n].id.cf.typeB=h.e_face,++n}return n},i.exports.clipVertex=r,i.exports.getPointStates=function(t,i,e,o){for(var s=0;s<e.pointCount;++s){var n=e.points[s].id;t[s]=m.removeState;for(var r=0;r<o.pointCount;++r)if(o.points[r].id.key==n.key){t[s]=m.persistState;break}}for(var s=0;s<o.pointCount;++s){var n=o.points[s].id;i[s]=m.addState;for(var r=0;r<e.pointCount;++r)if(e.points[r].id.key==n.key){i[s]=m.persistState;break}}},i.exports.PointState=m,b.e_circles=0,b.e_faceA=1,b.e_faceB=2,b.e_vertex=0,b.e_face=1,n.prototype.set=function(t){this.key=t.key,this.cf.set(t.cf)},h.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB},b.prototype.getWorldManifold=function(t,i,e,o,s){if(0!=this.pointCount){var n=(t=t||new B).normal,r=t.points,m=t.separations;switch(this.type){case b.e_circles:n=f.neo(1,0);var a=x.mul(i,this.localPoint),h=x.mul(o,this.points[0].localPoint),c=f.sub(h,a);f.lengthSquared(c)>g.EPSILON*g.EPSILON&&(n.set(c),n.normalize()),r[0]=f.mid(a,h),m[0]=-s-e,r.length=1,m.length=1;break;case b.e_faceA:n=A.mul(i.q,this.localNormal);var _=x.mul(i,this.localPoint);y&&v.debug("faceA",this.localPoint.x,this.localPoint.y,this.localNormal.x,this.localNormal.y,n.x,n.y);for(var l=0;l<this.pointCount;++l){var u=x.mul(o,this.points[l].localPoint),p=f.clone(u).wAdd(e-f.dot(f.sub(u,_),n),n),d=f.clone(u).wSub(s,n);r[l]=f.mid(p,d),m[l]=f.dot(f.sub(d,p),n),y&&v.debug(l,this.points[l].localPoint.x,this.points[l].localPoint.y,_.x,_.y,i.p.x,i.p.y,i.q.c,i.q.s,o.p.x,o.p.y,o.q.c,o.q.s,e,s,u.x,u.y,p.x,p.y,d.x,d.y,m[l],r[l].x,r[l].y)}r.length=this.pointCount,m.length=this.pointCount;break;case b.e_faceB:n=A.mul(o.q,this.localNormal);for(_=x.mul(o,this.localPoint),l=0;l<this.pointCount;++l){u=x.mul(i,this.points[l].localPoint),d=f.zero().wSet(1,u,s-f.dot(f.sub(u,_),n),n),p=f.zero().wSet(1,u,-e,n);r[l]=f.mid(p,d),m[l]=f.dot(f.sub(p,d),n)}r.length=this.pointCount,m.length=this.pointCount,n.mul(-1)}return t.normal=n,t.points=r,t.separations=m,t}};var m={nullState:0,addState:1,persistState:2,removeState:3};function r(){this.v=f.zero(),this.id=new n}r.prototype.set=function(t){this.v.set(t.v),this.id.set(t.id)}},{"./common/Math":18,"./common/Rot":20,"./common/Transform":22,"./common/Vec2":23,"./util/common":50}],7:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;var n=e;n.maxManifoldPoints=2,n.maxPolygonVertices=12,n.aabbExtension=.1,n.aabbMultiplier=2,n.linearSlop=.005,n.linearSlopSquared=n.linearSlop*n.linearSlop,n.angularSlop=2/180*Math.PI,n.polygonRadius=2*n.linearSlop,n.maxSubSteps=8,n.maxTOIContacts=32,n.maxTOIIterations=20,n.maxDistnceIterations=20,n.velocityThreshold=1,n.maxLinearCorrection=.2,n.maxAngularCorrection=8/180*Math.PI,n.maxTranslation=2,n.maxTranslationSquared=n.maxTranslation*n.maxTranslation,n.maxRotation=.5*Math.PI,n.maxRotationSquared=n.maxRotation*n.maxRotation,n.baumgarte=.2,n.toiBaugarte=.75,n.timeToSleep=.5,n.linearSleepTolerance=.01,n.linearSleepToleranceSqr=Math.pow(n.linearSleepTolerance,2),n.angularSleepTolerance=2/180*Math.PI,n.angularSleepToleranceSqr=Math.pow(n.angularSleepTolerance,2)},{}],8:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=n;t("./common/Math");function n(){this.m_type,this.m_radius}n.isValid=function(t){return!!t},n.prototype.getRadius=function(){return this.m_radius},n.prototype.getType=function(){return this.m_type},n.prototype._clone=function(){},n.prototype.getChildCount=function(){},n.prototype.testPoint=function(t,i){},n.prototype.rayCast=function(t,i,e,o){},n.prototype.computeAABB=function(t,i,e){},n.prototype.computeMass=function(t,i){},n.prototype.computeDistanceProxy=function(t){}},{"./common/Math":18}],9:[function(t,i,e){if(void 0===D)var D=!1;if(void 0===R)var R=!1;i.exports=h,i.exports.TimeStep=a;var E=t("./Settings"),j=t("./util/common"),C=t("./util/Timer"),M=t("./common/Vec2"),J=t("./common/Math"),o=t("./Body"),s=t("./Contact"),n=t("./Joint"),O=t("./collision/TimeOfImpact"),N=O.Input,Y=O.Output,r=t("./collision/Distance");r.Input,r.Output,r.Proxy,r.Cache;function m(){this.solveInit,this.solveVelocity,this.solvePosition}function a(t){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}function h(t){this.m_world=t,this.m_profile=new m,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}a.prototype.reset=function(t){0<this.dt&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},h.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},h.prototype.addBody=function(t){R&&j.assert(t instanceof o,"Not a Body!",t),this.m_bodies.push(t)},h.prototype.addContact=function(t){R&&j.assert(t instanceof s,"Not a Contact!",t),this.m_contacts.push(t)},h.prototype.addJoint=function(t){R&&j.assert(t instanceof n,"Not a Joint!",t),this.m_joints.push(t)},h.prototype.solveWorld=function(t){var i=this.m_world,e=this.m_profile;e.solveInit=0,e.solveVelocity=0,e.solvePosition=0;for(var o=i.m_bodyList;o;o=o.m_next)o.m_islandFlag=!1;for(var s=i.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=i.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(var r=this.m_stack,m=i.m_bodyList;m;m=m.m_next)if(0,!m.m_islandFlag&&0!=m.isAwake()&&0!=m.isActive()&&!m.isStatic()){for(this.clear(),r.push(m),m.m_islandFlag=!0;0<r.length;){o=r.pop();if(R&&j.assert(1==o.isActive()),this.addBody(o),o.setAwake(!0),!o.isStatic()){for(var a=o.m_contactList;a;a=a.next){var h=a.contact;if(!h.m_islandFlag&&(0!=h.isEnabled()&&0!=h.isTouching())){var c=h.m_fixtureA.m_isSensor,_=h.m_fixtureB.m_isSensor;if(!c&&!_)this.addContact(h),h.m_islandFlag=!0,(u=a.other).m_islandFlag||(r.push(u),u.m_islandFlag=!0)}}for(var l=o.m_jointList;l;l=l.next){var u;if(1!=l.joint.m_islandFlag)0!=(u=l.other).isActive()&&(this.addJoint(l.joint),l.joint.m_islandFlag=!0,u.m_islandFlag||(r.push(u),u.m_islandFlag=!0))}}}this.solveIsland(t);for(var p=0;p<this.m_bodies.length;++p){(o=this.m_bodies[p]).isStatic()&&(o.m_islandFlag=!1)}}},h.prototype.solveIsland=function(t){for(var i=this.m_world,e=this.m_profile,o=i.m_gravity,s=i.m_allowSleep,n=C.now(),r=t.dt,m=0;m<this.m_bodies.length;++m){var a=this.m_bodies[m],h=M.clone(a.m_sweep.c),c=a.m_sweep.a,_=M.clone(a.m_linearVelocity),l=a.m_angularVelocity;a.m_sweep.c0.set(a.m_sweep.c),a.m_sweep.a0=a.m_sweep.a,D&&j.debug("P: ",c,h.x,h.y,l,_.x,_.y),a.isDynamic()&&(_.wAdd(r*a.m_gravityScale,o),_.wAdd(r*a.m_invMass,a.m_force),l+=r*a.m_invI*a.m_torque,D&&j.debug("N: "+r,a.m_gravityScale,o.x,o.y,a.m_invMass,a.m_force.x,a.m_force.y),_.mul(1/(1+r*a.m_linearDamping)),l*=1/(1+r*a.m_angularDamping)),j.debug("A: ",c,h.x,h.y,l,_.x,_.y),a.c_position.c=h,a.c_position.a=c,a.c_velocity.v=_,a.c_velocity.w=l}n=C.now();for(m=0;m<this.m_contacts.length;++m){this.m_contacts[m].initConstraint(t)}D&&this.printBodies("M: ");for(m=0;m<this.m_contacts.length;++m){this.m_contacts[m].initVelocityConstraint(t)}if(D&&this.printBodies("R: "),t.warmStarting)for(m=0;m<this.m_contacts.length;++m){this.m_contacts[m].warmStartConstraint(t)}D&&this.printBodies("Q: ");for(m=0;m<this.m_joints.length;++m){this.m_joints[m].initVelocityConstraints(t)}D&&this.printBodies("E: "),e.solveInit=C.diff(n),n=C.now();for(m=0;m<t.velocityIterations;++m){D&&j.debug("--",m);for(var u=0;u<this.m_joints.length;++u){this.m_joints[u].solveVelocityConstraints(t)}for(u=0;u<this.m_contacts.length;++u){this.m_contacts[u].solveVelocityConstraint(t)}}D&&this.printBodies("D: ");for(m=0;m<this.m_contacts.length;++m){this.m_contacts[m].storeConstraintImpulses(t)}e.solveVelocity=C.diff(n),D&&this.printBodies("C: ");for(m=0;m<this.m_bodies.length;++m){a=this.m_bodies[m],h=M.clone(a.c_position.c),c=a.c_position.a,_=M.clone(a.c_velocity.v),l=a.c_velocity.w;var p=M.mul(r,_);if(M.lengthSquared(p)>E.maxTranslationSquared){var d=E.maxTranslation/p.length();_.mul(d)}var y=r*l;if(y*y>E.maxRotationSquared)l*=d=E.maxRotation/J.abs(y);h.wAdd(r,_),c+=r*l,a.c_position.c.set(h),a.c_position.a=c,a.c_velocity.v.set(_),a.c_velocity.w=l}D&&this.printBodies("B: "),n=C.now();var v=!1;for(m=0;m<t.positionIterations;++m){var f=0;for(u=0;u<this.m_contacts.length;++u){var x=this.m_contacts[u].solvePositionConstraint(t);f=J.min(f,x)}var g=f>=-3*E.linearSlop,A=!0;for(u=0;u<this.m_joints.length;++u){var b=this.m_joints[u].solvePositionConstraints(t);A=A&&b}if(g&&A){v=!0;break}}D&&this.printBodies("L: ");for(m=0;m<this.m_bodies.length;++m){(a=this.m_bodies[m]).m_sweep.c.set(a.c_position.c),a.m_sweep.a=a.c_position.a,a.m_linearVelocity.set(a.c_velocity.v),a.m_angularVelocity=a.c_velocity.w,a.synchronizeTransform()}if(e.solvePosition=C.diff(n),this.postSolveIsland(),s){var B=1/0,w=E.linearSleepToleranceSqr,S=E.angularSleepToleranceSqr;for(m=0;m<this.m_bodies.length;++m){(a=this.m_bodies[m]).isStatic()||(B=0==a.m_autoSleepFlag||a.m_angularVelocity*a.m_angularVelocity>S||M.lengthSquared(a.m_linearVelocity)>w?a.m_sleepTime=0:(a.m_sleepTime+=r,J.min(B,a.m_sleepTime)))}if(B>=E.timeToSleep&&v)for(m=0;m<this.m_bodies.length;++m){(a=this.m_bodies[m]).setAwake(!1)}}},h.prototype.printBodies=function(t){for(var i=0;i<this.m_bodies.length;++i){var e=this.m_bodies[i];j.debug(t,e.c_position.a,e.c_position.c.x,e.c_position.c.y,e.c_velocity.w,e.c_velocity.v.x,e.c_velocity.v.y)}};var W=new a;function c(){this.normalImpulses=[],this.tangentImpulses=[]}h.prototype.solveWorldTOI=function(t){D&&j.debug("TOI++++++World");var i=this.m_world;this.m_profile;if(D&&j.debug("Z:",i.m_stepComplete),i.m_stepComplete){for(var e=i.m_bodyList;e;e=e.m_next)e.m_islandFlag=!1,e.m_sweep.alpha0=0,D&&j.debug("b.alpha0:",e.m_sweep.alpha0);for(var o=i.m_contactList;o;o=o.m_next)o.m_toiFlag=!1,o.m_islandFlag=!1,o.m_toiCount=0,o.m_toi=1}if(D)for(o=i.m_contactList;o;o=o.m_next)D&&j.debug("X:",o.m_toiFlag);for(;;){D&&j.debug(";;");var s=null,n=1;for(o=i.m_contactList;o;o=o.m_next)if(D&&j.debug("alpha0::",o.getFixtureA().getBody().m_sweep.alpha0,o.getFixtureB().getBody().m_sweep.alpha0),0!=o.isEnabled()&&(D&&j.debug("toiCount:",o.m_toiCount,E.maxSubSteps),!(o.m_toiCount>E.maxSubSteps))){D&&j.debug("toiFlag:",o.m_toiFlag);var r=1;if(o.m_toiFlag)r=o.m_toi;else{var m=o.getFixtureA(),a=o.getFixtureB();if(D&&j.debug("sensor:",m.isSensor(),a.isSensor()),m.isSensor()||a.isSensor())continue;var h=m.getBody(),c=a.getBody();R&&j.assert(h.isDynamic()||c.isDynamic());var _=h.isAwake()&&!h.isStatic(),l=c.isAwake()&&!c.isStatic();if(D&&j.debug("awakestatic:",h.isAwake(),h.isStatic()),D&&j.debug("awakestatic:",c.isAwake(),c.isStatic()),D&&j.debug("active:",_,l),0==_&&0==l)continue;D&&j.debug("alpha:",r,h.m_sweep.alpha0,c.m_sweep.alpha0);var u=h.isBullet()||!h.isDynamic(),p=c.isBullet()||!c.isDynamic();if(D&&j.debug("collide:",u,p),0==u&&0==p)continue;var d=h.m_sweep.alpha0;h.m_sweep.alpha0<c.m_sweep.alpha0?(d=c.m_sweep.alpha0,h.m_sweep.advance(d)):c.m_sweep.alpha0<h.m_sweep.alpha0&&(d=h.m_sweep.alpha0,c.m_sweep.advance(d)),D&&j.debug("alpha0:",d,h.m_sweep.alpha0,c.m_sweep.alpha0),R&&j.assert(d<1);var y=o.getChildIndexA(),v=o.getChildIndexB(),f=h.m_sweep,x=c.m_sweep;D&&j.debug("sweepA",f.localCenter.x,f.localCenter.y,f.c.x,f.c.y,f.a,f.alpha0,f.c0.x,f.c0.y,f.a0),D&&j.debug("sweepB",x.localCenter.x,x.localCenter.y,x.c.x,x.c.y,x.a,x.alpha0,x.c0.x,x.c0.y,x.a0);var g=new N;g.proxyA.set(m.getShape(),y),g.proxyB.set(a.getShape(),v),g.sweepA.set(h.m_sweep),g.sweepB.set(c.m_sweep),g.tMax=1;var A=new Y;O(A,g);var b=A.t;D&&j.debug("state:",A.state,Y.e_touching),r=A.state==Y.e_touching?J.min(d+(1-d)*b,1):1,o.m_toi=r,o.m_toiFlag=!0}D&&j.debug("minAlpha:",n,r),r<n&&(s=o,n=r)}if(D&&j.debug("minContact:",null==s,1-10*J.EPSILON<n,n),null==s||1-10*J.EPSILON<n){i.m_stepComplete=!0;break}m=s.getFixtureA(),a=s.getFixtureB(),h=m.getBody(),c=a.getBody();var B=h.m_sweep.clone(),w=c.m_sweep.clone();if(h.advance(n),c.advance(n),s.update(i),s.m_toiFlag=!1,++s.m_toiCount,0!=s.isEnabled()&&0!=s.isTouching()){h.setAwake(!0),c.setAwake(!0),this.clear(),this.addBody(h),this.addBody(c),this.addContact(s),h.m_islandFlag=!0,c.m_islandFlag=!0,s.m_islandFlag=!0;for(var S=[h,c],C=0;C<S.length;++C){if((L=S[C]).isDynamic())for(var M=L.m_contactList;M;M=M.next){var I=M.contact;if(!I.m_islandFlag){var P=M.other;if(!P.isDynamic()||L.isBullet()||P.isBullet()){var T=I.m_fixtureA.m_isSensor,V=I.m_fixtureB.m_isSensor;if(!T&&!V){var z=P.m_sweep.clone();0==P.m_islandFlag&&P.advance(n),I.update(i),0!=I.isEnabled()&&0!=I.isTouching()?(I.m_islandFlag=!0,this.addContact(I),P.m_islandFlag||(P.m_islandFlag=!0,P.isStatic()||P.setAwake(!0),this.addBody(P))):(P.m_sweep.set(z),P.synchronizeTransform())}}}}}W.reset((1-n)*t.dt),W.dtRatio=1,W.positionIterations=20,W.velocityIterations=t.velocityIterations,W.warmStarting=!1,this.solveIslandTOI(W,h,c);for(C=0;C<this.m_bodies.length;++C){var L;if((L=this.m_bodies[C]).m_islandFlag=!1,L.isDynamic()){L.synchronizeFixtures();for(M=L.m_contactList;M;M=M.next)M.contact.m_toiFlag=!1,M.contact.m_islandFlag=!1}}if(i.findNewContacts(),i.m_subStepping){i.m_stepComplete=!1;break}}else s.setEnabled(!1),h.m_sweep.set(B),c.m_sweep.set(w),h.synchronizeTransform(),c.synchronizeTransform()}if(D)for(e=i.m_bodyList;e;e=e.m_next){o=e.m_sweep.c;var F=e.m_sweep.a,q=e.m_linearVelocity,k=e.m_angularVelocity;D&&j.debug("== ",F,o.x,o.y,k,q.x,q.y)}},h.prototype.solveIslandTOI=function(t,i,e){D&&j.debug("TOI++++++Island");this.m_world,this.m_profile;for(var o=0;o<this.m_bodies.length;++o){(a=this.m_bodies[o]).c_position.c.set(a.m_sweep.c),a.c_position.a=a.m_sweep.a,a.c_velocity.v.set(a.m_linearVelocity),a.c_velocity.w=a.m_angularVelocity}for(var o=0;o<this.m_contacts.length;++o){this.m_contacts[o].initConstraint(t)}for(o=0;o<t.positionIterations;++o){for(var s=0,n=0;n<this.m_contacts.length;++n){var r=this.m_contacts[n].solvePositionConstraintTOI(t,i,e);s=J.min(s,r)}if(s>=-1.5*E.linearSlop)break}i.m_sweep.c0.set(i.c_position.c),i.m_sweep.a0=i.c_position.a,e.m_sweep.c0.set(e.c_position.c),e.m_sweep.a0=e.c_position.a;for(o=0;o<this.m_contacts.length;++o){this.m_contacts[o].initVelocityConstraint(t)}for(o=0;o<t.velocityIterations;++o)for(n=0;n<this.m_contacts.length;++n){this.m_contacts[n].solveVelocityConstraint(t)}var m=t.dt;for(o=0;o<this.m_bodies.length;++o){var a=this.m_bodies[o],h=M.clone(a.c_position.c),c=a.c_position.a,_=M.clone(a.c_velocity.v),l=a.c_velocity.w,u=M.mul(m,_);if(M.dot(u,u)>E.maxTranslationSquared){var p=E.maxTranslation/u.length();_.mul(p)}var d=m*l;if(d*d>E.maxRotationSquared)l*=p=E.maxRotation/J.abs(d);h.wAdd(m,_),c+=m*l,a.c_position.c=h,a.c_position.a=c,a.c_velocity.v=_,a.c_velocity.w=l,a.m_sweep.c=h,a.m_sweep.a=c,a.m_linearVelocity=_,a.m_angularVelocity=l,a.synchronizeTransform()}this.postSolveIsland(),D&&j.debug("TOI------Island")},h.prototype.postSolveIsland=function(){for(var t=new c,i=0;i<this.m_contacts.length;++i){for(var e=this.m_contacts[i],o=0;o<e.v_points.length;++o)t.normalImpulses.push(e.v_points[o].normalImpulse),t.tangentImpulses.push(e.v_points[o].tangentImpulse);this.m_world.postSolve(e,t)}}},{"./Body":2,"./Contact":3,"./Joint":5,"./Settings":7,"./collision/Distance":13,"./collision/TimeOfImpact":15,"./common/Math":18,"./common/Vec2":23,"./util/Timer":49,"./util/common":50}],10:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===m)var m=!1;i.exports=l;var s=t("./util/options"),c=t("./util/common"),_=(t("./util/Timer"),t("./common/Vec2")),n=t("./collision/BroadPhase"),r=t("./Solver"),a=t("./Body"),p=t("./Contact"),h={gravity:_.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};function l(t){if(!(this instanceof l))return new l(t);t&&_.isValid(t)&&(t={gravity:t}),t=s(t,h),this.m_solver=new r(this),this.m_broadPhase=new n,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=_.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0,this.m_stepCount=0,this.addPair=this.createContact.bind(this)}l.prototype.getBodyList=function(){return this.m_bodyList},l.prototype.getJointList=function(){return this.m_jointList},l.prototype.getContactList=function(){return this.m_contactList},l.prototype.getBodyCount=function(){return this.m_bodyCount},l.prototype.getJointCount=function(){return this.m_jointCount},l.prototype.getContactCount=function(){return this.m_contactCount},l.prototype.setGravity=function(t){this.m_gravity=t},l.prototype.getGravity=function(){return this.m_gravity},l.prototype.isLocked=function(){return this.m_locked},l.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var i=this.m_bodyList;i;i=i.m_next)i.setAwake(!0)},l.prototype.getAllowSleeping=function(){return this.m_allowSleep},l.prototype.setWarmStarting=function(t){this.m_warmStarting=t},l.prototype.getWarmStarting=function(){return this.m_warmStarting},l.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},l.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},l.prototype.setSubStepping=function(t){this.m_subStepping=t},l.prototype.getSubStepping=function(){return this.m_subStepping},l.prototype.setAutoClearForces=function(t){this.m_clearForces=t},l.prototype.getAutoClearForces=function(){return this.m_clearForces},l.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},l.prototype.queryAABB=function(t,e){m&&c.assert("function"==typeof e);var o=this.m_broadPhase;this.m_broadPhase.query(t,function(t){var i=o.getUserData(t);return e(i.fixture)})},l.prototype.rayCast=function(t,i,a){m&&c.assert("function"==typeof a);var h=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:i},function(t,i){var e=h.getUserData(i),o=e.fixture,s=e.childIndex,n={};if(o.rayCast(n,t,s)){var r=n.fraction,m=_.add(_.mul(1-r,t.p1),_.mul(r,t.p2));return a(o,m,n.normal,r)}return t.maxFraction})},l.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},l.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},l.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},l.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},l.prototype.shiftOrigin=function(t){if(m&&c.assert(0==this.m_locked),!this.m_locked){for(var i=this.m_bodyList;i;i=i.m_next)i.m_xf.p.sub(t),i.m_sweep.c0.sub(t),i.m_sweep.c.sub(t);for(var e=this.m_jointList;e;e=e.m_next)e.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},l.prototype.createBody=function(t,i){if(m&&c.assert(0==this.isLocked()),this.isLocked())return null;t&&_.isValid(t)&&(t={position:t,angle:i});var e=new a(this,t);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},l.prototype.createDynamicBody=function(t,i){return t?_.isValid(t)&&(t={position:t,angle:i}):t={},t.type="dynamic",this.createBody(t)},l.prototype.createKinematicBody=function(t,i){return t?_.isValid(t)&&(t={position:t,angle:i}):t={},t.type="kinematic",this.createBody(t)},l.prototype.destroyBody=function(t){if(m&&c.assert(0<this.m_bodyCount),m&&c.assert(0==this.isLocked()),!this.isLocked()){if(t.m_destroyed)return!1;for(var i=t.m_jointList;i;){var e=i;i=i.next,this.publish("remove-joint",e.joint),this.destroyJoint(e.joint),t.m_jointList=i}t.m_jointList=null;for(var o=t.m_contactList;o;){var s=o;o=o.next,this.destroyContact(s.contact),t.m_contactList=o}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var r=n;n=n.m_next,this.publish("remove-fixture",r),r.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,!0}},l.prototype.createJoint=function(t){if(m&&c.assert(!!t.m_bodyA),m&&c.assert(!!t.m_bodyB),m&&c.assert(0==this.isLocked()),this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,(t.m_edgeA.joint=t).m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,(t.m_edgeB.joint=t).m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(var i=t.m_bodyB.getContactList();i;i=i.next)i.other==t.m_bodyA&&i.contact.flagForFiltering();return t},l.prototype.destroyJoint=function(t){if(m&&c.assert(0==this.isLocked()),!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,e=t.m_bodyB;if(i.setAwake(!0),e.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==e.m_jointList&&(e.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,m&&c.assert(0<this.m_jointCount),--this.m_jointCount,0==t.m_collideConnected)for(var o=e.getContactList();o;)o.other==i&&o.contact.flagForFiltering(),o=o.next;this.publish("remove-joint",t)}};var u=new r.TimeStep;l.prototype.step=function(t,i,e){if((0|i)!==i&&(i=0),i=i||this.m_velocityIterations,e=e||this.m_positionIterations,this.m_stepCount++,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,u.reset(t),u.velocityIterations=i,u.positionIterations=e,u.warmStarting=this.m_warmStarting,u.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&0<t){this.m_solver.solveWorld(u);for(var o=this.m_bodyList;o;o=o.getNext())0!=o.m_islandFlag&&(o.isStatic()||o.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&0<t&&this.m_solver.solveWorldTOI(u),this.m_clearForces&&this.clearForces(),this.m_locked=!1},l.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.addPair)},l.prototype.createContact=function(t,i){var e=t.fixture,o=i.fixture,s=t.childIndex,n=i.childIndex,r=e.getBody(),m=o.getBody();if(r!=m){for(var a=m.getContactList();a;){if(a.other==r){var h=a.contact.getFixtureA(),c=a.contact.getFixtureB(),_=a.contact.getChildIndexA(),l=a.contact.getChildIndexB();if(h==e&&c==o&&_==s&&l==n)return;if(h==o&&c==e&&_==n&&l==s)return}a=a.next}if(0!=m.shouldCollide(r)&&0!=o.shouldCollide(e)){var u=p.create(e,s,o,n);null!=u&&((u.m_prev=null)!=this.m_contactList&&(u.m_next=this.m_contactList,this.m_contactList.m_prev=u),this.m_contactList=u,++this.m_contactCount)}}},l.prototype.updateContacts=function(){for(var t,i=this.m_contactList;t=i;){i=t.getNext();var e=t.getFixtureA(),o=t.getFixtureB(),s=t.getChildIndexA(),n=t.getChildIndexB(),r=e.getBody(),m=o.getBody();if(t.m_filterFlag){if(0==m.shouldCollide(r)){this.destroyContact(t);continue}if(0==o.shouldCollide(e)){this.destroyContact(t);continue}t.m_filterFlag=!1}var a=r.isAwake()&&!r.isStatic(),h=m.isAwake()&&!m.isStatic();if(0!=a||0!=h){var c=e.m_proxies[s].proxyId,_=o.m_proxies[n].proxyId;0!=this.m_broadPhase.testOverlap(c,_)?t.update(this):this.destroyContact(t)}}},l.prototype.destroyContact=function(t){p.destroy(t,this),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),--this.m_contactCount},l.prototype._listeners=null,l.prototype.on=function(t,i){return"string"!=typeof t||"function"!=typeof i||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(i)),this},l.prototype.off=function(t,i){if("string"!=typeof t||"function"!=typeof i)return this;var e=this._listeners&&this._listeners[t];if(!e||!e.length)return this;var o=e.indexOf(i);return 0<=o&&e.splice(o,1),this},l.prototype.publish=function(t,i,e,o){var s=this._listeners&&this._listeners[t];if(!s||!s.length)return 0;for(var n=0;n<s.length;n++)s[n].call(this,i,e,o);return s.length},l.prototype.beginContact=function(t){this.publish("begin-contact",t)},l.prototype.endContact=function(t){this.publish("end-contact",t)},l.prototype.preSolve=function(t,i){this.publish("pre-solve",t,i)},l.prototype.postSolve=function(t,i){this.publish("post-solve",t,i)}},{"./Body":2,"./Contact":3,"./Solver":9,"./collision/BroadPhase":12,"./common/Vec2":23,"./util/Timer":49,"./util/common":50,"./util/options":52}],11:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;t("../Settings");var p=t("../common/Math"),d=t("../common/Vec2");function n(t,i){if(!(this instanceof n))return new n(t,i);this.lowerBound=d.zero(),this.upperBound=d.zero(),"object"==typeof t&&this.lowerBound.set(t),"object"==typeof i&&this.upperBound.set(i)}(i.exports=n).prototype.isValid=function(){return n.isValid(this)},n.isValid=function(t){var i=d.sub(t.upperBound,t.lowerBound);return 0<=i.x&&0<=i.y&&d.isValid(t.lowerBound)&&d.isValid(t.upperBound)},n.prototype.getCenter=function(){return d.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},n.prototype.getExtents=function(){return d.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},n.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},n.prototype.combine=function(t,i){i=i||this,this.lowerBound.set(p.min(t.lowerBound.x,i.lowerBound.x),p.min(t.lowerBound.y,i.lowerBound.y)),this.upperBound.set(p.max(t.upperBound.x,i.upperBound.x),p.max(t.upperBound.y,i.upperBound.y))},n.prototype.combinePoints=function(t,i){this.lowerBound.set(p.min(t.x,i.x),p.min(t.y,i.y)),this.upperBound.set(p.max(t.x,i.x),p.max(t.y,i.y))},n.prototype.set=function(t){this.lowerBound.set(t.lowerBound.x,t.lowerBound.y),this.upperBound.set(t.upperBound.x,t.upperBound.y)},n.prototype.contains=function(t){var i=!0;return i=(i=(i=(i=i&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},n.prototype.extend=function(t){n.extend(this,t)},n.extend=function(t,i){t.lowerBound.x-=i,t.lowerBound.y-=i,t.upperBound.x+=i,t.upperBound.y+=i},n.testOverlap=function(t,i){var e=i.lowerBound.x-t.upperBound.x,o=t.lowerBound.x-i.upperBound.x,s=i.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-i.upperBound.y;return!(0<e||0<s||0<o||0<n)},n.areEqual=function(t,i){return d.areEqual(t.lowerBound,i.lowerBound)&&d.areEqual(t.upperBound,i.upperBound)},n.diff=function(t,i){var e=p.max(0,p.min(t.upperBound.x,i.upperBound.x)-p.max(i.lowerBound.x,t.lowerBound.x)),o=p.max(0,p.min(t.upperBound.y,i.upperBound.y)-p.max(i.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(i.upperBound.x-i.lowerBound.x)*(i.upperBound.y-i.lowerBound.y)-e*o},n.prototype.rayCast=function(t,i){for(var e=-1/0,o=1/0,s=i.p1,n=d.sub(i.p2,i.p1),r=d.abs(n),m=d.zero(),a="x";null!==a;a="x"===a?"y":null)if(r.x<p.EPSILON){if(s[a]<this.lowerBound[a]||this.upperBound[a]<s[a])return!1}else{var h=1/n[a],c=(this.lowerBound[a]-s[a])*h,_=(this.upperBound[a]-s[a])*h,l=-1;if(_<c){var u=c;c=_,_=u,l=1}if(e<c&&(m.setZero(),m[a]=l,e=c),(o=p.min(o,_))<e)return!1}return!(e<0||i.maxFraction<e)&&(t.fraction=e,t.normal=m,!0)},n.prototype.toString=function(){return JSON.stringify(this)}},{"../Settings":7,"../common/Math":18,"../common/Vec2":23}],12:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;t("../Settings");var n=t("../util/common"),r=t("../common/Math"),m=t("./AABB"),a=t("./DynamicTree");function h(){this.m_tree=new a,this.m_proxyCount=0,this.m_moveBuffer=[],this.queryCallback=this.queryCallback.bind(this)}(i.exports=h).prototype.getUserData=function(t){return this.m_tree.getUserData(t)},h.prototype.testOverlap=function(t,i){var e=this.m_tree.getFatAABB(t),o=this.m_tree.getFatAABB(i);return m.testOverlap(e,o)},h.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},h.prototype.getProxyCount=function(){return this.m_proxyCount},h.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},h.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},h.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},h.prototype.query=function(t,i){this.m_tree.query(t,i)},h.prototype.rayCast=function(t,i){this.m_tree.rayCast(t,i)},h.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},h.prototype.createProxy=function(t,i){s&&n.assert(m.isValid(t));var e=this.m_tree.createProxy(t,i);return this.m_proxyCount++,this.bufferMove(e),e},h.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_proxyCount--,this.m_tree.destroyProxy(t)},h.prototype.moveProxy=function(t,i,e){s&&n.assert(m.isValid(i)),this.m_tree.moveProxy(t,i,e)&&this.bufferMove(t)},h.prototype.touchProxy=function(t){this.bufferMove(t)},h.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},h.prototype.unbufferMove=function(t){for(var i=0;i<this.m_moveBuffer.length;++i)this.m_moveBuffer[i]==t&&(this.m_moveBuffer[i]=null)},h.prototype.updatePairs=function(t){for(s&&n.assert("function"==typeof t),this.m_callback=t;0<this.m_moveBuffer.length;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var i=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(i,this.queryCallback)}},h.prototype.queryCallback=function(t){if(t==this.m_queryProxyId)return!0;var i=r.min(t,this.m_queryProxyId),e=r.max(t,this.m_queryProxyId),o=this.m_tree.getUserData(i),s=this.m_tree.getUserData(e);return this.m_callback(o,s),!0}},{"../Settings":7,"../common/Math":18,"../util/common":50,"./AABB":11,"./DynamicTree":14}],13:[function(t,i,e){if(void 0===b)var b=!1;if(void 0===_)var _=!1;i.exports=u,i.exports.Input=h,i.exports.Output=c,i.exports.Proxy=o,i.exports.Cache=l;var B=t("../Settings"),w=t("../util/common"),S=(t("../util/Timer"),t("../common/stats")),C=t("../common/Math"),M=t("../common/Vec2"),I=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),P=(t("../common/Sweep"),t("../common/Transform"));t("../common/Velocity"),t("../common/Position");function h(){this.proxyA=new o,this.proxyB=new o,this.transformA=null,this.transformB=null,this.useRadii=!1}function c(){this.pointA=M.zero(),this.pointB=M.zero(),this.distance,this.iterations}function l(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}function u(t,i,e){++S.gjkCalls;var o=e.proxyA,s=e.proxyB,n=e.transformA,r=e.transformB;b&&w.debug("cahce:",i.metric,i.count),b&&w.debug("proxyA:",o.m_count),b&&w.debug("proxyB:",s.m_count),b&&w.debug("xfA:",n.p.x,n.p.y,n.q.c,n.q.s),b&&w.debug("xfB:",r.p.x,r.p.y,r.q.c,r.q.s);var m=new T;m.readCache(i,o,n,s,r),b&&w.debug("cache",m.print());for(var a=m.m_v,h=B.maxDistnceIterations,c=[],_=[],l=0,u=0;u<h;){l=m.m_count;for(var p=0;p<l;++p)c[p]=a[p].indexA,_[p]=a[p].indexB;if(m.solve(),3==m.m_count)break;(A=m.getClosestPoint()).lengthSquared();var d=m.getSearchDirection();if(d.lengthSquared()<C.EPSILON*C.EPSILON)break;var y=a[m.m_count];y.indexA=o.getSupport(I.mulT(n.q,M.neg(d))),y.wA=P.mul(n,o.getVertex(y.indexA)),y.indexB=s.getSupport(I.mulT(r.q,d)),y.wB=P.mul(r,s.getVertex(y.indexB)),y.w=M.sub(y.wB,y.wA),++u,++S.gjkIters;var v=!1;for(p=0;p<l;++p)if(y.indexA==c[p]&&y.indexB==_[p]){v=!0;break}if(v)break;++m.m_count}if(S.gjkMaxIters=C.max(S.gjkMaxIters,u),m.getWitnessPoints(t.pointA,t.pointB),t.distance=M.distance(t.pointA,t.pointB),t.iterations=u,b&&w.debug("Distance:",t.distance,t.pointA.x,t.pointA.y,t.pointB.x,t.pointB.y),m.writeCache(i),e.useRadii){var f=o.m_radius,x=s.m_radius;if(t.distance>f+x&&t.distance>C.EPSILON){t.distance-=f+x;var g=M.sub(t.pointB,t.pointA);g.normalize(),t.pointA.wAdd(f,g),t.pointB.wSub(x,g)}else{var A=M.mid(t.pointA,t.pointB);t.pointA.set(A),t.pointB.set(A),t.distance=0}}}function o(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}function s(){this.indexA,this.indexB,this.wA=M.zero(),this.wB=M.zero(),this.w=M.zero(),this.a}function T(){this.m_v1=new s,this.m_v2=new s,this.m_v3=new s,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}S.gjkCalls=0,S.gjkIters=0,S.gjkMaxIters=0,o.prototype.getVertexCount=function(){return this.m_count},o.prototype.getVertex=function(t){return _&&w.assert(0<=t&&t<this.m_count),this.m_vertices[t]},o.prototype.getSupport=function(t){for(var i=0,e=M.dot(this.m_vertices[0],t),o=0;o<this.m_count;++o){var s=M.dot(this.m_vertices[o],t);e<s&&(i=o,e=s)}return i},o.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},o.prototype.set=function(t,i){_&&w.assert("function"==typeof t.computeDistanceProxy),t.computeDistanceProxy(this,i)},s.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.wA=M.clone(t.wA),this.wB=M.clone(t.wB),this.w=M.clone(t.w),this.a=t.a},T.prototype.print=function(){return 3==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},T.prototype.readCache=function(t,i,e,o,s){_&&w.assert(t.count<=3),this.m_count=t.count;for(var n=0;n<this.m_count;++n){(c=this.m_v[n]).indexA=t.indexA[n],c.indexB=t.indexB[n];var r=i.getVertex(c.indexA),m=o.getVertex(c.indexB);c.wA=P.mul(e,r),c.wB=P.mul(s,m),c.w=M.sub(c.wB,c.wA),c.a=0}if(1<this.m_count){var a=t.metric,h=this.getMetric();(h<.5*a||2*a<h||h<C.EPSILON)&&(this.m_count=0)}if(0==this.m_count){var c;(c=this.m_v[0]).indexA=0,c.indexB=0;r=i.getVertex(0),m=o.getVertex(0);c.wA=P.mul(e,r),c.wB=P.mul(s,m),c.w=M.sub(c.wB,c.wA),c.a=1,this.m_count=1}},T.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var i=0;i<this.m_count;++i)t.indexA[i]=this.m_v[i].indexA,t.indexB[i]=this.m_v[i].indexB},T.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return M.neg(this.m_v1.w);case 2:var t=M.sub(this.m_v2.w,this.m_v1.w);return 0<M.cross(t,M.neg(this.m_v1.w))?M.cross(1,t):M.cross(t,1);default:return _&&w.assert(!1),M.zero()}},T.prototype.getClosestPoint=function(){switch(this.m_count){case 0:return _&&w.assert(!1),M.zero();case 1:return M.clone(this.m_v1.w);case 2:return M.wAdd(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:return M.zero();default:return _&&w.assert(!1),M.zero()}},T.prototype.getWitnessPoints=function(t,i){switch(this.m_count){case 0:_&&w.assert(!1);break;case 1:b&&w.debug("case1",this.print()),t.set(this.m_v1.wA),i.set(this.m_v1.wB);break;case 2:b&&w.debug("case2",this.print()),t.wSet(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),i.wSet(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:b&&w.debug("case3",this.print()),t.wSet(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.wAdd(this.m_v3.a,this.m_v3.wA),i.set(t);break;default:_&&w.assert(!1)}},T.prototype.getMetric=function(){switch(this.m_count){case 0:return _&&w.assert(!1),0;case 1:return 0;case 2:return M.distance(this.m_v1.w,this.m_v2.w);case 3:return M.cross(M.sub(this.m_v2.w,this.m_v1.w),M.sub(this.m_v3.w,this.m_v1.w));default:return _&&w.assert(!1),0}},T.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break;default:_&&w.assert(!1)}},T.prototype.solve2=function(){var t=this.m_v1.w,i=this.m_v2.w,e=M.sub(i,t),o=-M.dot(t,e);if(o<=0)return this.m_v1.a=1,void(this.m_count=1);var s=M.dot(i,e);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var n=1/(s+o);this.m_v1.a=s*n,this.m_v2.a=o*n,this.m_count=2},T.prototype.solve3=function(){var t=this.m_v1.w,i=this.m_v2.w,e=this.m_v3.w,o=M.sub(i,t),s=M.dot(t,o),n=M.dot(i,o),r=-s,m=M.sub(e,t),a=M.dot(t,m),h=M.dot(e,m),c=-a,_=M.sub(e,i),l=M.dot(i,_),u=M.dot(e,_),p=-l,d=M.cross(o,m),y=d*M.cross(i,e),v=d*M.cross(e,t),f=d*M.cross(t,i);if(r<=0&&c<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<n&&0<r&&f<=0){var x=1/(n+r);return this.m_v1.a=n*x,this.m_v2.a=r*x,void(this.m_count=2)}if(0<h&&0<c&&v<=0){var g=1/(h+c);return this.m_v1.a=h*g,this.m_v3.a=c*g,this.m_count=2,void this.m_v2.set(this.m_v3)}if(n<=0&&p<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(h<=0&&u<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(0<u&&0<p&&y<=0){var A=1/(u+p);return this.m_v2.a=u*A,this.m_v3.a=p*A,this.m_count=2,void this.m_v1.set(this.m_v3)}var b=1/(y+v+f);this.m_v1.a=y*b,this.m_v2.a=v*b,this.m_v3.a=f*b,this.m_count=3},u.testOverlap=function(t,i,e,o,s,n){var r=new h;r.proxyA.set(t,i),r.proxyB.set(e,o),r.transformA=s,r.transformB=n,r.useRadii=!0;var m=new l,a=new c;return u(a,m,r),a.distance<10*C.EPSILON}},{"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../common/stats":26,"../util/Timer":49,"../util/common":50}],14:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===v)var v=!1;var s=t("../Settings"),f=t("../util/common"),n=t("../util/Pool"),y=t("../common/Vec2"),x=t("../common/Math"),g=t("./AABB");function r(t){this.id=t,this.aabb=new g,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.toString=function(){return this.id+": "+this.userData}}function m(){this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new n({create:function(){return new r}})}i.exports=m,r.prototype.isLeaf=function(){return null==this.child1},m.prototype.getUserData=function(t){var i=this.m_nodes[t];return v&&f.assert(!!i),i.userData},m.prototype.getFatAABB=function(t){var i=this.m_nodes[t];return v&&f.assert(!!i),i.aabb},m.prototype.allocateNode=function(){var t=this.m_pool.allocate();return t.id=++this.m_lastProxyId,t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,this.m_nodes[t.id]=t},m.prototype.freeNode=function(t){this.m_pool.release(t),t.height=-1,delete this.m_nodes[t.id]},m.prototype.createProxy=function(t,i){v&&f.assert(g.isValid(t));var e=this.allocateNode();return e.aabb.set(t),g.extend(e.aabb,s.aabbExtension),e.userData=i,e.height=0,this.insertLeaf(e),e.id},m.prototype.destroyProxy=function(t){var i=this.m_nodes[t];v&&f.assert(!!i),v&&f.assert(i.isLeaf()),this.removeLeaf(i),this.freeNode(i)},m.prototype.moveProxy=function(t,i,e){v&&f.assert(g.isValid(i)),v&&f.assert(!e||y.isValid(e));var o=this.m_nodes[t];return v&&f.assert(!!o),v&&f.assert(o.isLeaf()),!o.aabb.contains(i)&&(this.removeLeaf(o),o.aabb.set(i),i=o.aabb,g.extend(i,s.aabbExtension),e.x<0?i.lowerBound.x+=e.x*s.aabbMultiplier:i.upperBound.x+=e.x*s.aabbMultiplier,e.y<0?i.lowerBound.y+=e.y*s.aabbMultiplier:i.upperBound.y+=e.y*s.aabbMultiplier,this.insertLeaf(o),!0)},m.prototype.insertLeaf=function(t){if(v&&f.assert(g.isValid(t.aabb)),null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var i=t.aabb,e=this.m_root;0==e.isLeaf();){var o=e.child1,s=e.child2,n=e.aabb.getPerimeter(),r=new g;r.combine(e.aabb,i);var m,a,h=r.getPerimeter(),c=2*h,_=2*(h-n);if(o.isLeaf()){(u=new g).combine(i,o.aabb),m=u.getPerimeter()+_}else{(u=new g).combine(i,o.aabb);var l=o.aabb.getPerimeter();m=u.getPerimeter()-l+_}if(s.isLeaf()){(u=new g).combine(i,s.aabb),a=u.getPerimeter()+_}else{var u;(u=new g).combine(i,s.aabb);l=s.aabb.getPerimeter();a=u.getPerimeter()-l+_}if(c<m&&c<a)break;e=m<a?o:s}var p=e,d=p.parent,y=this.allocateNode();for(y.parent=d,y.userData=null,y.aabb.combine(i,p.aabb),y.height=p.height+1,null!=d?(d.child1==p?d.child1=y:d.child2=y,y.child1=p,y.child2=t,p.parent=y,t.parent=y):(y.child1=p,y.child2=t,p.parent=y,t.parent=y,this.m_root=y),e=t.parent;null!=e;){o=(e=this.balance(e)).child1,s=e.child2;v&&f.assert(null!=o),v&&f.assert(null!=s),e.height=1+x.max(o.height,s.height),e.aabb.combine(o.aabb,s.aabb),e=e.parent}},m.prototype.removeLeaf=function(t){if(t!=this.m_root){var i,e=t.parent,o=e.parent;if(i=e.child1==t?e.child2:e.child1,null!=o){o.child1==e?o.child1=i:o.child2=i,i.parent=o,this.freeNode(e);for(var s=o;null!=s;){var n=(s=this.balance(s)).child1,r=s.child2;s.aabb.combine(n.aabb,r.aabb),s.height=1+x.max(n.height,r.height),s=s.parent}}else(this.m_root=i).parent=null,this.freeNode(e)}else this.m_root=null},m.prototype.balance=function(t){v&&f.assert(null!=t);var i=t;if(i.isLeaf()||i.height<2)return t;var e=i.child1,o=i.child2,s=o.height-e.height;if(1<s){var n=o.child1,r=o.child2;return o.child1=i,o.parent=i.parent,null!=(i.parent=o).parent?o.parent.child1==t?o.parent.child1=o:o.parent.child2=o:this.m_root=o,n.height>r.height?(o.child2=n,((i.child2=r).parent=i).aabb.combine(e.aabb,r.aabb),o.aabb.combine(i.aabb,n.aabb),i.height=1+x.max(e.height,r.height),o.height=1+x.max(i.height,n.height)):(o.child2=r,((i.child2=n).parent=i).aabb.combine(e.aabb,n.aabb),o.aabb.combine(i.aabb,r.aabb),i.height=1+x.max(e.height,n.height),o.height=1+x.max(i.height,r.height)),o}if(s<-1){var m=e.child1,a=e.child2;return e.child1=i,e.parent=i.parent,null!=(i.parent=e).parent?e.parent.child1==i?e.parent.child1=e:e.parent.child2=e:this.m_root=e,m.height>a.height?(e.child2=m,((i.child1=a).parent=i).aabb.combine(o.aabb,a.aabb),e.aabb.combine(i.aabb,m.aabb),i.height=1+x.max(o.height,a.height),e.height=1+x.max(i.height,m.height)):(e.child2=a,((i.child1=m).parent=i).aabb.combine(o.aabb,m.aabb),e.aabb.combine(i.aabb,a.aabb),i.height=1+x.max(o.height,m.height),e.height=1+x.max(i.height,a.height)),e}return i},m.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},m.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,i=this.m_root.aabb.getPerimeter(),e=0,o=B.allocate().preorder();t=o.next();)t.height<0||(e+=t.aabb.getPerimeter());return B.release(o),e/i},m.prototype.computeHeight=function(t){var i;if((i=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var e=ComputeHeight(i.child1),o=ComputeHeight(i.child2);return 1+x.max(e,o)},m.prototype.validateStructure=function(t){if(null!=t){t==this.m_root&&v&&f.assert(null==t.parent);var i=t.child1,e=t.child2;if(t.isLeaf())return v&&f.assert(null==i),v&&f.assert(null==e),void(v&&f.assert(0==t.height));v&&f.assert(i.parent==t),v&&f.assert(e.parent==t),this.validateStructure(i),this.validateStructure(e)}},m.prototype.validateMetrics=function(t){if(null!=t){var i=t.child1,e=t.child2;if(t.isLeaf())return v&&f.assert(null==i),v&&f.assert(null==e),void(v&&f.assert(0==t.height));var o=this.m_nodes[i].height,s=this.m_nodes[e].height,n=1+x.max(o,s);v&&f.assert(t.height==n);var r=new g;r.combine(i.aabb,e.aabb),v&&f.assert(g.areEqual(r,t.aabb)),this.validateMetrics(i),this.validateMetrics(e)}},m.prototype.validate=function(){ValidateStructure(this.m_root),ValidateMetrics(this.m_root),v&&f.assert(this.getHeight()==this.computeHeight())},m.prototype.getMaxBalance=function(){for(var t,i=0,e=B.allocate().preorder();t=e.next();)if(!(t.height<=1)){v&&f.assert(0==t.isLeaf());var o=x.abs(t.child2.height-t.child1.height);i=x.max(i,o)}return B.release(e),i},m.prototype.rebuildBottomUp=function(){for(var t,i=[],e=0,o=B.allocate().preorder();t=o.next();)t.height<0||(t.isLeaf()?(t.parent=null,i[e]=t,++e):this.freeNode(t));for(B.release(o);1<e;){for(var s=1/0,n=-1,r=-1,m=0;m<e;++m)for(var a=i[m].aabb,h=m+1;h<e;++h){var c=i[h].aabb,_=new g;_.combine(a,c);var l=_.getPerimeter();l<s&&(n=m,r=h,s=l)}var u=i[n],p=i[r],d=this.allocateNode();d.child1=u,d.child2=p,d.height=1+x.max(u.height,p.height),d.aabb.combine(u.aabb,p.aabb),d.parent=null,u.parent=d,p.parent=d,i[r]=i[e-1],i[n]=d,--e}this.m_root=i[0],this.validate()},m.prototype.shiftOrigin=function(t){for(var i,e=B.allocate().preorder();i=e.next();){var o=i.aabb;o.lowerBound.x-=t.x,o.lowerBound.y-=t.y,o.lowerBound.x-=t.x,o.lowerBound.y-=t.y}B.release(e)},m.prototype.query=function(t,i){v&&f.assert("function"==typeof i);var e=b.allocate();for(e.push(this.m_root);0<e.length;){var o=e.pop();if(null!=o)if(g.testOverlap(o.aabb,t))if(o.isLeaf()){if(0==i(o.id))return}else e.push(o.child1),e.push(o.child2)}b.release(e)},m.prototype.rayCast=function(t,i){v&&f.assert("function"==typeof i);var e=t.p1,o=t.p2,s=y.sub(o,e);v&&f.assert(0<s.lengthSquared()),s.normalize();var n=y.cross(1,s),r=y.abs(n),m=t.maxFraction,a=new g,h=y.wAdd(1-m,e,m,o);a.combinePoints(e,h);var c=b.allocate(),_=A.allocate();for(c.push(this.m_root);0<c.length;){var l=c.pop();if(null!=l&&0!=g.testOverlap(l.aabb,a)){var u=l.aabb.getCenter(),p=l.aabb.getExtents();if(!(0<x.abs(y.dot(n,y.sub(e,u)))-y.dot(r,p)))if(l.isLeaf()){_.p1=y.clone(t.p1),_.p2=y.clone(t.p2),_.maxFraction=m;var d=i(_,l.id);if(0==d)return;0<d&&(m=d,h=y.wAdd(1-m,e,m,o),a.combinePoints(e,h))}else c.push(l.child1),c.push(l.child2)}}b.release(c),A.release(_)};var A=new n({create:function(){return{}},release:function(t){}}),b=new n({create:function(){return[]},release:function(t){t.length=0}}),B=new n({create:function(){return new a},release:function(t){t.close()}});function a(){var e=[],o=[];return{preorder:function(t){return e.length=0,e.push(t),o.length=0,o.push(0),this},next:function(){for(;0<e.length;){var t=e.length-1,i=e[t];if(0===o[t])return o[t]=1,i;if(1===o[t]&&(o[t]=2,i.child1))return e.push(i.child1),o.push(1),i.child1;if(2===o[t]&&(o[t]=3,i.child2))return e.push(i.child2),o.push(1),i.child2;e.pop(),o.pop()}},close:function(){e.length=0}}}},{"../Settings":7,"../common/Math":18,"../common/Vec2":23,"../util/Pool":48,"../util/common":50,"./AABB":11}],15:[function(t,i,e){if(void 0===V)var V=!1;if(void 0===z)var z=!1;i.exports=function(t,i){var e=q.now();++k.toiCalls,t.state=N.e_unknown,t.t=i.tMax;var o=i.proxyA,s=i.proxyB,n=i.sweepA,r=i.sweepB;V&&F.debug("sweepA",n.localCenter.x,n.localCenter.y,n.c.x,n.c.y,n.a,n.alpha0,n.c0.x,n.c0.y,n.a0),V&&F.debug("sweepB",r.localCenter.x,r.localCenter.y,r.c.x,r.c.y,r.a,r.alpha0,r.c0.x,r.c0.y,r.a0),n.normalize(),r.normalize();var m=i.tMax,a=o.m_radius+s.m_radius,h=D.max(L.linearSlop,a-3*L.linearSlop),c=.25*L.linearSlop;z&&F.assert(c<h);var _=0,l=L.maxTOIIterations,u=0,p=new O,d=new j;for(d.proxyA=i.proxyA,d.proxyB=i.proxyB,d.useRadii=!1;;){var y=R.identity(),v=R.identity();n.getTransform(y,_),r.getTransform(v,_),V&&F.debug("xfA:",y.p.x,y.p.y,y.q.c,y.q.s),V&&F.debug("xfB:",v.p.x,v.p.y,v.q.c,v.q.s),d.transformA=y,d.transformB=v;var f=new J;if(E(f,p,d),V&&F.debug("distance:",f.distance),f.distance<=0){t.state=N.e_overlapped,t.t=0;break}if(f.distance<h+c){t.state=N.e_touching,t.t=_;break}var x=new Y;x.initialize(p,o,n,s,r,_);for(var g=!1,A=m,b=0;;){var B=x.findMinSeparation(A);x.indexA,x.indexB;if(h+c<B){t.state=N.e_separated,t.t=m,g=!0;break}if(h-c<B){_=A;break}var w=x.evaluate(_);x.indexA,x.indexB;if(V&&F.debug("s1:",w,h,c,_),w<h-c){t.state=N.e_failed,t.t=_,g=!0;break}if(w<=h+c){t.state=N.e_touching,t.t=_,g=!0;break}for(var S=0,C=_,M=A;;){var I;I=1&S?C+(h-w)*(M-C)/(B-w):.5*(C+M),++S,++k.toiRootIters;var P=x.evaluate(I);x.indexA,x.indexB;if(D.abs(P-h)<c){A=I;break}if(h<P?(C=I,w=P):(M=I,B=P),50==S)break}if(k.toiMaxRootIters=D.max(k.toiMaxRootIters,S),++b==L.maxPolygonVertices)break}if(++u,++k.toiIters,g)break;if(u==l){t.state=N.e_failed,t.t=_;break}}k.toiMaxIters=D.max(k.toiMaxIters,u);var T=q.diff(e);k.toiMaxTime=D.max(k.toiMaxTime,T),k.toiTime+=T},i.exports.Input=function(){this.proxyA=new s,this.proxyB=new s,this.sweepA=new o,this.sweepB=new o,this.tMax},i.exports.Output=N;var L=t("../Settings"),F=t("../util/common"),q=t("../util/Timer"),k=t("../common/stats"),D=t("../common/Math"),x=t("../common/Vec2"),g=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),o=t("../common/Sweep"),R=t("../common/Transform"),E=(t("../common/Velocity"),t("../common/Position"),t("./Distance")),j=E.Input,J=E.Output,s=E.Proxy,O=E.Cache;function N(){this.state,this.t}N.e_unknown=0,N.e_failed=1,N.e_overlapped=2,N.e_touching=3,N.e_separated=4,k.toiTime=0,k.toiMaxTime=0,k.toiCalls=0,k.toiIters=0,k.toiMaxIters=0,k.toiRootIters=0,k.toiMaxRootIters=0;function Y(){this.m_proxyA=new s,this.m_proxyB=new s,this.m_sweepA,this.m_sweepB,this.m_type,this.m_localPoint=x.zero(),this.m_axis=x.zero()}Y.prototype.initialize=function(t,i,e,o,s,n){this.m_proxyA=i,this.m_proxyB=o;var r=t.count;z&&F.assert(0<r&&r<3),this.m_sweepA=e,this.m_sweepB=s;var m=R.identity(),a=R.identity();if(this.m_sweepA.getTransform(m,n),this.m_sweepB.getTransform(a,n),1==r){this.m_type=1;var h=this.m_proxyA.getVertex(t.indexA[0]),c=this.m_proxyB.getVertex(t.indexB[0]),_=R.mul(m,h),l=R.mul(a,c);return this.m_axis.wSet(1,l,-1,_),f=this.m_axis.normalize()}if(t.indexA[0]==t.indexA[1]){this.m_type=3;var u=o.getVertex(t.indexB[0]),p=o.getVertex(t.indexB[1]);this.m_axis=x.cross(x.sub(p,u),1),this.m_axis.normalize();var d=g.mul(a.q,this.m_axis);this.m_localPoint=x.mid(u,p);l=R.mul(a,this.m_localPoint),h=i.getVertex(t.indexA[0]),_=R.mul(m,h);return(f=x.dot(_,d)-x.dot(l,d))<0&&(this.m_axis=x.neg(this.m_axis),f=-f),f}this.m_type=2;var y=this.m_proxyA.getVertex(t.indexA[0]),v=this.m_proxyA.getVertex(t.indexA[1]);this.m_axis=x.cross(x.sub(v,y),1),this.m_axis.normalize();d=g.mul(m.q,this.m_axis);this.m_localPoint=x.mid(y,v);var f;_=R.mul(m,this.m_localPoint),c=this.m_proxyB.getVertex(t.indexB[0]),l=R.mul(a,c);return(f=x.dot(l,d)-x.dot(_,d))<0&&(this.m_axis=x.neg(this.m_axis),f=-f),f},Y.prototype.compute=function(t,i){var e=R.identity(),o=R.identity();switch(this.m_sweepA.getTransform(e,i),this.m_sweepB.getTransform(o,i),this.m_type){case 1:if(t){var s=g.mulT(e.q,this.m_axis),n=g.mulT(o.q,x.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(s),this.indexB=this.m_proxyB.getSupport(n)}var r=this.m_proxyA.getVertex(this.indexA),m=this.m_proxyB.getVertex(this.indexB),a=R.mul(e,r),h=R.mul(o,m);return x.dot(h,this.m_axis)-x.dot(a,this.m_axis);case 2:var c=g.mul(e.q,this.m_axis);a=R.mul(e,this.m_localPoint);if(t){n=g.mulT(o.q,x.neg(c));this.indexA=-1,this.indexB=this.m_proxyB.getSupport(n)}m=this.m_proxyB.getVertex(this.indexB),h=R.mul(o,m);return x.dot(h,c)-x.dot(a,c);case 3:c=g.mul(o.q,this.m_axis),h=R.mul(o,this.m_localPoint);if(t){s=g.mulT(e.q,x.neg(c));this.indexB=-1,this.indexA=this.m_proxyA.getSupport(s)}r=this.m_proxyA.getVertex(this.indexA),a=R.mul(e,r);return x.dot(a,c)-x.dot(h,c);default:return z&&F.assert(!1),t&&(this.indexA=-1,this.indexB=-1),0}},Y.prototype.findMinSeparation=function(t){return this.compute(!0,t)},Y.prototype.evaluate=function(t){return this.compute(!1,t)}},{"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../common/stats":26,"../util/Timer":49,"../util/common":50,"./Distance":13}],16:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===m)var m=!1;i.exports=r;var s=t("../util/common"),a=(t("./Math"),t("./Vec2"));function r(t,i,e,o){this.ey="object"==typeof t&&null!==t?(this.ex=a.clone(t),a.clone(i)):"number"==typeof t?(this.ex=a.neo(t,e),a.neo(i,o)):(this.ex=a.zero(),a.zero())}r.prototype.toString=function(){return JSON.stringify(this)},r.isValid=function(t){return t&&a.isValid(t.ex)&&a.isValid(t.ey)},r.assert=function(t){if(m&&!r.isValid(t))throw o&&s.debug(t),new Error("Invalid Mat22!")},r.prototype.set=function(t,i,e,o){"number"==typeof t&&"number"==typeof i&&"number"==typeof e&&"number"==typeof o?(this.ex.set(t,e),this.ey.set(i,o)):"object"==typeof t&&"object"==typeof i?(this.ex.set(t),this.ey.set(i)):"object"==typeof t?(m&&r.assert(t),this.ex.set(t.ex),this.ey.set(t.ey)):m&&s.assert(!1)},r.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},r.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},r.prototype.getInverse=function(){var t=this.ex.x,i=this.ey.x,e=this.ex.y,o=this.ey.y,s=t*o-i*e;0!=s&&(s=1/s);var n=new r;return n.ex.x=s*o,n.ey.x=-s*i,n.ex.y=-s*e,n.ey.y=s*t,n},r.prototype.solve=function(t){m&&a.assert(t);var i=this.ex.x,e=this.ey.x,o=this.ex.y,s=this.ey.y,n=i*s-e*o;0!=n&&(n=1/n);var r=a.zero();return r.x=n*(s*t.x-e*t.y),r.y=n*(i*t.y-o*t.x),r},r.mul=function(t,i){if(i&&"x"in i&&"y"in i){m&&a.assert(i);var e=t.ex.x*i.x+t.ey.x*i.y,o=t.ex.y*i.x+t.ey.y*i.y;return a.neo(e,o)}if(i&&"ex"in i&&"ey"in i)return m&&r.assert(i),new r(a.mul(t,i.ex),a.mul(t,i.ey));m&&s.assert(!1)},r.mulT=function(t,i){return i&&"x"in i&&"y"in i?(m&&a.assert(i),a.neo(a.dot(i,t.ex),a.dot(i,t.ey))):i&&"ex"in i&&"ey"in i?(m&&r.assert(i),new r(a.neo(a.dot(t.ex,i.ex),a.dot(t.ey,i.ex)),a.neo(a.dot(t.ex,i.ey),a.dot(t.ey,i.ey)))):void(m&&s.assert(!1))},r.abs=function(t){return m&&r.assert(t),new r(a.abs(t.ex),a.abs(t.ey))},r.add=function(t,i){return m&&r.assert(t),m&&r.assert(i),new r(a.add(t.ex+i.ex),a.add(t.ey+i.ey))}},{"../util/common":50,"./Math":18,"./Vec2":23}],17:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===n)var n=!1;i.exports=h;var r=t("../util/common"),m=(t("./Math"),t("./Vec2")),a=t("./Vec3");function h(t,i,e){this.ez="object"==typeof t&&null!==t?(this.ex=a.clone(t),this.ey=a.clone(i),a.clone(e)):(this.ex=a(),this.ey=a(),a())}h.prototype.toString=function(){return JSON.stringify(this)},h.isValid=function(t){return t&&a.isValid(t.ex)&&a.isValid(t.ey)&&a.isValid(t.ez)},h.assert=function(t){if(n&&!h.isValid(t))throw o&&r.debug(t),new Error("Invalid Mat33!")},h.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},h.prototype.solve33=function(t){var i=a.dot(this.ex,a.cross(this.ey,this.ez));0!=i&&(i=1/i);var e=new a;return e.x=i*a.dot(t,a.cross(this.ey,this.ez)),e.y=i*a.dot(this.ex,a.cross(t,this.ez)),e.z=i*a.dot(this.ex,a.cross(this.ey,t)),e},h.prototype.solve22=function(t){var i=this.ex.x,e=this.ey.x,o=this.ex.y,s=this.ey.y,n=i*s-e*o;0!=n&&(n=1/n);var r=m.zero();return r.x=n*(s*t.x-e*t.y),r.y=n*(i*t.y-o*t.x),r},h.prototype.getInverse22=function(t){var i=this.ex.x,e=this.ey.x,o=this.ex.y,s=this.ey.y,n=i*s-e*o;0!=n&&(n=1/n),t.ex.x=n*s,t.ey.x=-n*e,t.ex.z=0,t.ex.y=-n*o,t.ey.y=n*i,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},h.prototype.getSymInverse33=function(t){var i=a.dot(this.ex,a.cross(this.ey,this.ez));0!=i&&(i=1/i);var e=this.ex.x,o=this.ey.x,s=this.ez.x,n=this.ey.y,r=this.ez.y,m=this.ez.z;t.ex.x=i*(n*m-r*r),t.ex.y=i*(s*r-o*m),t.ex.z=i*(o*r-s*n),t.ey.x=t.ex.y,t.ey.y=i*(e*m-s*s),t.ey.z=i*(s*o-e*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=i*(e*n-o*o)},h.mul=function(t,i){if(n&&h.assert(t),i&&"z"in i&&"y"in i&&"x"in i){n&&a.assert(i);var e=t.ex.x*i.x+t.ey.x*i.y+t.ez.x*i.z,o=t.ex.y*i.x+t.ey.y*i.y+t.ez.y*i.z,s=t.ex.z*i.x+t.ey.z*i.y+t.ez.z*i.z;return new a(e,o,s)}if(i&&"y"in i&&"x"in i){n&&m.assert(i);e=t.ex.x*i.x+t.ey.x*i.y,o=t.ex.y*i.x+t.ey.y*i.y;return m.neo(e,o)}n&&r.assert(!1)},h.add=function(t,i){return n&&h.assert(t),n&&h.assert(i),new a(t.x+i.x,t.y+i.y,t.z+i.z)}},{"../util/common":50,"./Math":18,"./Vec2":23,"./Vec3":24}],18:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;var n=t("../util/common"),r=t("../util/create"),m=Math,a=i.exports=r(m);a.EPSILON=1e-9,a.isFinite=function(t){return"number"==typeof t&&isFinite(t)&&!isNaN(t)},a.assert=function(t){if(s&&!a.isFinite(t))throw o&&n.debug(t),new Error("Invalid Number!")},a.invSqrt=function(t){return 1/m.sqrt(t)},a.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},a.isPowerOfTwo=function(t){return 0<t&&0==(t&t-1)},a.mod=function(t,i,e){return void 0===i?(e=1,i=0):void 0===e&&(e=i,i=0),i<e?(t=(t-i)%(e-i))+(t<0?e:i):(t=(t-e)%(i-e))+(t<=0?i:e)},a.clamp=function(t,i,e){return t<i?i:e<t?e:t},a.random=function(t,i){return void 0===t?(i=1,t=0):void 0===i&&(i=t,t=0),t==i?t:m.random()*(i-t)+t}},{"../util/common":50,"../util/create":51}],19:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=m;var n=t("./Vec2"),r=t("./Rot");function m(){this.c=n.zero(),this.a=0}m.prototype.getTransform=function(t,i){return t.q.set(this.a),t.p.set(n.sub(this.c,r.mul(t.q,i))),t}},{"./Rot":20,"./Vec2":23}],20:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=a;var n=t("../util/common"),r=t("./Vec2"),m=t("./Math");function a(t){if(!(this instanceof a))return new a(t);"number"==typeof t?this.setAngle(t):"object"==typeof t?this.set(t):this.setIdentity()}a.neo=function(t){var i=Object.create(a.prototype);return i.setAngle(t),i},a.clone=function(t){s&&a.assert(t);var i=Object.create(a.prototype);return i.s=t.s,i.c=t.c,i},a.identity=function(t){s&&a.assert(t);var i=Object.create(a.prototype);return i.s=0,i.c=1,i},a.isValid=function(t){return t&&m.isFinite(t.s)&&m.isFinite(t.c)},a.assert=function(t){if(s&&!a.isValid(t))throw o&&n.debug(t),new Error("Invalid Rot!")},a.prototype.setIdentity=function(){this.s=0,this.c=1},a.prototype.set=function(t){this.c="object"==typeof t?(s&&a.assert(t),this.s=t.s,t.c):(s&&m.assert(t),this.s=m.sin(t),m.cos(t))},a.prototype.setAngle=function(t){s&&m.assert(t),this.s=m.sin(t),this.c=m.cos(t)},a.prototype.getAngle=function(){return m.atan2(this.s,this.c)},a.prototype.getXAxis=function(){return r.neo(this.c,this.s)},a.prototype.getYAxis=function(){return r.neo(-this.s,this.c)},a.mul=function(t,i){if(s&&a.assert(t),"c"in i&&"s"in i){s&&a.assert(i);var e=a.identity();return e.s=t.s*i.c+t.c*i.s,e.c=t.c*i.c-t.s*i.s,e}if("x"in i&&"y"in i)return s&&r.assert(i),r.neo(t.c*i.x-t.s*i.y,t.s*i.x+t.c*i.y)},a.mulSub=function(t,i,e){var o=t.c*(i.x-e.x)-t.s*(i.y-e.y),s=t.s*(i.x-e.y)+t.c*(i.y-e.y);return r.neo(o,s)},a.mulT=function(t,i){if("c"in i&&"s"in i){s&&a.assert(i);var e=a.identity();return e.s=t.c*i.s-t.s*i.c,e.c=t.c*i.c+t.s*i.s,e}if("x"in i&&"y"in i)return s&&r.assert(i),r.neo(t.c*i.x+t.s*i.y,-t.s*i.x+t.c*i.y)}},{"../util/common":50,"./Math":18,"./Vec2":23}],21:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=c;var n=t("../util/common"),r=t("./Math"),m=t("./Vec2"),a=t("./Rot"),h=t("./Transform");function c(t,i){s&&n.assert(void 0===t),s&&n.assert(void 0===i),this.localCenter=m.zero(),this.c=m.zero(),this.a=0,this.alpha0=0,this.c0=m.zero(),this.a0=0}c.prototype.setTransform=function(t){var i=h.mul(t,this.localCenter);this.c.set(i),this.c0.set(i),this.a=t.q.getAngle(),this.a0=t.q.getAngle()},c.prototype.setLocalCenter=function(t,i){this.localCenter.set(t);var e=h.mul(i,this.localCenter);this.c.set(e),this.c0.set(e)},c.prototype.getTransform=function(t,i){i=void 0===i?0:i,t.q.setAngle((1-i)*this.a0+i*this.a),t.p.wSet(1-i,this.c0,i,this.c),t.p.sub(a.mul(t.q,this.localCenter))},c.prototype.advance=function(t){s&&n.assert(this.alpha0<1);var i=(t-this.alpha0)/(1-this.alpha0);this.c0.wSet(i,this.c,1-i,this.c0),this.a0=i*this.a+(1-i)*this.a0,this.alpha0=t},c.prototype.forward=function(){this.a0=this.a,this.c0.set(this.c)},c.prototype.normalize=function(){var t=r.mod(this.a0,-r.PI,+r.PI);this.a-=this.a0-t,this.a0=t},c.prototype.clone=function(){var t=new c;return t.localCenter.set(this.localCenter),t.alpha0=this.alpha0,t.a0=this.a0,t.a=this.a,t.c0.set(this.c0),t.c.set(this.c),t},c.prototype.set=function(t){this.localCenter.set(t.localCenter),this.alpha0=t.alpha0,this.a0=t.a0,this.a=t.a,this.c0.set(t.c0),this.c.set(t.c)}},{"../util/common":50,"./Math":18,"./Rot":20,"./Transform":22,"./Vec2":23}],22:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===m)var m=!1;i.exports=c;var s=t("../util/common"),a=t("./Vec2"),h=t("./Rot");function c(t,i){if(!(this instanceof c))return new c(t,i);this.p=a.zero(),this.q=h.identity(),void 0!==t&&this.p.set(t),void 0!==i&&this.q.set(i)}c.clone=function(t){var i=Object.create(c.prototype);return i.p=a.clone(t.p),i.q=h.clone(t.q),i},c.neo=function(t,i){var e=Object.create(c.prototype);return e.p=a.clone(t),e.q=h.clone(i),e},c.identity=function(){var t=Object.create(c.prototype);return t.p=a.zero(),t.q=h.identity(),t},c.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},c.prototype.set=function(t,i){c.isValid(t)?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(i))},c.isValid=function(t){return t&&a.isValid(t.p)&&h.isValid(t.q)},c.assert=function(t){if(m&&!c.isValid(t))throw o&&s.debug(t),new Error("Invalid Transform!")},c.mul=function(t,i){if(m&&c.assert(t),Array.isArray(i)){for(var e=[],o=0;o<i.length;o++)e[o]=c.mul(t,i[o]);return e}if("x"in i&&"y"in i){m&&a.assert(i);var s=t.q.c*i.x-t.q.s*i.y+t.p.x,n=t.q.s*i.x+t.q.c*i.y+t.p.y;return a.neo(s,n)}if("p"in i&&"q"in i){m&&c.assert(i);var r=c.identity();return r.q=h.mul(t.q,i.q),r.p=a.add(h.mul(t.q,i.p),t.p),r}},c.mulT=function(t,i){if(m&&c.assert(t),"x"in i&&"y"in i){m&&a.assert(i);var e=i.x-t.p.x,o=i.y-t.p.y,s=t.q.c*e+t.q.s*o,n=-t.q.s*e+t.q.c*o;return a.neo(s,n)}if("p"in i&&"q"in i){m&&c.assert(i);var r=c.identity();return r.q.set(h.mulT(t.q,i.q)),r.p.set(h.mulT(t.q,a.sub(i.p,t.p))),r}}},{"../util/common":50,"./Rot":20,"./Vec2":23}],23:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===r)var r=!1;i.exports=a;var s=t("../util/common"),m=t("./Math");function a(t,i){if(!(this instanceof a))return new a(t,i);this.y=void 0===t?this.x=0:"object"==typeof t?(this.x=t.x,t.y):(this.x=t,i),r&&a.assert(this)}a.zero=function(){var t=Object.create(a.prototype);return t.x=0,t.y=0,t},a.neo=function(t,i){var e=Object.create(a.prototype);return e.x=t,e.y=i,e},a.clone=function(t,i){return r&&a.assert(t),r&&s.assert(!i),a.neo(t.x,t.y)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&m.isFinite(t.x)&&m.isFinite(t.y)},a.assert=function(t){if(r&&!a.isValid(t))throw o&&s.debug(t),new Error("Invalid Vec2!")},a.prototype.clone=function(t){return a.clone(this,t)},a.prototype.setZero=function(){return this.x=0,this.y=0,this},a.prototype.set=function(t,i){return this.y="object"==typeof t?(r&&a.assert(t),this.x=t.x,t.y):(r&&m.assert(t),r&&m.assert(i),this.x=t,i),this},a.prototype.wSet=function(t,i,e,o){r&&m.assert(t),r&&a.assert(i);var s=t*i.x,n=t*i.y;return void 0===e&&void 0===o||(r&&m.assert(e),r&&a.assert(o),s+=e*o.x,n+=e*o.y),this.x=s,this.y=n,this},a.prototype.add=function(t){return r&&a.assert(t),this.x+=t.x,this.y+=t.y,this},a.prototype.wAdd=function(t,i,e,o){r&&m.assert(t),r&&a.assert(i);var s=t*i.x,n=t*i.y;return void 0===e&&void 0===o||(r&&m.assert(e),r&&a.assert(o),s+=e*o.x,n+=e*o.y),this.x+=s,this.y+=n,this},a.prototype.wSub=function(t,i,e,o){r&&m.assert(t),r&&a.assert(i);var s=t*i.x,n=t*i.y;return void 0===e&&void 0===o||(r&&m.assert(e),r&&a.assert(o),s+=e*o.x,n+=e*o.y),this.x-=s,this.y-=n,this},a.prototype.sub=function(t){return r&&a.assert(t),this.x-=t.x,this.y-=t.y,this},a.prototype.mul=function(t){return r&&m.assert(t),this.x*=t,this.y*=t,this},a.prototype.length=function(){return a.lengthOf(this)},a.prototype.lengthSquared=function(){return a.lengthSquared(this)},a.prototype.normalize=function(){var t=this.length();if(t<m.EPSILON)return 0;var i=1/t;return this.x*=i,this.y*=i,t},a.lengthOf=function(t){return r&&a.assert(t),m.sqrt(t.x*t.x+t.y*t.y)},a.lengthSquared=function(t){return r&&a.assert(t),t.x*t.x+t.y*t.y},a.distance=function(t,i){r&&a.assert(t),r&&a.assert(i);var e=t.x-i.x,o=t.y-i.y;return m.sqrt(e*e+o*o)},a.distanceSquared=function(t,i){r&&a.assert(t),r&&a.assert(i);var e=t.x-i.x,o=t.y-i.y;return e*e+o*o},a.areEqual=function(t,i){return r&&a.assert(t),r&&a.assert(i),t==i||"object"==typeof i&&null!==i&&t.x==i.x&&t.y==i.y},a.skew=function(t){return r&&a.assert(t),a.neo(-t.y,t.x)},a.dot=function(t,i){return r&&a.assert(t),r&&a.assert(i),t.x*i.x+t.y*i.y},a.cross=function(t,i){return"number"==typeof i?(r&&a.assert(t),r&&m.assert(i),a.neo(i*t.y,-i*t.x)):"number"==typeof t?(r&&m.assert(t),r&&a.assert(i),a.neo(-t*i.y,t*i.x)):(r&&a.assert(t),r&&a.assert(i),t.x*i.y-t.y*i.x)},a.addCross=function(t,i,e){return"number"==typeof e?(r&&a.assert(i),r&&m.assert(e),a.neo(e*i.y+t.x,-e*i.x+t.y)):"number"==typeof i?(r&&m.assert(i),r&&a.assert(e),a.neo(-i*e.y+t.x,i*e.x+t.y)):void(r&&s.assert(!1))},a.add=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(t.x+i.x,t.y+i.y)},a.wAdd=function(t,i,e,o){var s=a.zero();return s.wAdd(t,i,e,o),s},a.sub=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(t.x-i.x,t.y-i.y)},a.mul=function(t,i){return"object"==typeof t?(r&&a.assert(t),r&&m.assert(i),a.neo(t.x*i,t.y*i)):"object"==typeof i?(r&&m.assert(t),r&&a.assert(i),a.neo(t*i.x,t*i.y)):void 0},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},a.neg=function(t){return r&&a.assert(t),a.neo(-t.x,-t.y)},a.abs=function(t){return r&&a.assert(t),a.neo(m.abs(t.x),m.abs(t.y))},a.mid=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(.5*(t.x+i.x),.5*(t.y+i.y))},a.upper=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(m.max(t.x,i.x),m.max(t.y,i.y))},a.lower=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(m.min(t.x,i.x),m.min(t.y,i.y))},a.prototype.clamp=function(t){var i=this.x*this.x+this.y*this.y;if(t*t<i){var e=m.invSqrt(i);this.x*=e*t,this.y*=e*t}return this},a.clamp=function(t,i){return(t=a.neo(t.x,t.y)).clamp(i),t}},{"../util/common":50,"./Math":18}],24:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=m;var n=t("../util/common"),r=t("./Math");function m(t,i,e){if(!(this instanceof m))return new m(t,i,e);this.z=void 0===t?(this.x=0,this.y=0):"object"==typeof t?(this.x=t.x,this.y=t.y,t.z):(this.x=t,this.y=i,e),s&&m.assert(this)}m.prototype.toString=function(){return JSON.stringify(this)},m.isValid=function(t){return t&&r.isFinite(t.x)&&r.isFinite(t.y)&&r.isFinite(t.z)},m.assert=function(t){if(s&&!m.isValid(t))throw o&&n.debug(t),new Error("Invalid Vec3!")},m.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},m.prototype.set=function(t,i,e){return this.x=t,this.y=i,this.z=e,this},m.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},m.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},m.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},m.areEqual=function(t,i){return t==i||"object"==typeof i&&null!==i&&t.x==i.x&&t.y==i.y&&t.z==i.z},m.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},m.cross=function(t,i){return new m(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)},m.add=function(t,i){return new m(t.x+i.x,t.y+i.y,t.z+i.z)},m.sub=function(t,i){return new m(t.x-i.x,t.y-i.y,t.z-i.z)},m.mul=function(t,i){return new m(i*t.x,i*t.y,i*t.z)},m.prototype.neg=function(t){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},m.neg=function(t){return new m(-t.x,-t.y,-t.z)}},{"../util/common":50,"./Math":18}],25:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=function(){this.v=n.zero(),this.w=0};var n=t("./Vec2")},{"./Vec2":23}],26:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;e.toString=function(t){t="string"==typeof t?t:"\n";var i="";for(var e in this)"function"!=typeof this[e]&&"object"!=typeof this[e]&&(i+=e+": "+this[e]+t);return i}},{}],27:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=h;var n=t("../util/options"),r=t("../util/create"),A=t("../Settings"),b=t("../common/Math"),B=t("../common/Vec2"),w=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),m=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));h.TYPE="distance-joint",h.prototype=r((h._super=m).prototype);var a={frequencyHz:0,dampingRatio:0};function h(t,i,e,o,s){if(!(this instanceof h))return new h(t,i,e,o,s);t=n(t,a),m.call(this,t,i,o),this.m_type=h.TYPE,this.m_localAnchorA=t.localAnchorA||i.getLocalPoint(e),this.m_localAnchorB=t.localAnchorB||o.getLocalPoint(s),this.m_length=B.distance(s,e),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}h.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},h.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},h.prototype.setLength=function(t){this.m_length=t},h.prototype.getLength=function(){return this.m_length},h.prototype.setFrequency=function(t){this.m_frequencyHz=t},h.prototype.getFrequency=function(){return this.m_frequencyHz},h.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},h.prototype.getDampingRatio=function(){return this.m_dampingRatio},h.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},h.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},h.prototype.getReactionForce=function(t){return B.mul(t*this.m_impulse,this.m_u)},h.prototype.getReactionTorque=function(t){return 0},h.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=w.neo(e),c=w.neo(r);this.m_rA=w.mul(h,B.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=w.mul(c,B.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=B.sub(B.add(n,this.m_rB),B.add(i,this.m_rA));var _=this.m_u.length();_>A.linearSlop?this.m_u.mul(1/_):this.m_u.set(0,0);var l=B.cross(this.m_rA,this.m_u),u=B.cross(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,0<this.m_frequencyHz){var d=_-this.m_length,y=2*b.PI*this.m_frequencyHz,v=2*this.m_mass*this.m_dampingRatio*y,f=this.m_mass*y*y,x=t.dt;this.m_gamma=x*(v+x*f),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*x*f*this.m_gamma,p+=this.m_gamma,this.m_mass=0!=p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var g=B.mul(this.m_impulse,this.m_u);o.wSub(this.m_invMassA,g),s-=this.m_invIA*B.cross(this.m_rA,g),m.wAdd(this.m_invMassB,g),a+=this.m_invIB*B.cross(this.m_rB,g)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=a},h.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=B.add(i,B.cross(e,this.m_rA)),r=B.add(o,B.cross(s,this.m_rB)),m=B.dot(this.m_u,r)-B.dot(this.m_u,n),a=-this.m_mass*(m+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;var h=B.mul(a,this.m_u);i.wSub(this.m_invMassA,h),e-=this.m_invIA*B.cross(this.m_rA,h),o.wAdd(this.m_invMassB,h),s+=this.m_invIB*B.cross(this.m_rB,h),this.m_bodyA.c_velocity.v.set(i),this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v.set(o),this.m_bodyB.c_velocity.w=s},h.prototype.solvePositionConstraints=function(t){if(0<this.m_frequencyHz)return!0;var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=w.neo(e),r=w.neo(s),m=w.mulSub(n,this.m_localAnchorA,this.m_localCenterA),a=w.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=B.sub(B.add(o,a),B.add(i,m)),c=h.normalize()-this.m_length;c=b.clamp(c,-A.maxLinearCorrection,A.maxLinearCorrection);var _=-this.m_mass*c,l=B.mul(_,h);return i.wSub(this.m_invMassA,l),e-=this.m_invIA*B.cross(m,l),o.wAdd(this.m_invMassB,l),s+=this.m_invIB*B.cross(a,l),this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(o),this.m_bodyB.c_position.a=s,b.abs(c)<A.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/create":51,"../util/options":52}],28:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=c;var n=t("../util/common"),r=t("../util/options"),m=t("../util/create"),p=(t("../Settings"),t("../common/Math")),d=t("../common/Vec2"),y=(t("../common/Vec3"),t("../common/Mat22")),v=(t("../common/Mat33"),t("../common/Rot")),a=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));c.TYPE="friction-joint",c.prototype=m((c._super=a).prototype);var h={maxForce:0,maxTorque:0};function c(t,i,e,o){if(!(this instanceof c))return new c(t,i,e,o);t=r(t,h),a.call(this,t,i,e),this.m_type=c.TYPE,this.m_localAnchorB=o?(this.m_localAnchorA=i.getLocalPoint(o),e.getLocalPoint(o)):(this.m_localAnchorA=d.zero(),d.zero()),this.m_linearImpulse=d.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.setMaxForce=function(t){s&&n.assert(IsValid(t)&&0<=t),this.m_maxForce=t},c.prototype.getMaxForce=function(){return this.m_maxForce},c.prototype.setMaxTorque=function(t){s&&n.assert(IsValid(t)&&0<=t),this.m_maxTorque=t},c.prototype.getMaxTorque=function(){return this.m_maxTorque},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(t){return t*this.m_linearImpulse},c.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},c.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=v.neo(i),a=v.neo(s);this.m_rA=v.mul(m,d.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=v.mul(a,d.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=new y;if(u.ex.x=h+c+_*this.m_rA.y*this.m_rA.y+l*this.m_rB.y*this.m_rB.y,u.ex.y=-_*this.m_rA.x*this.m_rA.y-l*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=h+c+_*this.m_rA.x*this.m_rA.x+l*this.m_rB.x*this.m_rB.x,this.m_linearMass=u.getInverse(),this.m_angularMass=_+l,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var p=d.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);e.wSub(h,p),o-=_*(d.cross(this.m_rA,p)+this.m_angularImpulse),n.wAdd(c,p),r+=l*(d.cross(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},c.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=t.dt,c=s-e,_=-this.m_angularMass*c,l=this.m_angularImpulse,u=h*this.m_maxTorque;this.m_angularImpulse=p.clamp(this.m_angularImpulse+_,-u,u),e-=m*(_=this.m_angularImpulse-l),s+=a*_;c=d.sub(d.add(o,d.cross(s,this.m_rB)),d.add(i,d.cross(e,this.m_rA))),_=d.neg(y.mul(this.m_linearMass,c)),l=this.m_linearImpulse;this.m_linearImpulse.add(_);u=h*this.m_maxForce;this.m_linearImpulse.lengthSquared()>u*u&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(u)),_=d.sub(this.m_linearImpulse,l),i.wSub(n,_),e-=m*d.cross(this.m_rA,_),o.wAdd(r,_),s+=a*d.cross(this.m_rB,_),this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},c.prototype.solvePositionConstraints=function(t){return!0}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],29:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===b)var b=!1;i.exports=I;var B=t("../util/common"),w=t("../util/options"),s=t("../util/create"),L=t("../Settings"),F=(t("../common/Math"),t("../common/Vec2")),q=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),S=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint")),k=t("./RevoluteJoint"),C=t("./PrismaticJoint");I.TYPE="gear-joint",I.prototype=s((I._super=S).prototype);var M={ratio:1};function I(t,i,e,o,s,n){if(!(this instanceof I))return new I(t,i,e,o,s,n);var r,m;t=w(t,M),S.call(this,t,i,e),this.m_type=I.TYPE,b&&B.assert(o.m_type==k.TYPE||o.m_type==C.TYPE),b&&B.assert(s.m_type==k.TYPE||s.m_type==C.TYPE),this.m_joint1=o,this.m_joint2=s,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType(),this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();var a=this.m_bodyA.m_xf,h=this.m_bodyA.m_sweep.a,c=this.m_bodyC.m_xf,_=this.m_bodyC.m_sweep.a;if(this.m_type1==k.TYPE){var l=o;this.m_localAnchorC=l.m_localAnchorA,this.m_localAnchorA=l.m_localAnchorB,this.m_referenceAngleA=l.m_referenceAngle,this.m_localAxisC=F.zero(),r=h-_-this.m_referenceAngleA}else{var u=o;this.m_localAnchorC=u.m_localAnchorA,this.m_localAnchorA=u.m_localAnchorB,this.m_referenceAngleA=u.m_referenceAngle,this.m_localAxisC=u.m_localXAxisA;var p=this.m_localAnchorC,d=q.mulT(c.q,F.add(q.mul(a.q,this.m_localAnchorA),F.sub(a.p,c.p)));r=F.dot(d,this.m_localAxisC)-F.dot(p,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();var y=this.m_bodyB.m_xf,v=this.m_bodyB.m_sweep.a,f=this.m_bodyD.m_xf,x=this.m_bodyD.m_sweep.a;if(this.m_type2==k.TYPE){l=s;this.m_localAnchorD=l.m_localAnchorA,this.m_localAnchorB=l.m_localAnchorB,this.m_referenceAngleB=l.m_referenceAngle,this.m_localAxisD=F.zero(),m=v-x-this.m_referenceAngleB}else{u=s;this.m_localAnchorD=u.m_localAnchorA,this.m_localAnchorB=u.m_localAnchorB,this.m_referenceAngleB=u.m_referenceAngle,this.m_localAxisD=u.m_localXAxisA;var g=this.m_localAnchorD,A=q.mulT(f.q,F.add(q.mul(y.q,this.m_localAnchorB),F.sub(y.p,f.p)));m=F.dot(A,this.m_localAxisD)-F.dot(g,this.m_localAxisD)}this.m_ratio=n||t.ratio,this.m_constant=r+this.m_ratio*m,this.m_impulse=0,this.m_lcA,this.m_lcB,this.m_lcC,this.m_lcD,this.m_mA,this.m_mB,this.m_mC,this.m_mD,this.m_iA,this.m_iB,this.m_iC,this.m_iD,this.m_JvAC,this.m_JvBD,this.m_JwA,this.m_JwB,this.m_JwC,this.m_JwD,this.m_mass}I.prototype.getJoint1=function(){return this.m_joint1},I.prototype.getJoint2=function(){return this.m_joint2},I.prototype.setRatio=function(t){b&&B.assert(IsValid(t)),this.m_ratio=t},I.prototype.setRatio=function(){return this.m_ratio},I.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},I.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},I.prototype.getReactionForce=function(t){return t*(this.m_impulse*this.m_JvAC)},I.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},I.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=this.m_bodyC.c_position.a,a=this.m_bodyC.c_velocity.v,h=this.m_bodyC.c_velocity.w,c=this.m_bodyD.c_position.a,_=this.m_bodyD.c_velocity.v,l=this.m_bodyD.c_velocity.w,u=q.neo(i),p=q.neo(s),d=q.neo(m),y=q.neo(c);if(this.m_mass=0,this.m_type1==k.TYPE)this.m_JvAC=F.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var v=q.mul(d,this.m_localAxisC),f=q.mulSub(d,this.m_localAnchorC,this.m_lcC),x=q.mulSub(u,this.m_localAnchorA,this.m_lcA);this.m_JvAC=v,this.m_JwC=F.cross(f,v),this.m_JwA=F.cross(x,v),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==k.TYPE)this.m_JvBD=F.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{v=q.mul(y,this.m_localAxisD);var g=q.mulSub(y,this.m_localAnchorD,this.m_lcD),A=q.mulSub(p,this.m_localAnchorB,this.m_lcB);this.m_JvBD=F.mul(this.m_ratio,v),this.m_JwD=this.m_ratio*F.cross(g,v),this.m_JwB=this.m_ratio*F.cross(A,v),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=0<this.m_mass?1/this.m_mass:0,t.warmStarting?(e.wAdd(this.m_mA*this.m_impulse,this.m_JvAC),o+=this.m_iA*this.m_impulse*this.m_JwA,n.wAdd(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,a.wSub(this.m_mC*this.m_impulse,this.m_JvAC),h-=this.m_iC*this.m_impulse*this.m_JwC,_.wSub(this.m_mD*this.m_impulse,this.m_JvBD),l-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.set(a),this.m_bodyC.c_velocity.w=h,this.m_bodyD.c_velocity.v.set(_),this.m_bodyD.c_velocity.w=l},I.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,m=this.m_bodyD.c_velocity.v,a=this.m_bodyD.c_velocity.w,h=F.dot(this.m_JvAC,i)-F.dot(this.m_JvAC,n)+F.dot(this.m_JvBD,o)-F.dot(this.m_JvBD,m);h+=this.m_JwA*e-this.m_JwC*r+(this.m_JwB*s-this.m_JwD*a);var c=-this.m_mass*h;this.m_impulse+=c,i.wAdd(this.m_mA*c,this.m_JvAC),e+=this.m_iA*c*this.m_JwA,o.wAdd(this.m_mB*c,this.m_JvBD),s+=this.m_iB*c*this.m_JwB,n.wSub(this.m_mC*c,this.m_JvAC),r-=this.m_iC*c*this.m_JwC,m.wSub(this.m_mD*c,this.m_JvBD),a-=this.m_iD*c*this.m_JwD,this.m_bodyA.c_velocity.v.set(i),this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v.set(o),this.m_bodyB.c_velocity.w=s,this.m_bodyC.c_velocity.v.set(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.set(m),this.m_bodyD.c_velocity.w=a},I.prototype.solvePositionConstraints=function(t){var i,e,o,s,n,r,m,a,h=this.m_bodyA.c_position.c,c=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,u=this.m_bodyC.c_position.c,p=this.m_bodyC.c_position.a,d=this.m_bodyD.c_position.c,y=this.m_bodyD.c_position.a,v=q.neo(c),f=q.neo(l),x=q.neo(p),g=q.neo(y),A=0;if(this.m_type1==k.TYPE)o=F.zero(),m=n=1,A+=this.m_iA+this.m_iC,i=c-p-this.m_referenceAngleA;else{var b=q.mul(x,this.m_localAxisC),B=q.mulSub(x,this.m_localAnchorC,this.m_lcC),w=q.mulSub(v,this.m_localAnchorA,this.m_lcA);o=b,m=F.cross(B,b),n=F.cross(w,b),A+=this.m_mC+this.m_mA+this.m_iC*m*m+this.m_iA*n*n;var S=this.m_localAnchorC-this.m_lcC,C=q.mulT(x,F.add(w,F.sub(h,u)));i=Dot(C-S,this.m_localAxisC)}if(this.m_type2==k.TYPE)s=F.zero(),r=this.m_ratio,a=this.m_ratio,A+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),e=l-y-this.m_referenceAngleB;else{b=q.mul(g,this.m_localAxisD);var M=q.mulSub(g,this.m_localAnchorD,this.m_lcD),I=q.mulSub(f,this.m_localAnchorB,this.m_lcB);s=F.mul(this.m_ratio,b),a=this.m_ratio*F.cross(M,b),r=this.m_ratio*F.cross(I,b),A+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*r*r;var P=F.sub(this.m_localAnchorD,this.m_lcD),T=q.mulT(g,F.add(I,F.sub(_,d)));e=F.dot(T,this.m_localAxisD)-F.dot(P,this.m_localAxisD)}var V=i+this.m_ratio*e-this.m_constant,z=0;return 0<A&&(z=-V/A),h.wAdd(this.m_mA*z,o),c+=this.m_iA*z*n,_.wAdd(this.m_mB*z,s),l+=this.m_iB*z*r,u.wAdd(this.m_mC*z,o),p-=this.m_iC*z*m,d.wAdd(this.m_mD*z,s),y-=this.m_iD*z*a,this.m_bodyA.c_position.c.set(h),this.m_bodyA.c_position.a=c,this.m_bodyB.c_position.c.set(_),this.m_bodyB.c_position.a=l,this.m_bodyC.c_position.c.set(u),this.m_bodyC.c_position.a=p,this.m_bodyD.c_position.c.set(d),this.m_bodyD.c_position.a=y,0<L.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52,"./PrismaticJoint":32,"./RevoluteJoint":34}],30:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=c;var n=t("../util/common"),r=t("../util/options"),m=t("../util/create"),d=(t("../Settings"),t("../common/Math")),v=t("../common/Vec2"),f=(t("../common/Vec3"),t("../common/Mat22")),x=(t("../common/Mat33"),t("../common/Rot")),a=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));c.TYPE="motor-joint",c.prototype=m((c._super=a).prototype);var h={maxForce:1,maxTorque:1,correctionFactor:.3};function c(t,i,e){if(!(this instanceof c))return new c(t,i,e);t=r(t,h),a.call(this,t,i,e),this.m_type=c.TYPE;var o=e.getPosition();this.m_linearOffset=i.getLocalPoint(o);var s=i.getAngle(),n=e.getAngle();this.m_angularOffset=n-s,this.m_linearImpulse=v.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_linearError,this.m_angularError,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}c.prototype.setMaxForce=function(t){s&&n.assert(IsValid(t)&&0<=t),this.m_maxForce=t},c.prototype.getMaxForce=function(){return this.m_maxForce},c.prototype.setMaxTorque=function(t){s&&n.assert(IsValid(t)&&0<=t),this.m_maxTorque=t},c.prototype.getMaxTorque=function(){return this.m_maxTorque},c.prototype.setCorrectionFactor=function(t){s&&n.assert(IsValid(t)&&0<=t&&t<=1),this.m_correctionFactor=t},c.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},c.prototype.setLinearOffset=function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=t)},c.prototype.getLinearOffset=function(){return this.m_linearOffset},c.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},c.prototype.getAngularOffset=function(){return this.m_angularOffset},c.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},c.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},c.prototype.getReactionForce=function(t){return t*this.m_linearImpulse},c.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},c.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=x.neo(e),c=x.neo(r);this.m_rA=x.mul(h,v.neg(this.m_localCenterA)),this.m_rB=x.mul(c,v.neg(this.m_localCenterB));var _=this.m_invMassA,l=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,d=new f;if(d.ex.x=_+l+u*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,d.ex.y=-u*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=_+l+u*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=d.getInverse(),this.m_angularMass=u+p,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=v.zero(),this.m_linearError.wAdd(1,n,1,this.m_rB),this.m_linearError.wSub(1,i,1,this.m_rA),this.m_linearError.sub(x.mul(h,this.m_linearOffset)),this.m_angularError=r-e-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var y=v.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);o.wSub(_,y),s-=u*(v.cross(this.m_rA,y)+this.m_angularImpulse),m.wAdd(l,y),a+=p*(v.cross(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=a},c.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=t.dt,c=t.inv_dt,_=s-e+c*this.m_correctionFactor*this.m_angularError,l=-this.m_angularMass*_,u=this.m_angularImpulse,p=h*this.m_maxTorque;this.m_angularImpulse=d.clamp(this.m_angularImpulse+l,-p,p),e-=m*(l=this.m_angularImpulse-u),s+=a*l,(_=v.zero()).wAdd(1,o,1,v.cross(s,this.m_rB)),_.wSub(1,i,1,v.cross(e,this.m_rA)),_.wAdd(c*this.m_correctionFactor,this.m_linearError);l=v.neg(f.mul(this.m_linearMass,_)),u=v.clone(this.m_linearImpulse);this.m_linearImpulse.add(l);p=h*this.m_maxForce;this.m_linearImpulse.clamp(p),l=v.sub(this.m_linearImpulse,u),i.wSub(n,l),e-=m*v.cross(this.m_rA,l),o.wAdd(r,l),s+=a*v.cross(this.m_rB,l),this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},c.prototype.solvePositionConstraints=function(t){return!0}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],31:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===p)var p=!1;i.exports=h;var d=t("../util/common"),s=t("../util/options"),n=t("../util/create"),y=t("../common/Math"),v=t("../common/Vec2"),f=(t("../common/Vec3"),t("../common/Mat22")),x=(t("../common/Mat33"),t("../common/Rot")),r=(t("../common/Sweep"),t("../common/Transform")),m=(t("../common/Velocity"),t("../common/Position"),t("../Joint"));h.TYPE="mouse-joint",h.prototype=n((h._super=m).prototype);var a={maxForce:0,frequencyHz:5,dampingRatio:.7};function h(t,i,e,o){if(!(this instanceof h))return new h(t,i,e,o);t=s(t,a),m.call(this,t,i,e),this.m_type=h.TYPE,p&&d.assert(y.isFinite(t.maxForce)&&0<=t.maxForce),p&&d.assert(y.isFinite(t.frequencyHz)&&0<=t.frequencyHz),p&&d.assert(y.isFinite(t.dampingRatio)&&0<=t.dampingRatio),this.m_targetA=v.clone(o),this.m_localAnchorB=r.mulT(this.m_bodyB.getTransform(),this.m_targetA),this.m_maxForce=t.maxForce,this.m_impulse=v.zero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=v.zero(),this.m_localCenterB=v.zero(),this.m_invMassB=0,this.m_invIB=0,this.mass=new f,this.m_C=v.zero()}h.prototype.setTarget=function(t){0==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_targetA=v.clone(t)},h.prototype.getTarget=function(){return this.m_targetA},h.prototype.setMaxForce=function(t){this.m_maxForce=t},h.getMaxForce=function(){return this.m_maxForce},h.prototype.setFrequency=function(t){this.m_frequencyHz=t},h.prototype.getFrequency=function(){return this.m_frequencyHz},h.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},h.prototype.getDampingRatio=function(){return this.m_dampingRatio},h.prototype.getAnchorA=function(){return v.clone(this.m_targetA)},h.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},h.prototype.getReactionForce=function(t){return v.mul(t,this.m_impulse)},h.prototype.getReactionTorque=function(t){return 0*t},h.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},h.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyB.c_position,e=this.m_bodyB.c_velocity,o=i.c,s=i.a,n=e.v,r=e.w,m=x.neo(s),a=this.m_bodyB.getMass(),h=2*y.PI*this.m_frequencyHz,c=2*a*this.m_dampingRatio*h,_=a*(h*h),l=t.dt;p&&d.assert(c+l*_>y.EPSILON),this.m_gamma=l*(c+l*_),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=l*_*this.m_gamma,this.m_rB=x.mul(m,v.sub(this.m_localAnchorB,this.m_localCenterB));var u=new f;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=u.getInverse(),this.m_C.set(o),this.m_C.wAdd(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),r*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),n.wAdd(this.m_invMassB,this.m_impulse),r+=this.m_invIB*v.cross(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),e.v.set(n),e.w=r},h.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyB.c_velocity,e=v.clone(i.v),o=i.w,s=v.cross(o,this.m_rB);s.add(e),s.wAdd(1,this.m_C,this.m_gamma,this.m_impulse),s.neg();var n=f.mul(this.m_mass,s),r=v.clone(this.m_impulse);this.m_impulse.add(n);var m=t.dt*this.m_maxForce;this.m_impulse.clamp(m),n=v.sub(this.m_impulse,r),e.wAdd(this.m_invMassB,n),o+=this.m_invIB*v.cross(this.m_rB,n),i.v.set(e),i.w=o},h.prototype.solvePositionConstraints=function(t){return!0}},{"../Joint":5,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],32:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=c;var n=t("../util/common"),r=t("../util/options"),m=t("../util/create"),J=t("../Settings"),O=t("../common/Math"),N=t("../common/Vec2"),Y=t("../common/Vec3"),W=t("../common/Mat22"),H=t("../common/Mat33"),Z=t("../common/Rot"),a=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint")),I=0;c.TYPE="prismatic-joint",c.prototype=m((c._super=a).prototype);var h={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};function c(t,i,e,o,s){if(!(this instanceof c))return new c(t,i,e,o,s);t=r(t,h),a.call(this,t,i,e),this.m_type=c.TYPE,this.m_localAnchorA=t.localAnchorA||i.getLocalPoint(o),this.m_localAnchorB=t.localAnchorB||e.getLocalPoint(o),this.m_localXAxisA=t.localAxisA||i.getLocalVector(s),this.m_localXAxisA.normalize(),this.m_localYAxisA=N.cross(1,this.m_localXAxisA),this.m_referenceAngle=e.getAngle()-i.getAngle(),this.m_impulse=Y(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=I,this.m_axis=N.zero(),this.m_perp=N.zero(),this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_axis,this.m_perp,this.m_s1,this.m_s2,this.m_a1,this.m_a2,this.m_K=new H,this.m_motorMass}c.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},c.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},c.prototype.getLocalAxisA=function(){return this.m_localXAxisA},c.prototype.getReferenceAngle=function(){return this.m_referenceAngle},c.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),i=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=N.sub(i,t),o=this.m_bodyA.getWorldVector(this.m_localXAxisA);return N.dot(e,o)},c.prototype.getJointSpeed=function(){var t=this.m_bodyA,i=this.m_bodyB,e=Mul(t.m_xf.q,this.m_localAnchorA-t.m_sweep.localCenter),o=Mul(i.m_xf.q,this.m_localAnchorB-i.m_sweep.localCenter),s=t.m_sweep.c+e,n=i.m_sweep.c+o-s,r=Mul(t.m_xf.q,this.m_localXAxisA),m=t.m_linearVelocity,a=i.m_linearVelocity,h=t.m_angularVelocity,c=i.m_angularVelocity;return Dot(n,Cross(h,r))+Dot(r,a+Cross(c,o)-m-Cross(h,e))},c.prototype.isLimitEnabled=function(){return this.m_enableLimit},c.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},c.prototype.getLowerLimit=function(){return this.m_lowerTranslation},c.prototype.getUpperLimit=function(){return this.m_upperTranslation},c.prototype.setLimits=function(t,i){s&&n.assert(t<=i),t==this.m_lowerTranslation&&i==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=i,this.m_impulse.z=0)},c.prototype.isMotorEnabled=function(){return this.m_enableMotor},c.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},c.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},c.prototype.setMaxMotorForce=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},c.prototype.getMotorSpeed=function(){return this.m_motorSpeed},c.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},c.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},c.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},c.prototype.getReactionForce=function(t){return t*(this.m_impulse.x*this.m_perp+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis)},c.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},c.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=Z.neo(e),c=Z.neo(r),_=Z.mul(h,N.sub(this.m_localAnchorA,this.m_localCenterA)),l=Z.mul(c,N.sub(this.m_localAnchorB,this.m_localCenterB)),u=N.zero();u.wAdd(1,n,1,l),u.wSub(1,i,1,_);var p=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,v=this.m_invIB;this.m_axis=Z.mul(h,this.m_localXAxisA),this.m_a1=N.cross(N.add(u,_),this.m_axis),this.m_a2=N.cross(l,this.m_axis),this.m_motorMass=p+d+y*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=Z.mul(h,this.m_localYAxisA),this.m_s1=N.cross(N.add(u,_),this.m_perp),this.m_s2=N.cross(l,this.m_perp);N.cross(_,this.m_perp);var f=p+d+y*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2,x=y*this.m_s1+v*this.m_s2,g=y*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2,A=y+v;0==A&&(A=1);var b=y*this.m_a1+v*this.m_a2,B=p+d+y*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2;if(this.m_K.ex.set(f,x,g),this.m_K.ey.set(x,A,b),this.m_K.ez.set(g,b,B),this.m_enableLimit){var w=N.dot(this.m_axis,u);O.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*J.linearSlop?this.m_limitState=3:w<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):w>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=I,this.m_impulse.z=0)}else this.m_limitState=I,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var S=N.wAdd(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,M=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;o.wSub(p,S),s-=y*C,m.wAdd(d,S),a+=v*M}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=a},c.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){var h=N.dot(this.m_axis,N.sub(o,i))+this.m_a2*s-this.m_a1*e,c=this.m_motorMass*(this.m_motorSpeed-h),_=this.m_motorImpulse,l=t.dt*this.m_maxMotorForce;this.m_motorImpulse=O.clamp(this.m_motorImpulse+c,-l,l),c=this.m_motorImpulse-_;var u=N.zero().wSet(c,this.m_axis),p=c*this.m_a1,d=c*this.m_a2;i.wSub(n,u),e-=m*p,o.wAdd(r,u),s+=a*d}var y=N.zero();if(y.x+=N.dot(this.m_perp,o)+this.m_s2*s,y.x-=N.dot(this.m_perp,i)+this.m_s1*e,y.y=s-e,this.m_enableLimit&&this.m_limitState!=I){var v=0;v+=N.dot(this.m_axis,o)+this.m_a2*s,v-=N.dot(this.m_axis,i)+this.m_a1*e;h=Y(y.x,y.y,v);var f=Y(this.m_impulse),x=this.m_K.solve33(Y.neg(h));this.m_impulse.add(x),1==this.m_limitState?this.m_impulse.z=O.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=O.min(this.m_impulse.z,0));var g=N.wAdd(-1,y,-(this.m_impulse.z-f.z),N.neo(this.m_K.ez.x,this.m_K.ez.y)),A=N.add(this.m_K.solve22(g),N.neo(f.x,f.y));this.m_impulse.x=A.x,this.m_impulse.y=A.y,x=Y.sub(this.m_impulse,f);u=N.wAdd(x.x,this.m_perp,x.z,this.m_axis),p=x.x*this.m_s1+x.y+x.z*this.m_a1,d=x.x*this.m_s2+x.y+x.z*this.m_a2;i.wSub(n,u),e-=m*p,o.wAdd(r,u),s+=a*d}else{x=this.m_K.solve22(N.neg(y));this.m_impulse.x+=x.x,this.m_impulse.y+=x.y;u=N.zero().wAdd(x.x,this.m_perp),p=x.x*this.m_s1+x.y,d=x.x*this.m_s2+x.y;i.wSub(n,u),e-=m*p,o.wAdd(r,u),s+=a*d}this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},c.prototype.solvePositionConstraints=function(t){var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=Z.neo(e),r=Z.neo(s),m=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,_=Z.mul(n,N.sub(this.m_localAnchorA,this.m_localCenterA)),l=Z.mul(r,N.sub(this.m_localAnchorB,this.m_localCenterB)),u=N.sub(N.add(o,l),N.add(i,_)),p=Z.mul(n,this.m_localXAxisA),d=N.cross(N.add(u,_),p),y=N.cross(l,p),v=Z.mul(n,this.m_localYAxisA),f=N.cross(N.add(u,_),v),x=N.cross(l,v),g=Y(),A=N.zero();A.x=N.dot(v,u),A.y=s-e-this.m_referenceAngle;var b=O.abs(A.x),B=O.abs(A.y),w=J.linearSlop,S=J.maxLinearCorrection,C=!1,M=0;if(this.m_enableLimit){var I=N.dot(p,u);O.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*w?(M=O.clamp(I,-S,S),b=O.max(b,O.abs(I)),C=!0):I<=this.m_lowerTranslation?(M=O.clamp(I-this.m_lowerTranslation+w,-S,0),b=O.max(b,this.m_lowerTranslation-I),C=!0):I>=this.m_upperTranslation&&(M=O.clamp(I-this.m_upperTranslation-w,0,S),b=O.max(b,I-this.m_upperTranslation),C=!0)}if(C){var P=m+a+h*f*f+c*x*x,T=h*f+c*x,V=h*f*d+c*x*y;0==(q=h+c)&&(q=1);var z=h*d+c*y,L=m+a+h*d*d+c*y*y;(k=new H).ex.set(P,T,V),k.ey.set(T,q,z),k.ez.set(V,z,L);var F=Y();F.x=A.x,F.y=A.y,F.z=M,g=k.solve33(Y.neg(F))}else{var q,k;P=m+a+h*f*f+c*x*x,T=h*f+c*x;0==(q=h+c)&&(q=1),(k=new W).ex.set(P,T),k.ey.set(T,q);var D=k.solve(N.neg(A));g.x=D.x,g.y=D.y,g.z=0}var R=N.wAdd(g.x,v,g.z,p),E=g.x*f+g.y+g.z*d,j=g.x*x+g.y+g.z*y;return i.wSub(m,R),e-=h*E,o.wAdd(a,R),s+=c*j,this.m_bodyA.c_position.c=i,this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=s,b<=J.linearSlop&&B<=J.angularSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],33:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===a)var a=!1;i.exports=u;var h=t("../util/common"),c=t("../util/options"),s=t("../util/create"),B=t("../Settings"),w=t("../common/Math"),S=t("../common/Vec2"),n=t("../common/Vec3"),C=(t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),_=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));u.TYPE="pulley-joint",u.MIN_PULLEY_LENGTH=2,u.prototype=s((u._super=_).prototype);var l={collideConnected:!0};function u(t,i,e,o,s,n,r,m){if(!(this instanceof u))return new u(t,i,e,o,s,n,r,m);t=c(t,l),_.call(this,t,i,e),this.m_type=u.TYPE,this.m_groundAnchorA=o,this.m_groundAnchorB=s,this.m_localAnchorA=i.getLocalPoint(n),this.m_localAnchorB=e.getLocalPoint(r),this.m_lengthA=S.distance(n,o),this.m_lengthB=S.distance(r,s),this.m_ratio=t.ratio||m,a&&h.assert(m>w.EPSILON),this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0,this.m_uA,this.m_uB,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}u.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},u.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},u.prototype.getLengthA=function(){return this.m_lengthA},u.prototype.getLengthB=function(){return this.m_lengthB},u.prototype.setRatio=function(){return this.m_ratio},u.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),i=this.m_groundAnchorA;return S.distance(t,i)},u.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=this.m_groundAnchorB;return S.distance(t,i)},u.prototype.shiftOrigin=function(t){this.m_groundAnchorA-=t,this.m_groundAnchorB-=t},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return n.mul(t*this.m_impulse,this.m_uB)},u.prototype.getReactionTorque=function(t){return 0},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=C.neo(e),c=C.neo(r);this.m_rA=C.mul(h,S.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=C.mul(c,S.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=S.sub(S.add(i,this.m_rA),this.m_groundAnchorA),this.m_uB=S.sub(S.add(n,this.m_rB),this.m_groundAnchorB);var _=this.m_uA.length(),l=this.m_uB.length();_>10*B.linearSlop?this.m_uA.mul(1/_):this.m_uA.setZero(),l>10*B.linearSlop?this.m_uB.mul(1/l):this.m_uB.setZero();var u=S.cross(this.m_rA,this.m_uA),p=S.cross(this.m_rB,this.m_uB),d=this.m_invMassA+this.m_invIA*u*u,y=this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=d+this.m_ratio*this.m_ratio*y,0<this.m_mass&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var v=S.mul(-this.m_impulse,this.m_uA),f=S.mul(-this.m_ratio*this.m_impulse,this.m_uB);o.wAdd(this.m_invMassA,v),s+=this.m_invIA*S.cross(this.m_rA,v),m.wAdd(this.m_invMassB,f),a+=this.m_invIB*S.cross(this.m_rB,f)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=a},u.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=S.add(i,S.cross(e,this.m_rA)),r=S.add(o,S.cross(s,this.m_rB)),m=-S.dot(this.m_uA,n)-this.m_ratio*S.dot(this.m_uB,r),a=-this.m_mass*m;this.m_impulse+=a;var h=S.zero().wSet(-a,this.m_uA),c=S.zero().wSet(-this.m_ratio*a,this.m_uB);i.wAdd(this.m_invMassA,h),e+=this.m_invIA*S.cross(this.m_rA,h),o.wAdd(this.m_invMassB,c),s+=this.m_invIB*S.cross(this.m_rB,c),this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},u.prototype.solvePositionConstraints=function(t){var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=C.neo(e),r=C.neo(s),m=C.mul(n,S.sub(this.m_localAnchorA,this.m_localCenterA)),a=C.mul(r,S.sub(this.m_localAnchorB,this.m_localCenterB)),h=S.sub(S.add(i,this.m_rA),this.m_groundAnchorA),c=S.sub(S.add(o,this.m_rB),this.m_groundAnchorB),_=h.length(),l=c.length();_>10*B.linearSlop?h.mul(1/_):h.setZero(),l>10*B.linearSlop?c.mul(1/l):c.setZero();var u=S.cross(m,h),p=S.cross(a,c),d=this.m_invMassA+this.m_invIA*u*u,y=this.m_invMassB+this.m_invIB*p*p,v=d+this.m_ratio*this.m_ratio*y;0<v&&(v=1/v);var f=this.m_constant-_-this.m_ratio*l,x=w.abs(f),g=-v*f,A=S.zero().wSet(-g,h),b=S.zero().wSet(-this.m_ratio*g,c);return i.wAdd(this.m_invMassA,A),e+=this.m_invIA*S.cross(m,A),o.wAdd(this.m_invMassB,b),s+=this.m_invIB*S.cross(a,b),this.m_bodyA.c_position.c=i,this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=s,x<B.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],34:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=_;var n=t("../util/common"),r=t("../util/options"),m=t("../util/create"),A=t("../Settings"),b=t("../common/Math"),B=t("../common/Vec2"),x=t("../common/Vec3"),w=t("../common/Mat22"),a=t("../common/Mat33"),S=t("../common/Rot"),h=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint")),C=0;_.TYPE="revolute-joint",_.prototype=m((_._super=h).prototype);var c={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};function _(t,i,e,o){if(!(this instanceof _))return new _(t,i,e,o);t=r(t,c),h.call(this,t,i,e),this.m_type=_.TYPE,this.m_localAnchorA=t.localAnchorA||i.getLocalPoint(o),this.m_localAnchorB=t.localAnchorB||e.getLocalPoint(o),this.m_referenceAngle=e.getAngle()-i.getAngle(),this.m_impulse=x(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new a,this.m_motorMass,this.m_limitState=C}_.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},_.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},_.prototype.getReferenceAngle=function(){return this.m_referenceAngle},_.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},_.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},_.prototype.isMotorEnabled=function(){return this.m_enableMotor},_.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},_.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},_.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},_.prototype.getMotorSpeed=function(){return this.m_motorSpeed},_.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},_.prototype.isLimitEnabled=function(){return this.m_enableLimit},_.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},_.prototype.getLowerLimit=function(){return this.m_lowerAngle},_.prototype.getUpperLimit=function(){return this.m_upperAngle},_.prototype.setLimits=function(t,i){s&&n.assert(t<=i),t==this.m_lowerAngle&&i==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=i)},_.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},_.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},_.prototype.getReactionForce=function(t){return t*B.neo(this.m_impulse.x,this.m_impulse.y)},_.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},_.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=S.neo(i),a=S.neo(s);this.m_rA=S.mul(m,B.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=S.mul(a,B.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=_+l==0;if(this.m_mass.ex.x=h+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*l,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*l,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*l,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=h+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*l,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*l,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+l,this.m_motorMass=_+l,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||u)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==u){var p=s-i-this.m_referenceAngle;b.abs(this.m_upperAngle-this.m_lowerAngle)<2*A.angularSlop?this.m_limitState=3:p<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):p>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=C,this.m_impulse.z=0)}else this.m_limitState=C;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var d=B.neo(this.m_impulse.x,this.m_impulse.y);e.wSub(h,d),o-=_*(B.cross(this.m_rA,d)+this.m_motorImpulse+this.m_impulse.z),n.wAdd(c,d),r+=l*(B.cross(this.m_rB,d)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},_.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=m+a==0;if(this.m_enableMotor&&3!=this.m_limitState&&0==h){var c=s-e-this.m_motorSpeed,_=-this.m_motorMass*c,l=this.m_motorImpulse,u=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=b.clamp(this.m_motorImpulse+_,-u,u),e-=m*(_=this.m_motorImpulse-l),s+=a*_}if(this.m_enableLimit&&this.m_limitState!=C&&0==h){var p=B.zero();p.wAdd(1,o,1,B.cross(s,this.m_rB)),p.wSub(1,i,1,B.cross(e,this.m_rA));var d=s-e;c=x(p.x,p.y,d),_=x.neg(this.m_mass.solve33(c));if(3==this.m_limitState)this.m_impulse.add(_);else if(1==this.m_limitState){if(this.m_impulse.z+_.z<0){var y=B.wAdd(-1,p,this.m_impulse.z,B.neo(this.m_mass.ez.x,this.m_mass.ez.y)),v=this.m_mass.solve22(y);_.x=v.x,_.y=v.y,_.z=-this.m_impulse.z,this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,this.m_impulse.z=0}else this.m_impulse.add(_)}else if(2==this.m_limitState){if(0<this.m_impulse.z+_.z){y=B.wAdd(-1,p,this.m_impulse.z,B.neo(this.m_mass.ez.x,this.m_mass.ez.y)),v=this.m_mass.solve22(y);_.x=v.x,_.y=v.y,_.z=-this.m_impulse.z,this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,this.m_impulse.z=0}else this.m_impulse.add(_)}var f=B.neo(_.x,_.y);i.wSub(n,f),e-=m*(B.cross(this.m_rA,f)+_.z),o.wAdd(r,f),s+=a*(B.cross(this.m_rB,f)+_.z)}else{(c=B.zero()).wAdd(1,o,1,B.cross(s,this.m_rB)),c.wSub(1,i,1,B.cross(e,this.m_rA));_=this.m_mass.solve22(B.neg(c));this.m_impulse.x+=_.x,this.m_impulse.y+=_.y,i.wSub(n,_),e-=m*B.cross(this.m_rA,_),o.wAdd(r,_),s+=a*B.cross(this.m_rB,_)}this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},_.prototype.solvePositionConstraints=function(t){var i,e=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,r=S.neo(o),m=S.neo(n),a=0,h=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=C&&0==h){var c=n-o-this.m_referenceAngle,_=0;if(3==this.m_limitState){var l=b.clamp(c-this.m_lowerAngle,-A.maxAngularCorrection,A.maxAngularCorrection);_=-this.m_motorMass*l,a=b.abs(l)}else if(1==this.m_limitState){a=-(l=c-this.m_lowerAngle),l=b.clamp(l+A.angularSlop,-A.maxAngularCorrection,0),_=-this.m_motorMass*l}else if(2==this.m_limitState){a=l=c-this.m_upperAngle,l=b.clamp(l-A.angularSlop,0,A.maxAngularCorrection),_=-this.m_motorMass*l}o-=this.m_invIA*_,n+=this.m_invIB*_}r.set(o),m.set(n);var u=S.mul(r,B.sub(this.m_localAnchorA,this.m_localCenterA)),p=S.mul(m,B.sub(this.m_localAnchorB,this.m_localCenterB));(l=B.zero()).wAdd(1,s,1,p),l.wSub(1,e,1,u),i=l.length();var d=this.m_invMassA,y=this.m_invMassB,v=this.m_invIA,f=this.m_invIB,x=new w;x.ex.x=d+y+v*u.y*u.y+f*p.y*p.y,x.ex.y=-v*u.x*u.y-f*p.x*p.y,x.ey.x=x.ex.y,x.ey.y=d+y+v*u.x*u.x+f*p.x*p.x;var g=B.neg(x.solve(l));return e.wSub(d,g),o-=v*B.cross(u,g),s.wAdd(y,g),n+=f*B.cross(p,g),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=n,i<=A.linearSlop&&a<=A.angularSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],35:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=h;var n=t("../util/options"),r=t("../util/create"),y=t("../Settings"),p=t("../common/Math"),v=t("../common/Vec2"),f=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),m=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint")),x=0;h.TYPE="rope-joint",h.prototype=r((h._super=m).prototype);var a={maxLength:0};function h(t,i,e,o){if(!(this instanceof h))return new h(t,i,e,o);t=n(t,a),m.call(this,t,i,e),this.m_type=h.TYPE,this.m_localAnchorA=t.localAnchorA||i.getLocalPoint(o),this.m_localAnchorB=t.localAnchorB||e.getLocalPoint(o),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=x,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}h.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},h.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},h.prototype.setMaxLength=function(t){this.m_maxLength=t},h.prototype.getMaxLength=function(){return this.m_maxLength},h.prototype.getLimitState=function(){return this.m_state},h.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},h.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},h.prototype.getReactionForce=function(t){return t*this.m_impulse*this.m_u},h.prototype.getReactionTorque=function(t){return 0},h.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=f.neo(e),c=f.neo(r);this.m_rA=f.mulSub(h,this.m_localAnchorA,this.m_localCenterA),this.m_rB=f.mulSub(c,this.m_localAnchorB,this.m_localCenterB),this.m_u=v.zero(),this.m_u.wAdd(1,n,1,this.m_rB),this.m_u.wSub(1,i,1,this.m_rA),this.m_length=this.m_u.length();var _=this.m_length-this.m_maxLength;if(this.m_state=0<_?2:x,!(this.m_length>y.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var l=v.cross(this.m_rA,this.m_u),u=v.cross(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,t.warmStarting){this.m_impulse*=t.dtRatio;var d=v.mul(this.m_impulse,this.m_u);o.wSub(this.m_invMassA,d),s-=this.m_invIA*v.cross(this.m_rA,d),m.wAdd(this.m_invMassB,d),a+=this.m_invIB*v.cross(this.m_rB,d)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(o),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=a},h.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=v.addCross(i,e,this.m_rA),r=v.addCross(o,s,this.m_rB),m=this.m_length-this.m_maxLength,a=v.dot(this.m_u,v.sub(r,n));m<0&&(a+=t.inv_dt*m);var h=-this.m_mass*a,c=this.m_impulse;this.m_impulse=p.min(0,this.m_impulse+h),h=this.m_impulse-c;var _=v.mul(h,this.m_u);i.wSub(this.m_invMassA,_),e-=this.m_invIA*v.cross(this.m_rA,_),o.wAdd(this.m_invMassB,_),s+=this.m_invIB*v.cross(this.m_rB,_),this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},h.prototype.solvePositionConstraints=function(t){var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=f.neo(e),r=f.neo(s),m=f.mulSub(n,this.m_localAnchorA,this.m_localCenterA),a=f.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=v.zero();h.wAdd(1,o,1,a),h.wSub(1,i,1,m);var c=h.normalize(),_=c-this.m_maxLength;_=p.clamp(_,0,y.maxLinearCorrection);var l=-this.m_mass*_,u=v.mul(l,h);return i.wSub(this.m_invMassA,u),e-=this.m_invIA*v.cross(m,u),o.wAdd(this.m_invMassB,u),s+=this.m_invIB*v.cross(a,u),this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(o),this.m_bodyB.c_position.a=s,c-this.m_maxLength<y.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/create":51,"../util/options":52}],36:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=h;var n=t("../util/options"),r=t("../util/create"),b=t("../Settings"),B=t("../common/Math"),w=t("../common/Vec2"),S=t("../common/Vec3"),C=(t("../common/Mat22"),t("../common/Mat33")),M=t("../common/Rot"),m=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));h.TYPE="weld-joint",h.prototype=r((h._super=m).prototype);var a={frequencyHz:0,dampingRatio:0};function h(t,i,e,o){if(!(this instanceof h))return new h(t,i,e,o);t=n(t,a),m.call(this,t,i,e),this.m_type=h.TYPE,this.m_localAnchorA=i.getLocalPoint(o),this.m_localAnchorB=e.getLocalPoint(o),this.m_referenceAngle=e.getAngle()-i.getAngle(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=S(),this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new C}h.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},h.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},h.prototype.getReferenceAngle=function(){return this.m_referenceAngle},h.prototype.setFrequency=function(t){this.m_frequencyHz=t},h.prototype.getFrequency=function(){return this.m_frequencyHz},h.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},h.prototype.getDampingRatio=function(){return this.m_dampingRatio},h.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},h.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},h.prototype.getReactionForce=function(t){return t*w.neo(this.m_impulse.x,this.m_impulse.y)},h.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},h.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=M.neo(i),a=M.neo(s);this.m_rA=M.mul(m,w.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=M.mul(a,w.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=new C;if(u.ex.x=h+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*l,u.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*l,u.ez.x=-this.m_rA.y*_-this.m_rB.y*l,u.ex.y=u.ey.x,u.ey.y=h+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*l,u.ez.y=this.m_rA.x*_+this.m_rB.x*l,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=_+l,0<this.m_frequencyHz){u.getInverse22(this.m_mass);var p=_+l,d=0<p?1/p:0,y=s-i-this.m_referenceAngle,v=2*B.PI*this.m_frequencyHz,f=2*d*this.m_dampingRatio*v,x=d*v*v,g=t.dt;this.m_gamma=g*(f+g*x),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*g*x*this.m_gamma,p+=this.m_gamma,this.m_mass.ez.z=0!=p?1/p:0}else 0==u.ez.z?u.getInverse22(this.m_mass):u.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var A=w.neo(this.m_impulse.x,this.m_impulse.y);e.wSub(h,A),o-=_*(w.cross(this.m_rA,A)+this.m_impulse.z),n.wAdd(c,A),r+=l*(w.cross(this.m_rB,A)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},h.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB;if(0<this.m_frequencyHz){var h=s-e,c=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,e-=m*c,s+=a*c,(u=w.zero()).wAdd(1,o,1,w.cross(s,this.m_rB)),u.wSub(1,i,1,w.cross(e,this.m_rA));var _=w.neg(C.mul(this.m_mass,u));this.m_impulse.x+=_.x,this.m_impulse.y+=_.y;var l=w.clone(_);i.wSub(n,l),e-=m*w.cross(this.m_rA,l),o.wAdd(r,l),s+=a*w.cross(this.m_rB,l)}else{var u;(u=w.zero()).wAdd(1,o,1,w.cross(s,this.m_rB)),u.wSub(1,i,1,w.cross(e,this.m_rA));h=s-e;var p=S(u.x,u.y,h),d=S.neg(C.mul(this.m_mass,p));this.m_impulse.add(d);l=w.neo(d.x,d.y);i.wSub(n,l),e-=m*(w.cross(this.m_rA,l)+d.z),o.wAdd(r,l),s+=a*(w.cross(this.m_rB,l)+d.z)}this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=s},h.prototype.solvePositionConstraints=function(t){var i,e,o=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=M.neo(s),a=M.neo(r),h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=M.mul(m,w.sub(this.m_localAnchorA,this.m_localCenterA)),p=M.mul(a,w.sub(this.m_localAnchorB,this.m_localCenterB)),d=new C;if(d.ex.x=h+c+u.y*u.y*_+p.y*p.y*l,d.ey.x=-u.y*u.x*_-p.y*p.x*l,d.ez.x=-u.y*_-p.y*l,d.ex.y=d.ey.x,d.ey.y=h+c+u.x*u.x*_+p.x*p.x*l,d.ez.y=u.x*_+p.x*l,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=_+l,0<this.m_frequencyHz){(v=w.zero()).wAdd(1,n,1,p),v.wSub(1,o,1,u),i=v.length(),e=0;var y=w.neg(d.solve22(v));o.wSub(h,y),s-=_*w.cross(u,y),n.wAdd(c,y),r+=l*w.cross(p,y)}else{var v;(v=w.zero()).wAdd(1,n,1,p),v.wSub(1,o,1,u);var f=r-s-this.m_referenceAngle;i=v.length(),e=B.abs(f);var x=S(v.x,v.y,f),g=S();if(0<d.ez.z)g=S.neg(d.solve33(x));else{var A=w.neg(d.solve22(v));g.set(A.x,A.y,0)}y=w.neo(g.x,g.y);o.wSub(h,y),s-=_*(w.cross(u,y)+g.z),n.wAdd(c,y),r+=l*(w.cross(p,y)+g.z)}return this.m_bodyA.c_position.c=o,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,i<=b.linearSlop&&e<=b.angularSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/create":51,"../util/options":52}],37:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=h;var n=t("../util/options"),r=t("../util/create"),x=t("../Settings"),C=t("../common/Math"),M=t("../common/Vec2"),I=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),m=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));h.TYPE="wheel-joint",h.prototype=r((h._super=m).prototype);var a={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};function h(t,i,e,o,s){if(!(this instanceof h))return new h(t,i,e,o,s);t=n(t,a),m.call(this,t,i,e),this.m_type=h.TYPE,this.m_localAnchorA=i.getLocalPoint(o),this.m_localAnchorB=e.getLocalPoint(o),this.m_localXAxisA=i.getLocalVector(s||M.neo(1,0)),this.m_localYAxisA=M.cross(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_ax=M.zero(),this.m_ay=M.zero(),this.m_sAx,this.m_sBx,this.m_sAy,this.m_sBy}h.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},h.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},h.prototype.getLocalAxisA=function(){return this.m_localXAxisA},h.prototype.getJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,e=t.getWorldPoint(this.m_localAnchorA),o=i.getWorldPoint(this.m_localAnchorB)-e,s=t.getWorldVector(this.m_localXAxisA);return Dot(o,s)},h.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},h.prototype.isMotorEnabled=function(){return this.m_enableMotor},h.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},h.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},h.prototype.getMotorSpeed=function(){return this.m_motorSpeed},h.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},h.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},h.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},h.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},h.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},h.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},h.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},h.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},h.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},h.prototype.getReactionForce=function(t){return t*(this.m_impulse*this.m_ay+this.m_springImpulse*this.m_ax)},h.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},h.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_invMassA,e=this.m_invMassB,o=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,m=this.m_bodyA.c_velocity.v,a=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,u=I.neo(r),p=I.neo(c),d=I.mul(u,M.sub(this.m_localAnchorA,this.m_localCenterA)),y=I.mul(p,M.sub(this.m_localAnchorB,this.m_localCenterB));if((g=M.zero()).wAdd(1,h,1,y),g.wSub(1,n,1,d),this.m_ay=I.mul(u,this.m_localYAxisA),this.m_sAy=M.cross(M.add(g,d),this.m_ay),this.m_sBy=M.cross(y,this.m_ay),this.m_mass=i+e+o*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,0<this.m_mass&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,(this.m_gamma=0)<this.m_frequencyHz){this.m_ax=I.mul(u,this.m_localXAxisA),this.m_sAx=M.cross(M.add(g,d),this.m_ax),this.m_sBx=M.cross(y,this.m_ax);var v=i+e+o*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(0<v){this.m_springMass=1/v;var f=M.dot(g,this.m_ax),x=2*C.PI*this.m_frequencyHz,g=2*this.m_springMass*this.m_dampingRatio*x,A=this.m_springMass*x*x,b=t.dt;this.m_gamma=b*(g+b*A),0<this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_bias=f*b*A*this.m_gamma,this.m_springMass=v+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=o+s,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var B=M.wAdd(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),w=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,S=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;m.wSub(this.m_invMassA,B),a-=this.m_invIA*w,_.wAdd(this.m_invMassB,B),l+=this.m_invIB*S}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(m),this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v.set(_),this.m_bodyB.c_velocity.w=l},h.prototype.solveVelocityConstraints=function(t){var i=this.m_invMassA,e=this.m_invMassB,o=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=M.dot(this.m_ax,m)-M.dot(this.m_ax,n)+this.m_sBx*a-this.m_sAx*r,c=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var _=M.zero().wSet(c,this.m_ax),l=c*this.m_sAx,u=c*this.m_sBx;n.wSub(i,_),r-=o*l,m.wAdd(e,_);h=(a+=s*u)-r-this.m_motorSpeed,c=-this.m_motorMass*h;var p=this.m_motorImpulse,d=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=C.clamp(this.m_motorImpulse+c,-d,d),r-=o*(c=this.m_motorImpulse-p),a+=s*c;h=M.dot(this.m_ay,m)-M.dot(this.m_ay,n)+this.m_sBy*a-this.m_sAy*r,c=-this.m_mass*h;this.m_impulse+=c;_=M.zero().wSet(c,this.m_ay),l=c*this.m_sAy,u=c*this.m_sBy;n.wSub(i,_),r-=o*l,m.wAdd(e,_),a+=s*u,this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=a},h.prototype.solvePositionConstraints=function(t){var i=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=I.neo(e),r=I.neo(s),m=I.mul(n,M.sub(this.m_localAnchorA,this.m_localCenterA)),a=I.mul(r,M.sub(this.m_localAnchorB,this.m_localCenterB)),h=M.zero();h.wAdd(1,o,1,a),h.wSub(1,i,1,m);var c,_=I.mul(n,this.m_localYAxisA),l=M.cross(M.sub(h,m),_),u=M.cross(a,_),p=M.dot(h,_),d=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;c=0!=d?-p/d:0;var y=M.zero().wSet(c,_),v=c*l,f=c*u;return i.wSub(this.m_invMassA,y),e-=this.m_invIA*v,o.wAdd(this.m_invMassB,y),s+=this.m_invIB*f,this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(o),this.m_bodyB.c_position.a=s,C.abs(p)<=x.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/create":51,"../util/options":52}],38:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=c;t("../util/common");var n=t("../util/create"),r=(t("../util/options"),t("../common/Math"),t("../common/Transform")),m=t("../common/Rot"),a=t("../common/Vec2"),h=(t("../collision/AABB"),t("../Settings"),t("./PolygonShape"));function c(t,i,e,o){if(!(this instanceof c))return new c(t,i,e,o);if(c._super.call(this),this.m_vertices[0]=a.neo(-t,-i),this.m_vertices[1]=a.neo(t,-i),this.m_vertices[2]=a.neo(t,i),this.m_vertices[3]=a.neo(-t,i),this.m_normals[0]=a.neo(0,-1),this.m_normals[1]=a.neo(1,0),this.m_normals[2]=a.neo(0,1),this.m_normals[3]=a.neo(-1,0),this.m_count=4,e&&"x"in e&&"y"in e){o=o||0,this.m_centroid.set(e);var s=r.identity();s.p.set(e),s.q.set(o);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=r.mul(s,this.m_vertices[n]),this.m_normals[n]=m.mul(s.q,this.m_normals[n])}}c.prototype=n((c._super=h).prototype),c.TYPE="polygon"},{"../Settings":7,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"../util/options":52,"./PolygonShape":47}],39:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===n)var n=!1;i.exports=l;var r=t("../util/common"),s=t("../util/create"),m=(t("../util/options"),t("../common/Math"),t("../common/Transform")),a=(t("../common/Rot"),t("../common/Vec2")),h=(t("../collision/AABB"),t("../Settings")),c=t("../Shape"),_=t("./EdgeShape");function l(t,i){if(!(this instanceof l))return new l(t,i);l._super.call(this),this.m_type=l.TYPE,this.m_radius=h.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,t&&t.length&&(i?this._createLoop(t):this._createChain(t))}l.prototype=s((l._super=c).prototype),l.TYPE="chain",l.prototype._createLoop=function(t){n&&r.assert(0==this.m_vertices.length&&0==this.m_count),n&&r.assert(3<=t.length);for(var i=1;i<t.length;++i){var e=t[i-1],o=t[i];n&&r.assert(a.distanceSquared(e,o)>h.linearSlopSquared)}this.m_vertices.length=0,this.m_count=t.length+1;for(i=0;i<t.length;++i)this.m_vertices[i]=t[i].clone();return this.m_vertices[t.length]=t[0].clone(),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},l.prototype._createChain=function(t){n&&r.assert(0==this.m_vertices.length&&0==this.m_count),n&&r.assert(2<=t.length);for(var i=1;i<t.length;++i){var e=t[i-1],o=t[i];n&&r.assert(a.distanceSquared(e,o)>h.linearSlopSquared)}this.m_count=t.length;for(i=0;i<t.length;++i)this.m_vertices[i]=t[i].clone();return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},l.prototype._setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},l.prototype._setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},l.prototype._clone=function(){var t=new l;return t.createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},l.prototype.getChildCount=function(){return this.m_count-1},l.prototype.getChildEdge=function(t,i){n&&r.assert(0<=i&&i<this.m_count-1),t.m_type=_.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[i],t.m_vertex2=this.m_vertices[i+1],t.m_hasVertex0=0<i?(t.m_vertex0=this.m_vertices[i-1],!0):(t.m_vertex0=this.m_prevVertex,this.m_hasPrevVertex),i<this.m_count-2?(t.m_vertex3=this.m_vertices[i+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},l.prototype.getVertex=function(t){return n&&r.assert(0<=t&&t<=this.m_count),t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},l.prototype.testPoint=function(t,i){return!1},l.prototype.rayCast=function(t,i,e,o){return n&&r.assert(0<=o&&o<this.m_count),new _(this.getVertex(o),this.getVertex(o+1)).rayCast(t,i,e,0)},l.prototype.computeAABB=function(t,i,e){n&&r.assert(0<=e&&e<this.m_count);var o=m.mul(i,this.getVertex(e)),s=m.mul(i,this.getVertex(e+1));t.combinePoints(o,s)},l.prototype.computeMass=function(t,i){t.mass=0,t.center=a.neo(),t.I=0},l.prototype.computeDistanceProxy=function(t,i){n&&r.assert(0<=i&&i<this.m_count),t.m_buffer[0]=this.getVertex(i),t.m_buffer[1]=this.getVertex(i+1),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius}},{"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"../util/options":52,"./EdgeShape":46}],40:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=a;var n=t("../util/common"),r=t("../util/create"),l=(t("../util/options"),t("../common/Math")),u=(t("../common/Transform"),t("../common/Rot")),p=t("../common/Vec2"),m=(t("../collision/AABB"),t("../Settings"),t("../Shape"));function a(t,i){if(!(this instanceof a))return new a(t,i);a._super.call(this),this.m_type=a.TYPE,this.m_p=p.zero(),this.m_radius=1,"object"==typeof t&&p.isValid(t)?(this.m_p.set(t),"number"==typeof i&&(this.m_radius=i)):"number"==typeof t&&(this.m_radius=t)}a.prototype=r((a._super=m).prototype),a.TYPE="circle",a.prototype.getRadius=function(){return this.m_radius},a.prototype.getCenter=function(){return this.m_p},a.prototype.getSupportVertex=function(t){return this.m_p},a.prototype.getVertex=function(t){return s&&n.assert(0==t),this.m_p},a.prototype.getVertexCount=function(t){return 1},a.prototype._clone=function(){var t=new a;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},a.prototype.getChildCount=function(){return 1},a.prototype.testPoint=function(t,i){var e=p.add(t.p,u.mul(t.q,this.m_p)),o=p.sub(i,e);return p.dot(o,o)<=this.m_radius*this.m_radius},a.prototype.rayCast=function(t,i,e,o){var s=p.add(e.p,u.mul(e.q,this.m_p)),n=p.sub(i.p1,s),r=p.dot(n,n)-this.m_radius*this.m_radius,m=p.sub(i.p2,i.p1),a=p.dot(n,m),h=p.dot(m,m),c=a*a-h*r;if(c<0||h<l.EPSILON)return!1;var _=-(a+l.sqrt(c));return 0<=_&&_<=i.maxFraction*h&&(_/=h,t.fraction=_,t.normal=p.add(n,p.mul(_,m)),t.normal.normalize(),!0)},a.prototype.computeAABB=function(t,i,e){var o=p.add(i.p,u.mul(i.q,this.m_p));t.lowerBound.set(o.x-this.m_radius,o.y-this.m_radius),t.upperBound.set(o.x+this.m_radius,o.y+this.m_radius)},a.prototype.computeMass=function(t,i){t.mass=i*l.PI*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+p.dot(this.m_p,this.m_p))},a.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"../util/options":52}],41:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===m)var m=!1;var a=t("../util/common"),h=(t("../util/create"),t("../common/Math"),t("../common/Transform")),c=t("../common/Vec2"),s=(t("../Settings"),t("../Shape"),t("../Contact")),_=t("../Manifold"),l=t("./CircleShape");function u(t,i,e,o,s){t.pointCount=0;var n=h.mul(e,i.m_p),r=h.mul(s,o.m_p),m=c.distanceSquared(r,n),a=i.m_radius+o.m_radius;a*a<m||(t.type=_.e_circles,t.localPoint.set(i.m_p),t.localNormal.setZero(),t.pointCount=1,t.points[0].localPoint.set(o.m_p),t.points[0].id.key=0)}s.addType(l.TYPE,l.TYPE,function(t,i,e,o,s,n,r){m&&a.assert(e.getType()==l.TYPE),m&&a.assert(n.getType()==l.TYPE),u(t,e.getShape(),i,n.getShape(),s)}),e.CollideCircles=u},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../common/Math":18,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"./CircleShape":40}],42:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===m)var m=!1;var a=t("../util/common"),b=t("../common/Math"),B=t("../common/Transform"),w=(t("../common/Rot"),t("../common/Vec2")),S=(t("../collision/AABB"),t("../Settings"),t("../Manifold")),s=t("../Contact"),h=(t("../Shape"),t("./CircleShape")),c=t("./PolygonShape");s.addType(c.TYPE,h.TYPE,function(t,i,e,o,s,n,r){m&&a.assert(e.getType()==c.TYPE),m&&a.assert(n.getType()==h.TYPE),function(t,i,e,o,s){t.pointCount=0;for(var n=B.mul(s,o.m_p),r=B.mulT(e,n),m=0,a=-1/0,h=i.m_radius+o.m_radius,c=i.m_count,_=i.m_vertices,l=i.m_normals,u=0;u<c;++u){var p=w.dot(l[u],w.sub(r,_[u]));if(h<p)return;a<p&&(a=p,m=u)}var d=m,y=d+1<c?d+1:0,v=_[d],f=_[y];if(a<b.EPSILON)return t.pointCount=1,t.type=S.e_faceA,t.localNormal.set(l[m]),t.localPoint.wSet(.5,v,.5,f),t.points[0].localPoint=o.m_p,t.points[0].id.key=0;var x=w.dot(w.sub(r,v),w.sub(f,v)),g=w.dot(w.sub(r,f),w.sub(v,f));if(x<=0){if(w.distanceSquared(r,v)>h*h)return;t.pointCount=1,t.type=S.e_faceA,t.localNormal.wSet(1,r,-1,v),t.localNormal.normalize(),t.localPoint=v,t.points[0].localPoint.set(o.m_p),t.points[0].id.key=0}else if(g<=0){if(w.distanceSquared(r,f)>h*h)return;t.pointCount=1,t.type=S.e_faceA,t.localNormal.wSet(1,r,-1,f),t.localNormal.normalize(),t.localPoint.set(f),t.points[0].localPoint.set(o.m_p),t.points[0].id.key=0}else{var A=w.mid(v,f),a=w.dot(r,l[d])-w.dot(A,l[d]);if(h<a)return;t.pointCount=1,t.type=S.e_faceA,t.localNormal.set(l[d]),t.localPoint.set(A),t.points[0].localPoint.set(o.m_p),t.points[0].id.key=0}}(t,e.getShape(),i,n.getShape(),s)})},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"./CircleShape":40,"./PolygonShape":47}],43:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===b)var b=!1;var B=t("../util/common"),w=(t("../util/create"),t("../common/Math"),t("../common/Transform")),S=t("../common/Vec2"),s=(t("../common/Rot"),t("../Settings"),t("../Shape"),t("../Contact")),C=t("../Manifold"),_=t("./EdgeShape"),l=t("./ChainShape"),u=t("./CircleShape");function p(t,i,e,o,s){t.pointCount=0;var n=w.mulT(e,w.mul(s,o.m_p)),r=i.m_vertex1,m=i.m_vertex2,a=S.sub(m,r),h=S.dot(a,S.sub(m,n)),c=S.dot(a,S.sub(n,r)),_=i.m_radius+o.m_radius;if(c<=0){var l=S.clone(r),u=S.sub(n,l);if(_*_<S.dot(u,u))return;if(i.m_hasVertex0){var p=i.m_vertex0,d=r,y=S.sub(d,p);if(0<S.dot(y,S.sub(d,n)))return}return t.type=C.e_circles,t.localNormal.setZero(),t.localPoint.set(l),t.pointCount=1,t.points[0].localPoint.set(o.m_p),t.points[0].id.key=0,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=C.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=C.e_vertex)}if(h<=0){l=S.clone(m),u=S.sub(n,l);if(_*_<S.dot(u,u))return;if(i.m_hasVertex3){var v=i.m_vertex3,f=m,x=S.sub(v,f);if(0<S.dot(x,S.sub(n,f)))return}return t.type=C.e_circles,t.localNormal.setZero(),t.localPoint.set(l),t.pointCount=1,t.points[0].localPoint.set(o.m_p),t.points[0].id.key=0,t.points[0].id.cf.indexA=1,t.points[0].id.cf.typeA=C.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=C.e_vertex)}var g=S.dot(a,a);b&&B.assert(0<g);l=S.wAdd(h/g,r,c/g,m),u=S.sub(n,l);if(!(_*_<S.dot(u,u))){var A=S.neo(-a.y,a.x);S.dot(A,S.sub(n,r))<0&&A.set(-A.x,-A.y),A.normalize(),t.type=C.e_faceA,t.localNormal=A,t.localPoint.set(r),t.pointCount=1,t.points[0].localPoint.set(o.m_p),t.points[0].id.key=0,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=C.e_face,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=C.e_vertex}}s.addType(_.TYPE,u.TYPE,function(t,i,e,o,s,n,r){b&&B.assert(e.getType()==_.TYPE),b&&B.assert(n.getType()==u.TYPE);var m=e.getShape(),a=n.getShape();p(t,m,i,a,s)}),s.addType(l.TYPE,u.TYPE,function(t,i,e,o,s,n,r){b&&B.assert(e.getType()==l.TYPE),b&&B.assert(n.getType()==u.TYPE);var m=e.getShape(),a=new _;m.getChildEdge(a,o);var h=a,c=n.getShape();p(t,h,i,c,s)})},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"./ChainShape":39,"./CircleShape":40,"./EdgeShape":46}],44:[function(t,i,e){if(void 0===H)var H=!1;if(void 0===h)var h=!1;var Z=t("../util/common"),K=(t("../util/create"),t("../common/Math")),G=t("../common/Transform"),U=t("../common/Vec2"),X=t("../common/Rot"),Q=t("../Settings"),o=(t("../Shape"),t("../Contact")),$=t("../Manifold"),c=t("./EdgeShape"),_=t("./ChainShape"),l=t("./PolygonShape");o.addType(c.TYPE,l.TYPE,function(t,i,e,o,s,n,r){h&&Z.assert(e.getType()==c.TYPE),h&&Z.assert(n.getType()==l.TYPE),u(t,e.getShape(),i,n.getShape(),s)}),o.addType(_.TYPE,l.TYPE,function(t,i,e,o,s,n,r){h&&Z.assert(e.getType()==_.TYPE),h&&Z.assert(n.getType()==l.TYPE);var m=e.getShape(),a=new c;m.getChildEdge(a,o),u(t,a,i,n.getShape(),s)});var tt=-1,it=1,et=2;function s(){this.type,this.index,this.separation}var ot=new s,st=new s,nt=new function(){this.vertices=[],this.normals=[],this.count=0},rt=new function(){this.i1,this.i2,this.v1,this.v2,this.normal=U.zero(),this.sideNormal1=U.zero(),this.sideOffset1,this.sideNormal2=U.zero(),this.sideOffset2};function u(t,i,e,o,s){H&&Z.debug("CollideEdgePolygon");var n=G.mulT(e,s),r=G.mul(n,o.m_centroid),m=i.m_vertex0,a=i.m_vertex1,h=i.m_vertex2,c=i.m_vertex3,_=i.m_hasVertex0,l=i.m_hasVertex3,u=U.sub(h,a);u.normalize();var p,d=U.neo(u.y,-u.x),y=U.dot(d,U.sub(r,a)),v=0,f=0,x=!1,g=!1;if(_){var A=U.sub(a,m);A.normalize();var b=U.neo(A.y,-A.x);x=0<=U.cross(A,u),v=U.dot(b,r)-U.dot(b,m)}if(l){var B=U.sub(c,h);B.normalize();var w=U.neo(B.y,-B.x);g=0<U.cross(u,B),f=U.dot(w,r)-U.dot(w,h)}var S=U.zero(),C=U.zero(),M=U.zero();_&&l?x&&g?(p=0<=v||0<=y||0<=f)?(S.set(d),C.set(b),M.set(w)):(S.wSet(-1,d),C.wSet(-1,d),M.wSet(-1,d)):x?(p=0<=v||0<=y&&0<=f)?(S.set(d),C.set(b),M.set(d)):(S.wSet(-1,d),C.wSet(-1,w),M.wSet(-1,d)):g?(p=0<=f||0<=v&&0<=y)?(S.set(d),C.set(d),M.set(w)):(S.wSet(-1,d),C.wSet(-1,d),M.wSet(-1,b)):(p=0<=v&&0<=y&&0<=f)?(S.set(d),C.set(d),M.set(d)):(S.wSet(-1,d),C.wSet(-1,w),M.wSet(-1,b)):_?x?((p=0<=v||0<=y)?(S.set(d),C.set(b)):(S.wSet(-1,d),C.set(d)),M.wSet(-1,d)):(p=0<=v&&0<=y)?(S.set(d),C.set(d),M.wSet(-1,d)):(S.wSet(-1,d),C.set(d),M.wSet(-1,b)):l?g?(p=0<=y||0<=f)?(S.set(d),C.wSet(-1,d),M.set(w)):(S.wSet(-1,d),C.wSet(-1,d),M.set(d)):((p=0<=y&&0<=f)?(S.set(d),C.wSet(-1,d)):(S.wSet(-1,d),C.wSet(-1,w)),M.set(d)):(p=0<=y)?(S.set(d),C.wSet(-1,d),M.wSet(-1,d)):(S.wSet(-1,d),C.set(d),M.set(d)),nt.count=o.m_count;for(var I=0;I<o.m_count;++I)nt.vertices[I]=G.mul(n,o.m_vertices[I]),nt.normals[I]=X.mul(n.q,o.m_normals[I]);var P=2*Q.polygonRadius;t.pointCount=0,ot.type=it,ot.index=p?0:1,ot.separation=1/0;for(I=0;I<nt.count;++I){(V=U.dot(S,U.sub(nt.vertices[I],a)))<ot.separation&&(ot.separation=V)}if(ot.type!=tt&&!(ot.separation>P)){st.type=tt,st.index=-1,st.separation=-1/0;var T=U.neo(-S.y,S.x);for(I=0;I<nt.count;++I){var V,z=U.neg(nt.normals[I]),L=U.dot(z,U.sub(nt.vertices[I],a)),F=U.dot(z,U.sub(nt.vertices[I],h));if(P<(V=K.min(L,F))){st.type=et,st.index=I,st.separation=V;break}if(0<=U.dot(z,T)){if(U.dot(U.sub(z,M),S)<-Q.angularSlop)continue}else if(U.dot(U.sub(z,C),S)<-Q.angularSlop)continue;V>st.separation&&(st.type=et,st.index=I,st.separation=V)}if(!(st.type!=tt&&st.separation>P)){var q;q=st.type==tt?ot:st.separation>.98*ot.separation+.001?st:ot;var k=[new $.clipVertex,new $.clipVertex];if(q.type==it){t.type=$.e_faceA;var D=0,R=U.dot(S,nt.normals[0]);for(I=1;I<nt.count;++I){var E=U.dot(S,nt.normals[I]);E<R&&(R=E,D=I)}var j=D,J=j+1<nt.count?j+1:0;k[0].v=nt.vertices[j],k[0].id.cf.indexA=0,k[0].id.cf.indexB=j,k[0].id.cf.typeA=$.e_face,k[0].id.cf.typeB=$.e_vertex,k[1].v=nt.vertices[J],k[1].id.cf.indexA=0,k[1].id.cf.indexB=J,k[1].id.cf.typeA=$.e_face,k[1].id.cf.typeB=$.e_vertex,p?(rt.i1=0,rt.i2=1,rt.v1=a,rt.v2=h,rt.normal.set(d)):(rt.i1=1,rt.i2=0,rt.v1=h,rt.v2=a,rt.normal.wSet(-1,d))}else t.type=$.e_faceB,k[0].v=a,k[0].id.cf.indexA=0,k[0].id.cf.indexB=q.index,k[0].id.cf.typeA=$.e_vertex,k[0].id.cf.typeB=$.e_face,k[1].v=h,k[1].id.cf.indexA=0,k[1].id.cf.indexB=q.index,k[1].id.cf.typeA=$.e_vertex,k[1].id.cf.typeB=$.e_face,rt.i1=q.index,rt.i2=rt.i1+1<nt.count?rt.i1+1:0,rt.v1=nt.vertices[rt.i1],rt.v2=nt.vertices[rt.i2],rt.normal.set(nt.normals[rt.i1]);rt.sideNormal1.set(rt.normal.y,-rt.normal.x),rt.sideNormal2.wSet(-1,rt.sideNormal1),rt.sideOffset1=U.dot(rt.sideNormal1,rt.v1),rt.sideOffset2=U.dot(rt.sideNormal2,rt.v2);var O=[new $.clipVertex,new $.clipVertex],N=[new $.clipVertex,new $.clipVertex];if(!($.clipSegmentToLine(O,k,rt.sideNormal1,rt.sideOffset1,rt.i1)<Q.maxManifoldPoints||$.clipSegmentToLine(N,O,rt.sideNormal2,rt.sideOffset2,rt.i2)<Q.maxManifoldPoints)){q.type==it?(t.localNormal=U.clone(rt.normal),t.localPoint=U.clone(rt.v1)):(t.localNormal=U.clone(o.m_normals[rt.i1]),t.localPoint=U.clone(o.m_vertices[rt.i1]));var Y=0;for(I=0;I<Q.maxManifoldPoints;++I){if(U.dot(rt.normal,U.sub(N[I].v,rt.v1))<=P){var W=t.points[Y];q.type==it?(W.localPoint=G.mulT(n,N[I].v),W.id=N[I].id):(W.localPoint=N[I].v,W.id.cf.typeA=N[I].id.cf.typeB,W.id.cf.typeB=N[I].id.cf.typeA,W.id.cf.indexA=N[I].id.cf.indexB,W.id.cf.indexB=N[I].id.cf.indexA),++Y}}t.pointCount=Y}}}}},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"./ChainShape":39,"./EdgeShape":46,"./PolygonShape":47}],45:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===J)var J=!1;var O=t("../util/common"),N=(t("../common/Math"),t("../common/Transform")),Y=t("../common/Rot"),W=t("../common/Vec2"),H=(t("../collision/AABB"),t("../Settings")),Z=t("../Manifold"),s=t("../Contact"),m=(t("../Shape"),t("./PolygonShape"));function K(t,i,e,o){for(var s=t.m_count,n=e.m_count,r=t.m_normals,m=t.m_vertices,a=e.m_vertices,h=N.mulT(o,i),c=0,_=-1/0,l=0;l<s;++l){for(var u=Y.mul(h.q,r[l]),p=N.mul(h,m[l]),d=1/0,y=0;y<n;++y){var v=W.dot(u,a[y])-W.dot(u,p);v<d&&(d=v)}_<d&&(_=d,c=l)}K._maxSeparation=_,K._bestIndex=c}function a(t,i,e,o,s){t.pointCount=0;var n=i.m_radius+o.m_radius;K(i,e,o,s);var r=K._bestIndex,m=K._maxSeparation;if(!(n<m)){K(o,s,i,e);var a=K._bestIndex,h=K._maxSeparation;if(!(n<h)){var c,_,l,u,p,d;d=m+.1*H.linearSlop<h?(c=o,_=i,l=s,u=e,p=a,t.type=Z.e_faceB,1):(c=i,_=o,l=e,u=s,p=r,t.type=Z.e_faceA,0);var y=[new Z.clipVertex,new Z.clipVertex];!function(t,i,e,o,s,n){var r=i.m_normals,m=s.m_count,a=s.m_vertices,h=s.m_normals;J&&O.assert(0<=o&&o<i.m_count);for(var c=Y.mulT(n.q,Y.mul(e.q,r[o])),_=0,l=1/0,u=0;u<m;++u){var p=W.dot(c,h[u]);p<l&&(l=p,_=u)}var d=_,y=d+1<m?d+1:0;t[0].v=N.mul(n,a[d]),t[0].id.cf.indexA=o,t[0].id.cf.indexB=d,t[0].id.cf.typeA=Z.e_face,t[0].id.cf.typeB=Z.e_vertex,t[1].v=N.mul(n,a[y]),t[1].id.cf.indexA=o,t[1].id.cf.indexB=y,t[1].id.cf.typeA=Z.e_face,t[1].id.cf.typeB=Z.e_vertex}(y,c,l,p,_,u);var v=c.m_count,f=c.m_vertices,x=p,g=p+1<v?p+1:0,A=f[x],b=f[g],B=W.sub(b,A);B.normalize();var w=W.cross(B,1),S=W.wAdd(.5,A,.5,b),C=Y.mul(l.q,B),M=W.cross(C,1);A=N.mul(l,A),b=N.mul(l,b);var I=W.dot(M,A),P=-W.dot(C,A)+n,T=W.dot(C,b)+n,V=[new Z.clipVertex,new Z.clipVertex],z=[new Z.clipVertex,new Z.clipVertex];if(!(Z.clipSegmentToLine(V,y,W.neg(C),P,x)<2||Z.clipSegmentToLine(z,V,C,T,g)<2)){t.localNormal=w,t.localPoint=S;for(var L=0,F=0;F<z.length;++F){if(W.dot(M,z[F].v)-I<=n){var q=t.points[L];if(q.localPoint.set(N.mulT(u,z[F].v)),q.id=z[F].id,d){var k=q.id.cf,D=k.indexA,R=k.indexB,E=k.typeA,j=k.typeB;k.indexA=R,k.indexB=D,k.typeA=j,k.typeB=E}++L}}t.pointCount=L}}}}i.exports=a,s.addType(m.TYPE,m.TYPE,function(t,i,e,o,s,n,r){J&&O.assert(e.getType()==m.TYPE),J&&O.assert(n.getType()==m.TYPE),a(t,e.getShape(),i,n.getShape(),s)})},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"./PolygonShape":47}],46:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=h;var n=t("../util/create"),r=(t("../util/options"),t("../Settings")),m=t("../Shape"),a=(t("../common/Math"),t("../common/Transform")),f=t("../common/Rot"),x=t("../common/Vec2");t("../collision/AABB");function h(t,i){if(!(this instanceof h))return new h(t,i);h._super.call(this),this.m_type=h.TYPE,this.m_radius=r.polygonRadius,this.m_vertex1=t?x.clone(t):x.zero(),this.m_vertex2=i?x.clone(i):x.zero(),this.m_vertex0=x.zero(),this.m_vertex3=x.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}h.prototype=n((h._super=m).prototype),h.TYPE="edge",h.prototype.setNext=function(t){return this.m_hasVertex3=t?(this.m_vertex3.set(t),!0):(this.m_vertex3.setZero(),!1),this},h.prototype.setPrev=function(t){return this.m_hasVertex0=t?(this.m_vertex0.set(t),!0):(this.m_vertex0.setZero(),!1),this},h.prototype._set=function(t,i){return this.m_vertex1.set(t),this.m_vertex2.set(i),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},h.prototype._clone=function(){var t=new h;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.set(this.m_vertex1),t.m_vertex2.set(this.m_vertex2),t.m_vertex0.set(this.m_vertex0),t.m_vertex3.set(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},h.prototype.getChildCount=function(){return 1},h.prototype.testPoint=function(t,i){return!1},h.prototype.rayCast=function(t,i,e,o){var s=f.mulT(e.q,x.sub(i.p1,e.p)),n=f.mulT(e.q,x.sub(i.p2,e.p)),r=x.sub(n,s),m=this.m_vertex1,a=this.m_vertex2,h=x.sub(a,m),c=x.neo(h.y,-h.x);c.normalize();var _=x.dot(c,x.sub(m,s)),l=x.dot(c,r);if(0==l)return!1;var u=_/l;if(u<0||i.maxFraction<u)return!1;var p=x.add(s,x.mul(u,r)),d=x.sub(a,m),y=x.dot(d,d);if(0==y)return!1;var v=x.dot(x.sub(p,m),d)/y;return!(v<0||1<v)&&(t.fraction=u,t.normal=0<_?f.mul(e.q,c).neg():f.mul(e.q,c),!0)},h.prototype.computeAABB=function(t,i,e){var o=a.mul(i,this.m_vertex1),s=a.mul(i,this.m_vertex2);t.combinePoints(o,s),t.extend(this.m_radius)},h.prototype.computeMass=function(t,i){t.mass=0,t.center.wSet(.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},h.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_vertex1),t.m_vertices.push(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/create":51,"../util/options":52}],47:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===g)var g=!1;i.exports=r;var A=t("../util/common"),s=t("../util/create"),b=(t("../util/options"),t("../common/Math")),h=t("../common/Transform"),u=t("../common/Rot"),B=t("../common/Vec2"),w=(t("../collision/AABB"),t("../Settings")),n=t("../Shape");function r(t){if(!(this instanceof r))return new r(t);r._super.call(this),this.m_type=r.TYPE,this.m_radius=w.polygonRadius,this.m_centroid=B.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,t&&t.length&&this._set(t)}r.prototype=s((r._super=n).prototype),r.TYPE="polygon",r.prototype.getVertex=function(t){return g&&A.assert(0<=t&&t<this.m_count),this.m_vertices[t]},r.prototype._clone=function(){var t=new r;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.set(this.m_centroid);for(var i=0;i<this.m_count;i++)t.m_vertices.push(this.m_vertices[i].clone());for(i=0;i<this.m_normals.length;i++)t.m_normals.push(this.m_normals[i].clone());return t},r.prototype.getChildCount=function(){return 1},r.prototype._set=function(t){if(g&&A.assert(3<=t.length&&t.length<=w.maxPolygonVertices),t.length<3)SetAsBox(1,1);else{for(var i=b.min(t.length,w.maxPolygonVertices),e=[],o=0,s=0;s<i;++s){for(var n=t[s],r=!0,m=0;m<o;++m)if(B.distanceSquared(n,e[m])<.25*w.linearSlopSquared){r=!1;break}r&&(e[o++]=n)}if((i=o)<3)return g&&A.assert(!1),void SetAsBox(1,1);var a=0,h=e[0].x;for(s=1;s<i;++s){var c=e[s].x;(h<c||c==h&&e[s].y<e[a].y)&&(a=s,h=c)}for(var _=[],l=0,u=a;;){_[l]=u;var p=0;for(m=1;m<i;++m)if(p!=u){var d=B.sub(e[p],e[_[l]]),y=(n=B.sub(e[m],e[_[l]]),B.cross(d,n));y<0&&(p=m),0==y&&n.lengthSquared()>d.lengthSquared()&&(p=m)}else p=m;if(++l,(u=p)==a)break}if(l<3)return g&&A.assert(!1),void SetAsBox(1,1);this.m_count=l;for(s=0;s<l;++s)this.m_vertices[s]=e[_[s]];for(s=0;s<l;++s){var v=s,f=s+1<l?s+1:0,x=B.sub(this.m_vertices[f],this.m_vertices[v]);g&&A.assert(x.lengthSquared()>b.EPSILON*b.EPSILON),this.m_normals[s]=B.cross(x,1),this.m_normals[s].normalize()}this.m_centroid=function(t,i){g&&A.assert(3<=i);for(var e=B.zero(),o=0,s=B.zero(),n=0;n<i;++n){var r=s,m=t[n],a=n+1<i?t[n+1]:t[0],h=B.sub(m,r),c=B.sub(a,r),_=.5*B.cross(h,c);o+=_,e.wAdd(_*(1/3),r),e.wAdd(_*(1/3),m),e.wAdd(_*(1/3),a)}return g&&A.assert(o>b.EPSILON),e.mul(1/o),e}(this.m_vertices,l)}},r.prototype.testPoint=function(t,i){for(var e=u.mulT(t.q,B.sub(i,t.p)),o=0;o<this.m_count;++o){if(0<B.dot(this.m_normals[o],B.sub(e,this.m_vertices[o])))return!1}return!0},r.prototype.rayCast=function(t,i,e,o){for(var s=u.mulT(e.q,B.sub(i.p1,e.p)),n=u.mulT(e.q,B.sub(i.p2,e.p)),r=B.sub(n,s),m=0,a=i.maxFraction,h=-1,c=0;c<this.m_count;++c){var _=B.dot(this.m_normals[c],B.sub(this.m_vertices[c],s)),l=B.dot(this.m_normals[c],r);if(0==l){if(_<0)return!1}else l<0&&_<m*l?(m=_/l,h=c):0<l&&_<a*l&&(a=_/l);if(a<m)return!1}return g&&A.assert(0<=m&&m<=i.maxFraction),0<=h&&(t.fraction=m,t.normal=u.mul(e.q,this.m_normals[h]),!0)},r.prototype.computeAABB=function(t,i,e){for(var o=1/0,s=1/0,n=-1/0,r=-1/0,m=0;m<this.m_count;++m){var a=h.mul(i,this.m_vertices[m]);o=b.min(o,a.x),n=b.max(n,a.x),s=b.min(s,a.y),r=b.max(r,a.y)}t.lowerBound.set(o,s),t.upperBound.set(n,r),t.extend(this.m_radius)},r.prototype.computeMass=function(t,i){g&&A.assert(3<=this.m_count);for(var e=B.zero(),o=0,s=0,n=B.zero(),r=0;r<this.m_count;++r)n.add(this.m_vertices[r]);n.mul(1/this.m_count);for(r=0;r<this.m_count;++r){var m=B.sub(this.m_vertices[r],n),a=r+1<this.m_count?B.sub(this.m_vertices[r+1],n):B.sub(this.m_vertices[0],n),h=B.cross(m,a),c=.5*h;o+=c,e.wAdd(c*(1/3),m,c*(1/3),a);var _=m.x,l=m.y,u=a.x,p=a.y;s+=1/3*.25*h*(_*_+u*_+u*u+(l*l+p*l+p*p))}t.mass=i*o,g&&A.assert(o>b.EPSILON),e.mul(1/o),t.center.wSet(1,e,1,n),t.I=i*s,t.I+=t.mass*(B.dot(t.center,t.center)-B.dot(e,e))},r.prototype.validate=function(){for(var t=0;t<this.m_count;++t)for(var i=t,e=t<this.m_count-1?i+1:0,o=this.m_vertices[i],s=B.sub(this.m_vertices[e],o),n=0;n<this.m_count;++n)if(n!=i&&n!=e){var r=B.sub(this.m_vertices[n],o);if(B.cross(s,r)<0)return!1}return!0},r.prototype.computeDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"../util/options":52}],48:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports=function(t){var i=[],e=t.max||1/0,o=t.create,s=t.allocate,n=t.release,r=t.discard,m=0,a=0,h=0,c=0;this.max=function(t){return"number"==typeof t?(e=t,this):e},this.size=function(){return i.length},this.allocate=function(){var t;return t=0<i.length?i.shift():(m++,"function"==typeof o?o():{}),a++,"function"==typeof s&&s(t),t},this.release=function(t){i.length<e?(h++,"function"==typeof n&&n(t),i.push(t)):(c++,"function"==typeof r&&(t=r(t)))},this.toString=function(){return" +"+m+" >"+a+" <"+h+" -"+c+" ="+i.length+"/"+e}}},{}],49:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;i.exports.now=function(){return Date.now()},i.exports.diff=function(t){return Date.now()-t}},{}],50:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;e.debug=function(){o&&console.log.apply(console,arguments)},e.assert=function(t,i,e){if(s&&!t)throw e&&console.log(e),new Error(i)}},{}],51:[function(t,i,e){if("function"==typeof Object.create)i.exports=function(t,i){return Object.create.call(Object,t,i)};else{function o(){}i.exports=function(t,i){if(i)throw Error("Second argument is not supported!");if("object"!=typeof t||null===t)throw Error("Invalid prototype!");return o.prototype=t,new o}}},{}],52:[function(t,i,e){if(void 0===o)var o=!1;if(void 0===s)var s=!1;Object.prototype.propertyIsEnumerable;i.exports=function(t,i){for(var e in null==t&&(t={}),i)i.hasOwnProperty(e)&&void 0===t[e]&&(t[e]=i[e]);if("function"==typeof Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(i),s=0;s<o.length;s++){var n=o[s];i.propertyIsEnumerable(n)&&void 0===t[e]&&(t[n]=i[n])}return t}},{}]},{},[1])(1)});