/*
 * Planck.js v0.1.45
 * 
 * Copyright (c) 2016-2018 Ali Shakiba http://shakiba.me/planck.js
 * Copyright (c) 2006-2013 Erin Catto  http://www.gphysics.com
 * 
 * This software is provided 'as-is', without any express or implied
 * warranty.  In no event will the authors be held liable for any damages
 * arising from the use of this software.
 * 
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 * 
 * 1. The origin of this software must not be misrepresented; you must not
 * claim that you wrote the original software. If you use this software
 * in a product, an acknowledgment in the product documentation would be
 * appreciated but is not required.
 * 2. Altered source versions must be plainly marked as such, and must not be
 * misrepresented as being the original software.
 * 3. This notice may not be removed or altered from any source distribution.
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.planck=t()}}(function(){return function n(r,m,a){function h(o,t){if(!m[o]){if(!r[o]){var i="function"==typeof require&&require;if(!t&&i)return i(o,!0);if(c)return c(o,!0);var e=new Error("Cannot find module '"+o+"'");throw e.code="MODULE_NOT_FOUND",e}var s=m[o]={exports:{}};r[o][0].call(s.exports,function(t){var i=r[o][1][t];return h(i||t)},s,s.exports,n,r,m,a)}return m[o].exports}for(var c="function"==typeof require&&require,t=0;t<a.length;t++)h(a[t]);return h}({1:[function(t,i,o){o.internal={},o.Math=t("./common/Math"),o.Vec2=t("./common/Vec2"),o.Transform=t("./common/Transform"),o.Rot=t("./common/Rot"),o.AABB=t("./collision/AABB"),o.Shape=t("./Shape"),o.Fixture=t("./Fixture"),o.Body=t("./Body"),o.Contact=t("./Contact"),o.Joint=t("./Joint"),o.World=t("./World"),o.Circle=t("./shape/CircleShape"),o.Edge=t("./shape/EdgeShape"),o.Polygon=t("./shape/PolygonShape"),o.Chain=t("./shape/ChainShape"),o.Box=t("./shape/BoxShape"),t("./shape/CollideCircle"),t("./shape/CollideEdgeCircle"),o.internal.CollidePolygons=t("./shape/CollidePolygon"),t("./shape/CollideCirclePolygone"),t("./shape/CollideEdgePolygon"),o.DistanceJoint=t("./joint/DistanceJoint"),o.FrictionJoint=t("./joint/FrictionJoint"),o.GearJoint=t("./joint/GearJoint"),o.MotorJoint=t("./joint/MotorJoint"),o.MouseJoint=t("./joint/MouseJoint"),o.PrismaticJoint=t("./joint/PrismaticJoint"),o.PulleyJoint=t("./joint/PulleyJoint"),o.RevoluteJoint=t("./joint/RevoluteJoint"),o.RopeJoint=t("./joint/RopeJoint"),o.WeldJoint=t("./joint/WeldJoint"),o.WheelJoint=t("./joint/WheelJoint"),o.internal.Sweep=t("./common/Sweep"),o.internal.stats=t("./common/stats"),o.internal.Manifold=t("./Manifold"),o.internal.Distance=t("./collision/Distance"),o.internal.TimeOfImpact=t("./collision/TimeOfImpact"),o.internal.DynamicTree=t("./collision/DynamicTree"),o.internal.Settings=t("./Settings")},{"./Body":2,"./Contact":3,"./Fixture":4,"./Joint":5,"./Manifold":6,"./Settings":7,"./Shape":8,"./World":10,"./collision/AABB":11,"./collision/Distance":13,"./collision/DynamicTree":14,"./collision/TimeOfImpact":15,"./common/Math":18,"./common/Rot":20,"./common/Sweep":21,"./common/Transform":22,"./common/Vec2":23,"./common/stats":26,"./joint/DistanceJoint":27,"./joint/FrictionJoint":28,"./joint/GearJoint":29,"./joint/MotorJoint":30,"./joint/MouseJoint":31,"./joint/PrismaticJoint":32,"./joint/PulleyJoint":33,"./joint/RevoluteJoint":34,"./joint/RopeJoint":35,"./joint/WeldJoint":36,"./joint/WheelJoint":37,"./shape/BoxShape":38,"./shape/ChainShape":39,"./shape/CircleShape":40,"./shape/CollideCircle":41,"./shape/CollideCirclePolygone":42,"./shape/CollideEdgeCircle":43,"./shape/CollideEdgePolygon":44,"./shape/CollidePolygon":45,"./shape/EdgeShape":46,"./shape/PolygonShape":47}],2:[function(t,i,o){i.exports=y;t("./util/common");var e=t("./util/options"),s=t("./common/Vec2"),n=t("./common/Rot"),r=(t("./common/Math"),t("./common/Sweep")),m=t("./common/Transform"),a=t("./common/Velocity"),h=t("./common/Position"),c=t("./Fixture"),_=(t("./Shape"),t("./World"),y.STATIC="static"),l=y.KINEMATIC="kinematic",u=y.DYNAMIC="dynamic",p={type:_,position:s.zero(),angle:0,linearVelocity:s.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};function y(t,i){i=e(i,p),this.m_world=t,this.m_awakeFlag=i.awake,this.m_autoSleepFlag=i.allowSleep,this.m_bulletFlag=i.bullet,this.m_fixedRotationFlag=i.fixedRotation,this.m_activeFlag=i.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=i.userData,this.m_type=i.type,this.m_type==u?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=m.identity(),this.m_xf.p=s.clone(i.position),this.m_xf.q.setAngle(i.angle),this.m_sweep=new r,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new a,this.c_position=new h,this.m_force=s.zero(),this.m_torque=0,this.m_linearVelocity=s.clone(i.linearVelocity),this.m_angularVelocity=i.angularVelocity,this.m_linearDamping=i.linearDamping,this.m_angularDamping=i.angularDamping,this.m_gravityScale=i.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null}function d(){this.mass=0,this.center=s.zero(),this.I=0}y.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},y.prototype.getWorld=function(){return this.m_world},y.prototype.getNext=function(){return this.m_next},y.prototype.setUserData=function(t){this.m_userData=t},y.prototype.getUserData=function(){return this.m_userData},y.prototype.getFixtureList=function(){return this.m_fixtureList},y.prototype.getJointList=function(){return this.m_jointList},y.prototype.getContactList=function(){return this.m_contactList},y.prototype.isStatic=function(){return this.m_type==_},y.prototype.isDynamic=function(){return this.m_type==u},y.prototype.isKinematic=function(){return this.m_type==l},y.prototype.setStatic=function(){return this.setType(_),this},y.prototype.setDynamic=function(){return this.setType(u),this},y.prototype.setKinematic=function(){return this.setType(l),this},y.prototype.getType=function(){return this.m_type},y.prototype.setType=function(t){if(1!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==_&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var i=this.m_contactList;i;){var o=i;i=i.next,this.m_world.destroyContact(o.contact)}this.m_contactList=null;for(var e=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)for(var n=s.m_proxyCount,r=0;r<n;++r)e.touchProxy(s.m_proxies[r].proxyId)}},y.prototype.isBullet=function(){return this.m_bulletFlag},y.prototype.setBullet=function(t){this.m_bulletFlag=!!t},y.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},y.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)},y.prototype.isAwake=function(){return this.m_awakeFlag},y.prototype.setAwake=function(t){t?0==this.m_awakeFlag&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},y.prototype.isActive=function(){return this.m_activeFlag},y.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag)for(var i=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.createProxies(i,this.m_xf);else{for(i=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.destroyProxies(i);for(var e=this.m_contactList;e;){var s=e;e=e.next,this.m_world.destroyContact(s.contact)}this.m_contactList=null}},y.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},y.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},y.prototype.getTransform=function(){return this.m_xf},y.prototype.setTransform=function(t,i){if(1!=this.isWorldLocked()){this.m_xf.set(t,i),this.m_sweep.setTransform(this.m_xf);for(var o=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(o,this.m_xf,this.m_xf)}},y.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},y.prototype.synchronizeFixtures=function(){var t=m.identity();this.m_sweep.getTransform(t,0);for(var i=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)o.synchronize(i,t,this.m_xf)},y.prototype.advance=function(t){this.m_sweep.advance(t),this.m_sweep.c.set(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},y.prototype.getPosition=function(){return this.m_xf.p},y.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},y.prototype.getAngle=function(){return this.m_sweep.a},y.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},y.prototype.getWorldCenter=function(){return this.m_sweep.c},y.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},y.prototype.getLinearVelocity=function(){return this.m_linearVelocity},y.prototype.getLinearVelocityFromWorldPoint=function(t){var i=s.sub(t,this.m_sweep.c);return s.add(this.m_linearVelocity,s.cross(this.m_angularVelocity,i))},y.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},y.prototype.setLinearVelocity=function(t){this.m_type!=_&&(0<s.dot(t,t)&&this.setAwake(!0),this.m_linearVelocity.set(t))},y.prototype.getAngularVelocity=function(){return this.m_angularVelocity},y.prototype.setAngularVelocity=function(t){this.m_type!=_&&(0<t*t&&this.setAwake(!0),this.m_angularVelocity=t)},y.prototype.getLinearDamping=function(){return this.m_linearDamping},y.prototype.setLinearDamping=function(t){this.m_linearDamping=t},y.prototype.getAngularDamping=function(){return this.m_angularDamping},y.prototype.setAngularDamping=function(t){this.m_angularDamping=t},y.prototype.getGravityScale=function(){return this.m_gravityScale},y.prototype.setGravityScale=function(t){this.m_gravityScale=t},y.prototype.getMass=function(){return this.m_mass},y.prototype.getInertia=function(){return this.m_I+this.m_mass*s.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},y.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.set(this.m_sweep.localCenter)},y.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic())return this.m_sweep.c0.set(this.m_xf.p),this.m_sweep.c.set(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var t=s.zero(),i=this.m_fixtureList;i;i=i.m_next)if(0!=i.m_density){var o=new d;i.getMassData(o),this.m_mass+=o.mass,t.wAdd(o.mass,o.center),this.m_I+=o.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,t.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*s.dot(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var e=s.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t,this.m_xf),this.m_linearVelocity.add(s.cross(this.m_angularVelocity,s.sub(this.m_sweep.c,e)))},y.prototype.setMassData=function(t){if(1!=this.isWorldLocked()&&this.m_type==u){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<t.I&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*s.dot(t.center,t.center),this.m_invI=1/this.m_I);var i=s.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t.center,this.m_xf),this.m_linearVelocity.add(s.cross(this.m_angularVelocity,s.sub(this.m_sweep.c,i)))}},y.prototype.applyForce=function(t,i,o){this.m_type==u&&(o&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=s.cross(s.sub(i,this.m_sweep.c),t)))},y.prototype.applyForceToCenter=function(t,i){this.m_type==u&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},y.prototype.applyTorque=function(t,i){this.m_type==u&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},y.prototype.applyLinearImpulse=function(t,i,o){this.m_type==u&&(o&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.wAdd(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*s.cross(s.sub(i,this.m_sweep.c),t)))},y.prototype.applyAngularImpulse=function(t,i){this.m_type==u&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},y.prototype.shouldCollide=function(t){if(this.m_type!=u&&t.m_type!=u)return!1;for(var i=this.m_jointList;i;i=i.next)if(i.other==t&&0==i.joint.m_collideConnected)return!1;return!0},y.prototype.createFixture=function(t,i){if(1==this.isWorldLocked())return null;var o=new c(this,t,i);if(this.m_activeFlag){var e=this.m_world.m_broadPhase;o.createProxies(e,this.m_xf)}return o.m_next=this.m_fixtureList,0<(this.m_fixtureList=o).m_density&&this.resetMassData(),this.m_world.m_newFixture=!0,o},y.prototype.destroyFixture=function(t){if(1!=this.isWorldLocked()){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next,!0;else for(var i=this.m_fixtureList;null!=i;){if(i.m_next===t){i.m_next=t.m_next,!0;break}i=i.m_next}for(var o=this.m_contactList;o;){var e=o.contact;o=o.next;var s=e.getFixtureA(),n=e.getFixtureB();t!=s&&t!=n||this.m_world.destroyContact(e)}if(this.m_activeFlag){var r=this.m_world.m_broadPhase;t.destroyProxies(r)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},y.prototype.getWorldPoint=function(t){return m.mul(this.m_xf,t)},y.prototype.getWorldVector=function(t){return n.mul(this.m_xf.q,t)},y.prototype.getLocalPoint=function(t){return m.mulT(this.m_xf,t)},y.prototype.getLocalVector=function(t){return n.mulT(this.m_xf.q,t)}},{"./Fixture":4,"./Shape":8,"./World":10,"./common/Math":18,"./common/Position":19,"./common/Rot":20,"./common/Sweep":21,"./common/Transform":22,"./common/Vec2":23,"./common/Velocity":25,"./util/common":50,"./util/options":52}],3:[function(t,i,o){t("./util/common");var O=t("./common/Math"),K=t("./common/Vec2"),G=t("./common/Transform"),D=t("./common/Mat22"),U=t("./common/Rot"),X=t("./Settings"),N=t("./Manifold"),v=t("./collision/Distance");function n(t){this.contact=t,this.prev,this.next,this.other}function c(t,i,o,e,s){this.m_nodeA=new n(this),this.m_nodeB=new n(this),this.m_fixtureA=t,this.m_fixtureB=o,this.m_indexA=i,this.m_indexB=e,this.m_evaluateFcn=s,this.m_manifold=new N,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=r(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=m(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.v_points=[],this.v_normal=K.zero(),this.v_normalMass=new D,this.v_K=new D,this.v_pointCount,this.v_tangentSpeed,this.v_friction,this.v_restitution,this.v_invMassA,this.v_invMassB,this.v_invIA,this.v_invIB,this.p_localPoints=[],this.p_localNormal=K.zero(),this.p_localPoint=K.zero(),this.p_localCenterA=K.zero(),this.p_localCenterB=K.zero(),this.p_type,this.p_radiusA,this.p_radiusB,this.p_pointCount,this.p_invMassA,this.p_invMassB,this.p_invIA,this.p_invIB}function l(){this.rA=K.zero(),this.rB=K.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function r(t,i){return O.sqrt(t*i)}function m(t,i){return i<t?t:i}(i.exports=c).prototype.initConstraint=function(t){var i=this.m_fixtureA,o=this.m_fixtureB,e=i.getShape(),s=o.getShape(),n=i.getBody(),r=o.getBody(),m=this.getManifold(),a=m.pointCount;this.v_invMassA=n.m_invMass,this.v_invMassB=r.m_invMass,this.v_invIA=n.m_invI,this.v_invIB=r.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=a,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=n.m_invMass,this.p_invMassB=r.m_invMass,this.p_invIA=n.m_invI,this.p_invIB=r.m_invI,this.p_localCenterA=K.clone(n.m_sweep.localCenter),this.p_localCenterB=K.clone(r.m_sweep.localCenter),this.p_radiusA=e.m_radius,this.p_radiusB=s.m_radius,this.p_type=m.type,this.p_localNormal=K.clone(m.localNormal),this.p_localPoint=K.clone(m.localPoint),this.p_pointCount=a;for(var h=0;h<a;++h){var c=m.points[h],_=this.v_points[h]=new l;t.warmStarting?(_.normalImpulse=t.dtRatio*c.normalImpulse,_.tangentImpulse=t.dtRatio*c.tangentImpulse):(_.normalImpulse=0,_.tangentImpulse=0),_.rA.setZero(),_.rB.setZero(),_.normalMass=0,_.tangentMass=0,_.velocityBias=0,this.p_localPoints[h]=K.clone(c.localPoint)}},c.prototype.getManifold=function(){return this.m_manifold},c.prototype.getWorldManifold=function(t){var i=this.m_fixtureA.getBody(),o=this.m_fixtureB.getBody(),e=this.m_fixtureA.getShape(),s=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(t,i.getTransform(),e.m_radius,o.getTransform(),s.m_radius)},c.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},c.prototype.isEnabled=function(){return this.m_enabledFlag},c.prototype.isTouching=function(){return this.m_touchingFlag},c.prototype.getNext=function(){return this.m_next},c.prototype.getFixtureA=function(){return this.m_fixtureA},c.prototype.getFixtureB=function(){return this.m_fixtureB},c.prototype.getChildIndexA=function(){return this.m_indexA},c.prototype.getChildIndexB=function(){return this.m_indexB},c.prototype.flagForFiltering=function(){this.m_filterFlag=!0},c.prototype.setFriction=function(t){this.m_friction=t},c.prototype.getFriction=function(){return this.m_friction},c.prototype.resetFriction=function(){this.m_friction=r(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},c.prototype.setRestitution=function(t){this.m_restitution=t},c.prototype.getRestitution=function(){return this.m_restitution},c.prototype.resetRestitution=function(){this.m_restitution=m(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},c.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},c.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},c.prototype.evaluate=function(t,i,o){this.m_evaluateFcn(t,i,this.m_fixtureA,this.m_indexA,o,this.m_fixtureB,this.m_indexB)},c.prototype.update=function(t){var i=!(this.m_enabledFlag=!0),o=this.m_touchingFlag,e=this.m_fixtureA.isSensor(),s=this.m_fixtureB.isSensor(),n=e||s,r=this.m_fixtureA.getBody(),m=this.m_fixtureB.getBody(),a=r.getTransform(),h=m.getTransform();if(n){var c=this.m_fixtureA.getShape(),_=this.m_fixtureB.getShape();i=v.testOverlap(c,this.m_indexA,_,this.m_indexB,a,h),this.m_manifold.pointCount=0}else{var l=this.m_manifold;this.m_manifold=new N,this.evaluate(this.m_manifold,a,h),i=0<this.m_manifold.pointCount;for(var u=0;u<this.m_manifold.pointCount;++u){var p=this.m_manifold.points[u];p.normalImpulse=0;for(var y=p.tangentImpulse=0;y<l.pointCount;++y){var d=l.points[y];if(d.id.key==p.id.key){p.normalImpulse=d.normalImpulse,p.tangentImpulse=d.tangentImpulse;break}}}i!=o&&(r.setAwake(!0),m.setAwake(!0))}this.m_touchingFlag=i,0==o&&1==i&&t&&t.beginContact(this),1==o&&0==i&&t&&t.endContact(this),0==n&&i&&t&&t.preSolve(this,l)},c.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,!1)},c.prototype.solvePositionConstraintTOI=function(t,i,o){return this._solvePositionConstraint(t,!0,i,o)},c.prototype._solvePositionConstraint=function(t,i,o,e){var s=this.m_fixtureA,n=this.m_fixtureB,r=s.getBody(),m=n.getBody(),a=(r.c_velocity,m.c_velocity,r.c_position),h=m.c_position,c=K.clone(this.p_localCenterA),_=K.clone(this.p_localCenterB),l=0,u=0;i&&r!=o&&r!=e||(l=this.p_invMassA,u=this.p_invIA);var p=0,y=0;i&&m!=o&&m!=e||(p=this.p_invMassB,y=this.p_invIB);for(var d=K.clone(a.c),v=a.a,f=K.clone(h.c),x=h.a,A=0,g=0;g<this.p_pointCount;++g){var b,B,w,S=G.identity(),C=G.identity();switch(S.q.set(v),C.q.set(x),S.p=K.sub(d,U.mul(S.q,c)),C.p=K.sub(f,U.mul(C.q,_)),this.p_type){case N.e_circles:var M=G.mul(S,this.p_localPoint),I=G.mul(C,this.p_localPoints[0]);(b=K.sub(I,M)).normalize(),B=K.wAdd(.5,M,.5,I),w=K.dot(K.sub(I,M),b)-this.p_radiusA-this.p_radiusB;break;case N.e_faceA:b=U.mul(S.q,this.p_localNormal);var P=G.mul(S,this.p_localPoint),T=G.mul(C,this.p_localPoints[g]);w=K.dot(K.sub(T,P),b)-this.p_radiusA-this.p_radiusB,B=T;break;case N.e_faceB:b=U.mul(C.q,this.p_localNormal);P=G.mul(C,this.p_localPoint),T=G.mul(S,this.p_localPoints[g]);w=K.dot(K.sub(T,P),b)-this.p_radiusA-this.p_radiusB,B=T,b.mul(-1)}var V=K.sub(B,d),z=K.sub(B,f);A=O.min(A,w);var L=i?X.toiBaugarte:X.baumgarte,F=X.linearSlop,q=X.maxLinearCorrection,k=O.clamp(L*(w+F),-q,0),R=K.cross(V,b),D=K.cross(z,b),j=l+p+u*R*R+y*D*D,J=0<j?-k/j:0,E=K.mul(J,b);d.wSub(l,E),v-=u*K.cross(V,E),f.wAdd(p,E),x+=y*K.cross(z,E)}return a.c.set(d),a.a=v,h.c.set(f),h.a=x,A},c.prototype.initVelocityConstraint=function(t){var i=this.m_fixtureA,o=this.m_fixtureB,e=i.getBody(),s=o.getBody(),n=e.c_velocity,r=s.c_velocity,m=e.c_position,a=s.c_position,h=this.p_radiusA,c=this.p_radiusB,_=this.getManifold(),l=this.v_invMassA,u=this.v_invMassB,p=this.v_invIA,y=this.v_invIB,d=K.clone(this.p_localCenterA),v=K.clone(this.p_localCenterB),f=K.clone(m.c),x=m.a,A=K.clone(n.v),g=n.w,b=K.clone(a.c),B=a.a,w=K.clone(r.v),S=r.w,C=G.identity(),M=G.identity();C.q.set(x),M.q.set(B),C.p.wSet(1,f,-1,U.mul(C.q,d)),M.p.wSet(1,b,-1,U.mul(M.q,v));var I=_.getWorldManifold(null,C,h,M,c);this.v_normal.set(I.normal);for(var P=0;P<this.v_pointCount;++P){var T=this.v_points[P];T.rA.set(K.sub(I.points[P],f)),T.rB.set(K.sub(I.points[P],b));var V=K.cross(T.rA,this.v_normal),z=K.cross(T.rB,this.v_normal),L=l+u+p*V*V+y*z*z;T.normalMass=0<L?1/L:0;var F=K.cross(this.v_normal,1),q=K.cross(T.rA,F),k=K.cross(T.rB,F),R=l+u+p*q*q+y*k*k;T.tangentMass=0<R?1/R:0,T.velocityBias=0;var D=K.dot(this.v_normal,w)+K.dot(this.v_normal,K.cross(S,T.rB))-K.dot(this.v_normal,A)-K.dot(this.v_normal,K.cross(g,T.rA));D<-X.velocityThreshold&&(T.velocityBias=-this.v_restitution*D)}if(2==this.v_pointCount&&t.blockSolve){var j=this.v_points[0],J=this.v_points[1],E=K.cross(j.rA,this.v_normal),O=K.cross(j.rB,this.v_normal),N=K.cross(J.rA,this.v_normal),Y=K.cross(J.rB,this.v_normal),W=l+u+p*E*E+y*O*O,H=l+u+p*N*N+y*Y*Y,Z=l+u+p*E*N+y*O*Y;W*W<1e3*(W*H-Z*Z)?(this.v_K.ex.set(W,Z),this.v_K.ey.set(Z,H),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}m.c.set(f),m.a=x,n.v.set(A),n.w=g,a.c.set(b),a.a=B,r.v.set(w),r.w=S},c.prototype.warmStartConstraint=function(t){for(var i=this.m_fixtureA,o=this.m_fixtureB,e=i.getBody(),s=o.getBody(),n=e.c_velocity,r=s.c_velocity,m=(e.c_position,s.c_position,this.v_invMassA),a=this.v_invIA,h=this.v_invMassB,c=this.v_invIB,_=K.clone(n.v),l=n.w,u=K.clone(r.v),p=r.w,y=this.v_normal,d=K.cross(y,1),v=0;v<this.v_pointCount;++v){var f=this.v_points[v],x=K.wAdd(f.normalImpulse,y,f.tangentImpulse,d);l-=a*K.cross(f.rA,x),_.wSub(m,x),p+=c*K.cross(f.rB,x),u.wAdd(h,x)}n.v.set(_),n.w=l,r.v.set(u),r.w=p},c.prototype.storeConstraintImpulses=function(t){for(var i=this.m_manifold,o=0;o<this.v_pointCount;++o)i.points[o].normalImpulse=this.v_points[o].normalImpulse,i.points[o].tangentImpulse=this.v_points[o].tangentImpulse},c.prototype.solveVelocityConstraint=function(t){for(var i=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body,e=i.c_velocity,s=(i.c_position,o.c_velocity),n=(o.c_position,this.v_invMassA),r=this.v_invIA,m=this.v_invMassB,a=this.v_invIB,h=K.clone(e.v),c=e.w,_=K.clone(s.v),l=s.w,u=this.v_normal,p=K.cross(u,1),y=this.v_friction,d=0;d<this.v_pointCount;++d){var v=this.v_points[d];(B=K.zero()).wAdd(1,_,1,K.cross(l,v.rB)),B.wSub(1,h,1,K.cross(c,v.rA));var f=K.dot(B,p)-this.v_tangentSpeed,x=v.tangentMass*-f,A=y*v.normalImpulse;x=(w=O.clamp(v.tangentImpulse+x,-A,A))-v.tangentImpulse,v.tangentImpulse=w;var g=K.mul(x,p);h.wSub(n,g),c-=r*K.cross(v.rA,g),_.wAdd(m,g),l+=a*K.cross(v.rB,g)}if(1==this.v_pointCount||0==t.blockSolve)for(var b=0;b<this.v_pointCount;++b){var B;v=this.v_points[b];(B=K.zero()).wAdd(1,_,1,K.cross(l,v.rB)),B.wSub(1,h,1,K.cross(c,v.rA));var w,S=K.dot(B,u);x=-v.normalMass*(S-v.velocityBias);x=(w=O.max(v.normalImpulse+x,0))-v.normalImpulse,v.normalImpulse=w;g=K.mul(x,u);h.wSub(n,g),c-=r*K.cross(v.rA,g),_.wAdd(m,g),l+=a*K.cross(v.rB,g)}else{var C=this.v_points[0],M=this.v_points[1],I=K.neo(C.normalImpulse,M.normalImpulse),P=K.zero().add(_).add(K.cross(l,C.rB)).sub(h).sub(K.cross(c,C.rA)),T=K.zero().add(_).add(K.cross(l,M.rB)).sub(h).sub(K.cross(c,M.rA)),V=K.dot(P,u),z=K.dot(T,u),L=K.neo(V-C.velocityBias,z-M.velocityBias);L.sub(D.mul(this.v_K,I));for(;;){var F=K.neg(D.mul(this.v_normalMass,L));if(0<=F.x&&0<=F.y){var q=K.sub(F,I),k=K.mul(q.x,u),R=K.mul(q.y,u);h.wSub(n,k,n,R),c-=r*(K.cross(C.rA,k)+K.cross(M.rA,R)),_.wAdd(m,k,m,R),l+=a*(K.cross(C.rB,k)+K.cross(M.rB,R)),C.normalImpulse=F.x,M.normalImpulse=F.y;break}if(F.x=-C.normalMass*L.x,V=F.y=0,z=this.v_K.ex.y*F.x+L.y,0<=F.x&&0<=z){q=K.sub(F,I),k=K.mul(q.x,u),R=K.mul(q.y,u);h.wSub(n,k,n,R),c-=r*(K.cross(C.rA,k)+K.cross(M.rA,R)),_.wAdd(m,k,m,R),l+=a*(K.cross(C.rB,k)+K.cross(M.rB,R)),C.normalImpulse=F.x,M.normalImpulse=F.y;break}if(F.x=0,F.y=-M.normalMass*L.y,V=this.v_K.ey.x*F.y+L.x,(z=0)<=F.y&&0<=V){q=K.sub(F,I),k=K.mul(q.x,u),R=K.mul(q.y,u);h.wSub(n,k,n,R),c-=r*(K.cross(C.rA,k)+K.cross(M.rA,R)),_.wAdd(m,k,m,R),l+=a*(K.cross(C.rB,k)+K.cross(M.rB,R)),C.normalImpulse=F.x,M.normalImpulse=F.y;break}if(F.x=0,F.y=0,V=L.x,z=L.y,0<=V&&0<=z){q=K.sub(F,I),k=K.mul(q.x,u),R=K.mul(q.y,u);h.wSub(n,k,n,R),c-=r*(K.cross(C.rA,k)+K.cross(M.rA,R)),_.wAdd(m,k,m,R),l+=a*(K.cross(C.rB,k)+K.cross(M.rB,R)),C.normalImpulse=F.x,M.normalImpulse=F.y;break}break}}e.v.set(h),e.w=c,s.v.set(_),s.w=l};var _=[];c.addType=function(t,i,o){_[t]=_[t]||{},_[t][i]=o},c.create=function(t,i,o,e){var s,n,r=t.getType(),m=o.getType();if(n=_[r]&&_[r][m])s=new c(t,i,o,e,n);else{if(!(n=_[m]&&_[m][r]))return null;s=new c(o,e,t,i,n)}t=s.getFixtureA(),o=s.getFixtureB(),i=s.getChildIndexA(),e=s.getChildIndexB();var a=t.getBody(),h=o.getBody();return(s.m_nodeA.contact=s).m_nodeA.other=h,s.m_nodeA.prev=null,s.m_nodeA.next=a.m_contactList,null!=a.m_contactList&&(a.m_contactList.prev=s.m_nodeA),a.m_contactList=s.m_nodeA,(s.m_nodeB.contact=s).m_nodeB.other=a,s.m_nodeB.prev=null,s.m_nodeB.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=s.m_nodeB),h.m_contactList=s.m_nodeB,0==t.isSensor()&&0==o.isSensor()&&(a.setAwake(!0),h.setAwake(!0)),s},c.destroy=function(t,i){var o=t.m_fixtureA,e=t.m_fixtureB,s=o.getBody(),n=e.getBody();t.isTouching()&&i.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),0<t.m_manifold.pointCount&&0==o.isSensor()&&0==e.isSensor()&&(s.setAwake(!0),n.setAwake(!0));var r=o.getType(),m=e.getType(),a=_[r][m].destroyFcn;"function"==typeof a&&a(t)}},{"./Manifold":6,"./Settings":7,"./collision/Distance":13,"./common/Mat22":16,"./common/Math":18,"./common/Rot":20,"./common/Transform":22,"./common/Vec2":23,"./util/common":50}],4:[function(t,i,o){i.exports=e;t("./util/common");var n=t("./util/options"),a=(t("./common/Math"),t("./common/Vec2")),h=t("./collision/AABB"),r={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};function m(t,i){this.aabb=new h,this.fixture=t,this.childIndex=i,this.proxyId}function e(t,i,o){i.shape?i=(o=i).shape:"number"==typeof o&&(o={density:o}),o=n(o,r),this.m_body=t,this.m_friction=o.friction,this.m_restitution=o.restitution,this.m_density=o.density,this.m_isSensor=o.isSensor,this.m_filterGroupIndex=o.filterGroupIndex,this.m_filterCategoryBits=o.filterCategoryBits,this.m_filterMaskBits=o.filterMaskBits,this.m_shape=i,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var e=this.m_shape.getChildCount(),s=0;s<e;++s)this.m_proxies[s]=new m(this,s);this.m_userData=o.userData}e.prototype.getType=function(){return this.m_shape.getType()},e.prototype.getShape=function(){return this.m_shape},e.prototype.isSensor=function(){return this.m_isSensor},e.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},e.prototype.getUserData=function(){return this.m_userData},e.prototype.setUserData=function(t){this.m_userData=t},e.prototype.getBody=function(){return this.m_body},e.prototype.getNext=function(){return this.m_next},e.prototype.getDensity=function(){return this.m_density},e.prototype.setDensity=function(t){this.m_density=t},e.prototype.getFriction=function(){return this.m_friction},e.prototype.setFriction=function(t){this.m_friction=t},e.prototype.getRestitution=function(){return this.m_restitution},e.prototype.setRestitution=function(t){this.m_restitution=t},e.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},e.prototype.rayCast=function(t,i,o){return this.m_shape.rayCast(t,i,this.m_body.getTransform(),o)},e.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},e.prototype.getAABB=function(t){return this.m_proxies[t].aabb},e.prototype.createProxies=function(t,i){this.m_proxyCount=this.m_shape.getChildCount();for(var o=0;o<this.m_proxyCount;++o){var e=this.m_proxies[o];this.m_shape.computeAABB(e.aabb,i,o),e.proxyId=t.createProxy(e.aabb,e)}},e.prototype.destroyProxies=function(t){for(var i=0;i<this.m_proxyCount;++i){var o=this.m_proxies[i];t.destroyProxy(o.proxyId),o.proxyId=null}this.m_proxyCount=0},e.prototype.synchronize=function(t,i,o){for(var e=0;e<this.m_proxyCount;++e){var s=this.m_proxies[e],n=new h,r=new h;this.m_shape.computeAABB(n,i,s.childIndex),this.m_shape.computeAABB(r,o,s.childIndex),s.aabb.combine(n,r);var m=a.sub(o.p,i.p);t.moveProxy(s.proxyId,s.aabb,m)}},e.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},e.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},e.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},e.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},e.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var i=t.contact,o=i.getFixtureA(),e=i.getFixtureB();o!=this&&e!=this||i.flagForFiltering(),t=t.next}var s=this.m_body.getWorld();if(null!=s)for(var n=s.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},e.prototype.shouldCollide=function(t){return t.m_filterGroupIndex==this.m_filterGroupIndex&&0!=t.m_filterGroupIndex?0<t.m_filterGroupIndex:0!=(t.m_filterMaskBits&this.m_filterCategoryBits)&&0!=(t.m_filterCategoryBits&this.m_filterMaskBits)}},{"./collision/AABB":11,"./common/Math":18,"./common/Vec2":23,"./util/common":50,"./util/options":52}],5:[function(t,i,o){i.exports=s;t("./util/common");function e(){this.other=null,this.joint=null,this.prev=null,this.next=null}function s(t,i,o){i=t.bodyA||i,o=t.bodyB||o,this.m_type="unknown-joint",this.m_bodyA=i,this.m_bodyB=o,this.m_index=0,this.m_collideConnected=!!t.collideConnected,this.m_prev=null,this.m_next=null,this.m_edgeA=new e,this.m_edgeB=new e,this.m_islandFlag=!1,this.m_userData=t.userData}s.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},s.prototype.getType=function(){return this.m_type},s.prototype.getBodyA=function(){return this.m_bodyA},s.prototype.getBodyB=function(){return this.m_bodyB},s.prototype.getNext=function(){return this.m_next},s.prototype.getUserData=function(){return this.m_userData},s.prototype.setUserData=function(t){this.m_userData=t},s.prototype.getCollideConnected=function(){return this.m_collideConnected},s.prototype.getAnchorA=function(){},s.prototype.getAnchorB=function(){},s.prototype.getReactionForce=function(t){},s.prototype.getReactionTorque=function(t){},s.prototype.shiftOrigin=function(t){},s.prototype.initVelocityConstraints=function(t){},s.prototype.solveVelocityConstraints=function(t){},s.prototype.solvePositionConstraints=function(t){}},{"./util/common":50}],6:[function(t,i,o){t("./util/common");var d=t("./common/Vec2"),v=t("./common/Transform"),f=t("./common/Math"),x=t("./common/Rot");function A(){this.type,this.localNormal=d.zero(),this.localPoint=d.zero(),this.points=[new e,new e],this.pointCount=0}function e(){this.localPoint=d.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new s}function s(){this.cf=new n;Object.defineProperty(this,"key",{get:function(){return this.cf.indexA+4*this.cf.indexB+16*this.cf.typeA+64*this.cf.typeB},enumerable:!0,configurable:!0})}function n(){this.indexA,this.indexB,this.typeA,this.typeB}function g(){this.normal,this.points=[],this.separations=[]}i.exports=A,i.exports.clipSegmentToLine=function(t,i,o,e,s){var n=0,r=d.dot(o,i[0].v)-e,m=d.dot(o,i[1].v)-e;r<=0&&t[n++].set(i[0]);m<=0&&t[n++].set(i[1]);if(r*m<0){var a=r/(r-m);t[n].v.wSet(1-a,i[0].v,a,i[1].v),t[n].id.cf.indexA=s,t[n].id.cf.indexB=i[0].id.cf.indexB,t[n].id.cf.typeA=A.e_vertex,t[n].id.cf.typeB=A.e_face,++n}return n},i.exports.clipVertex=r,i.exports.getPointStates=function(t,i,o,e){for(var s=0;s<o.pointCount;++s){var n=o.points[s].id;t[s]=m.removeState;for(var r=0;r<e.pointCount;++r)if(e.points[r].id.key==n.key){t[s]=m.persistState;break}}for(var s=0;s<e.pointCount;++s){var n=e.points[s].id;i[s]=m.addState;for(var r=0;r<o.pointCount;++r)if(o.points[r].id.key==n.key){i[s]=m.persistState;break}}},i.exports.PointState=m,A.e_circles=0,A.e_faceA=1,A.e_faceB=2,A.e_vertex=0,A.e_face=1,s.prototype.set=function(t){this.cf.set(t.cf)},n.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB},A.prototype.getWorldManifold=function(t,i,o,e,s){if(0!=this.pointCount){var n=(t=t||new g).normal,r=t.points,m=t.separations;switch(this.type){case A.e_circles:n=d.neo(1,0);var a=v.mul(i,this.localPoint),h=v.mul(e,this.points[0].localPoint),c=d.sub(h,a);d.lengthSquared(c)>f.EPSILON*f.EPSILON&&(n.set(c),n.normalize()),r[0]=d.mid(a,h),m[0]=-s-o,r.length=1,m.length=1;break;case A.e_faceA:n=x.mul(i.q,this.localNormal);for(var _=v.mul(i,this.localPoint),l=0;l<this.pointCount;++l){var u=v.mul(e,this.points[l].localPoint),p=d.clone(u).wAdd(o-d.dot(d.sub(u,_),n),n),y=d.clone(u).wSub(s,n);r[l]=d.mid(p,y),m[l]=d.dot(d.sub(y,p),n)}r.length=this.pointCount,m.length=this.pointCount;break;case A.e_faceB:n=x.mul(e.q,this.localNormal);for(_=v.mul(e,this.localPoint),l=0;l<this.pointCount;++l){u=v.mul(i,this.points[l].localPoint),y=d.zero().wSet(1,u,s-d.dot(d.sub(u,_),n),n),p=d.zero().wSet(1,u,-o,n);r[l]=d.mid(p,y),m[l]=d.dot(d.sub(p,y),n)}r.length=this.pointCount,m.length=this.pointCount,n.mul(-1)}return t.normal=n,t.points=r,t.separations=m,t}};var m={nullState:0,addState:1,persistState:2,removeState:3};function r(){this.v=d.zero(),this.id=new s}r.prototype.set=function(t){this.v.set(t.v),this.id.set(t.id)}},{"./common/Math":18,"./common/Rot":20,"./common/Transform":22,"./common/Vec2":23,"./util/common":50}],7:[function(t,i,o){var e=o;e.maxManifoldPoints=2,e.maxPolygonVertices=12,e.aabbExtension=.1,e.aabbMultiplier=2,e.linearSlop=.005,e.linearSlopSquared=e.linearSlop*e.linearSlop,e.angularSlop=2/180*Math.PI,e.polygonRadius=2*e.linearSlop,e.maxSubSteps=8,e.maxTOIContacts=32,e.maxTOIIterations=20,e.maxDistnceIterations=20,e.velocityThreshold=1,e.maxLinearCorrection=.2,e.maxAngularCorrection=8/180*Math.PI,e.maxTranslation=2,e.maxTranslationSquared=e.maxTranslation*e.maxTranslation,e.maxRotation=.5*Math.PI,e.maxRotationSquared=e.maxRotation*e.maxRotation,e.baumgarte=.2,e.toiBaugarte=.75,e.timeToSleep=.5,e.linearSleepTolerance=.01,e.linearSleepToleranceSqr=Math.pow(e.linearSleepTolerance,2),e.angularSleepTolerance=2/180*Math.PI,e.angularSleepToleranceSqr=Math.pow(e.angularSleepTolerance,2)},{}],8:[function(t,i,o){i.exports=e;t("./common/Math");function e(){this.m_type,this.m_radius}e.isValid=function(t){return!!t},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getType=function(){return this.m_type},e.prototype._clone=function(){},e.prototype.getChildCount=function(){},e.prototype.testPoint=function(t,i){},e.prototype.rayCast=function(t,i,o,e){},e.prototype.computeAABB=function(t,i,o){},e.prototype.computeMass=function(t,i){},e.prototype.computeDistanceProxy=function(t){}},{"./common/Math":18}],9:[function(t,i,o){i.exports=r,i.exports.TimeStep=n;var z=t("./Settings"),e=t("./util/common"),w=t("./common/Vec2"),L=t("./common/Math"),F=(t("./Body"),t("./Contact"),t("./Joint"),t("./collision/TimeOfImpact")),q=F.Input,k=F.Output,s=t("./collision/Distance");s.Input,s.Output,s.Proxy,s.Cache;function n(t){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}function r(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}n.prototype.reset=function(t){0<this.dt&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},r.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},r.prototype.addBody=function(t){this.m_bodies.push(t)},r.prototype.addContact=function(t){this.m_contacts.push(t)},r.prototype.addJoint=function(t){this.m_joints.push(t)},r.prototype.solveWorld=function(t){for(var i=this.m_world,o=i.m_bodyList;o;o=o.m_next)o.m_islandFlag=!1;for(var e=i.m_contactList;e;e=e.m_next)e.m_islandFlag=!1;for(var s=i.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=this.m_stack,r=i.m_bodyList;r;r=r.m_next)if(0,!r.m_islandFlag&&0!=r.isAwake()&&0!=r.isActive()&&!r.isStatic()){for(this.clear(),n.push(r),r.m_islandFlag=!0;0<n.length;){o=n.pop();if(this.addBody(o),o.setAwake(!0),!o.isStatic()){for(var m=o.m_contactList;m;m=m.next){var a=m.contact;if(!a.m_islandFlag&&(0!=a.isEnabled()&&0!=a.isTouching())){var h=a.m_fixtureA.m_isSensor,c=a.m_fixtureB.m_isSensor;if(!h&&!c)this.addContact(a),a.m_islandFlag=!0,(l=m.other).m_islandFlag||(n.push(l),l.m_islandFlag=!0)}}for(var _=o.m_jointList;_;_=_.next){var l;if(1!=_.joint.m_islandFlag)0!=(l=_.other).isActive()&&(this.addJoint(_.joint),_.joint.m_islandFlag=!0,l.m_islandFlag||(n.push(l),l.m_islandFlag=!0))}}}this.solveIsland(t);for(var u=0;u<this.m_bodies.length;++u){(o=this.m_bodies[u]).isStatic()&&(o.m_islandFlag=!1)}}},r.prototype.solveIsland=function(t){for(var i=this.m_world,o=i.m_gravity,e=i.m_allowSleep,s=t.dt,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],m=w.clone(r.m_sweep.c),a=r.m_sweep.a,h=w.clone(r.m_linearVelocity),c=r.m_angularVelocity;r.m_sweep.c0.set(r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.isDynamic()&&(h.wAdd(s*r.m_gravityScale,o),h.wAdd(s*r.m_invMass,r.m_force),c+=s*r.m_invI*r.m_torque,h.mul(1/(1+s*r.m_linearDamping)),c*=1/(1+s*r.m_angularDamping)),r.c_position.c=m,r.c_position.a=a,r.c_velocity.v=h,r.c_velocity.w=c}for(n=0;n<this.m_contacts.length;++n){this.m_contacts[n].initConstraint(t)}for(n=0;n<this.m_contacts.length;++n){this.m_contacts[n].initVelocityConstraint(t)}if(t.warmStarting)for(n=0;n<this.m_contacts.length;++n){this.m_contacts[n].warmStartConstraint(t)}for(n=0;n<this.m_joints.length;++n){this.m_joints[n].initVelocityConstraints(t)}for(n=0;n<t.velocityIterations;++n){for(var _=0;_<this.m_joints.length;++_){this.m_joints[_].solveVelocityConstraints(t)}for(_=0;_<this.m_contacts.length;++_){this.m_contacts[_].solveVelocityConstraint(t)}}for(n=0;n<this.m_contacts.length;++n){this.m_contacts[n].storeConstraintImpulses(t)}for(n=0;n<this.m_bodies.length;++n){r=this.m_bodies[n],m=w.clone(r.c_position.c),a=r.c_position.a,h=w.clone(r.c_velocity.v),c=r.c_velocity.w;var l=w.mul(s,h);if(w.lengthSquared(l)>z.maxTranslationSquared){var u=z.maxTranslation/l.length();h.mul(u)}var p=s*c;if(p*p>z.maxRotationSquared)c*=u=z.maxRotation/L.abs(p);m.wAdd(s,h),a+=s*c,r.c_position.c.set(m),r.c_position.a=a,r.c_velocity.v.set(h),r.c_velocity.w=c}var y=!1;for(n=0;n<t.positionIterations;++n){var d=0;for(_=0;_<this.m_contacts.length;++_){var v=this.m_contacts[_].solvePositionConstraint(t);d=L.min(d,v)}var f=d>=-3*z.linearSlop,x=!0;for(_=0;_<this.m_joints.length;++_){var A=this.m_joints[_].solvePositionConstraints(t);x=x&&A}if(f&&x){y=!0;break}}for(n=0;n<this.m_bodies.length;++n){(r=this.m_bodies[n]).m_sweep.c.set(r.c_position.c),r.m_sweep.a=r.c_position.a,r.m_linearVelocity.set(r.c_velocity.v),r.m_angularVelocity=r.c_velocity.w,r.synchronizeTransform()}if(this.postSolveIsland(),e){var g=1/0,b=z.linearSleepToleranceSqr,B=z.angularSleepToleranceSqr;for(n=0;n<this.m_bodies.length;++n){(r=this.m_bodies[n]).isStatic()||(0==r.m_autoSleepFlag||r.m_angularVelocity*r.m_angularVelocity>B||w.lengthSquared(r.m_linearVelocity)>b?g=r.m_sleepTime=0:(r.m_sleepTime+=s,g=L.min(g,r.m_sleepTime)))}if(g>=z.timeToSleep&&y)for(n=0;n<this.m_bodies.length;++n){(r=this.m_bodies[n]).setAwake(!1)}}},r.prototype.printBodies=function(t){for(var i=0;i<this.m_bodies.length;++i){var o=this.m_bodies[i];e.debug(t,o.c_position.a,o.c_position.c.x,o.c_position.c.y,o.c_velocity.w,o.c_velocity.v.x,o.c_velocity.v.y)}};var R=new n;function m(){this.normalImpulses=[],this.tangentImpulses=[]}r.prototype.solveWorldTOI=function(t){var i=this.m_world;if(i.m_stepComplete){for(var o=i.m_bodyList;o;o=o.m_next)o.m_islandFlag=!1,o.m_sweep.alpha0=0;for(var e=i.m_contactList;e;e=e.m_next)e.m_toiFlag=!1,e.m_islandFlag=!1,e.m_toiCount=0,e.m_toi=1}for(;;){for(var s=null,n=1,e=i.m_contactList;e;e=e.m_next)if(0!=e.isEnabled()&&!(e.m_toiCount>z.maxSubSteps)){var r=1;if(e.m_toiFlag)r=e.m_toi;else{var m=e.getFixtureA(),a=e.getFixtureB();if(m.isSensor()||a.isSensor())continue;var h=m.getBody(),c=a.getBody(),_=h.isAwake()&&!h.isStatic(),l=c.isAwake()&&!c.isStatic();if(0==_&&0==l)continue;var u=h.isBullet()||!h.isDynamic(),p=c.isBullet()||!c.isDynamic();if(0==u&&0==p)continue;var y=h.m_sweep.alpha0;h.m_sweep.alpha0<c.m_sweep.alpha0?(y=c.m_sweep.alpha0,h.m_sweep.advance(y)):c.m_sweep.alpha0<h.m_sweep.alpha0&&(y=h.m_sweep.alpha0,c.m_sweep.advance(y));var d=e.getChildIndexA(),v=e.getChildIndexB(),f=(h.m_sweep,c.m_sweep,new q);f.proxyA.set(m.getShape(),d),f.proxyB.set(a.getShape(),v),f.sweepA.set(h.m_sweep),f.sweepB.set(c.m_sweep),f.tMax=1;var x=new k;F(x,f);var A=x.t;r=x.state==k.e_touching?L.min(y+(1-y)*A,1):1,e.m_toi=r,e.m_toiFlag=!0}r<n&&(s=e,n=r)}if(null==s||1-10*L.EPSILON<n){i.m_stepComplete=!0;break}m=s.getFixtureA(),a=s.getFixtureB(),h=m.getBody(),c=a.getBody();var g=h.m_sweep.clone(),b=c.m_sweep.clone();if(h.advance(n),c.advance(n),s.update(i),s.m_toiFlag=!1,++s.m_toiCount,0!=s.isEnabled()&&0!=s.isTouching()){h.setAwake(!0),c.setAwake(!0),this.clear(),this.addBody(h),this.addBody(c),this.addContact(s),h.m_islandFlag=!0,c.m_islandFlag=!0,s.m_islandFlag=!0;for(var B=[h,c],w=0;w<B.length;++w){if((V=B[w]).isDynamic())for(var S=V.m_contactList;S;S=S.next){var C=S.contact;if(!C.m_islandFlag){var M=S.other;if(!M.isDynamic()||V.isBullet()||M.isBullet()){var I=C.m_fixtureA.m_isSensor,P=C.m_fixtureB.m_isSensor;if(!I&&!P){var T=M.m_sweep.clone();0==M.m_islandFlag&&M.advance(n),C.update(i),0!=C.isEnabled()&&0!=C.isTouching()?(C.m_islandFlag=!0,this.addContact(C),M.m_islandFlag||(M.m_islandFlag=!0,M.isStatic()||M.setAwake(!0),this.addBody(M))):(M.m_sweep.set(T),M.synchronizeTransform())}}}}}R.reset((1-n)*t.dt),R.dtRatio=1,R.positionIterations=20,R.velocityIterations=t.velocityIterations,R.warmStarting=!1,this.solveIslandTOI(R,h,c);for(w=0;w<this.m_bodies.length;++w){var V;if((V=this.m_bodies[w]).m_islandFlag=!1,V.isDynamic()){V.synchronizeFixtures();for(S=V.m_contactList;S;S=S.next)S.contact.m_toiFlag=!1,S.contact.m_islandFlag=!1}}if(i.findNewContacts(),i.m_subStepping){i.m_stepComplete=!1;break}}else s.setEnabled(!1),h.m_sweep.set(g),c.m_sweep.set(b),h.synchronizeTransform(),c.synchronizeTransform()}},r.prototype.solveIslandTOI=function(t,i,o){this.m_world;for(var e=0;e<this.m_bodies.length;++e){(a=this.m_bodies[e]).c_position.c.set(a.m_sweep.c),a.c_position.a=a.m_sweep.a,a.c_velocity.v.set(a.m_linearVelocity),a.c_velocity.w=a.m_angularVelocity}for(var e=0;e<this.m_contacts.length;++e){this.m_contacts[e].initConstraint(t)}for(e=0;e<t.positionIterations;++e){for(var s=0,n=0;n<this.m_contacts.length;++n){var r=this.m_contacts[n].solvePositionConstraintTOI(t,i,o);s=L.min(s,r)}if(s>=-1.5*z.linearSlop)break}i.m_sweep.c0.set(i.c_position.c),i.m_sweep.a0=i.c_position.a,o.m_sweep.c0.set(o.c_position.c),o.m_sweep.a0=o.c_position.a;for(e=0;e<this.m_contacts.length;++e){this.m_contacts[e].initVelocityConstraint(t)}for(e=0;e<t.velocityIterations;++e)for(n=0;n<this.m_contacts.length;++n){this.m_contacts[n].solveVelocityConstraint(t)}var m=t.dt;for(e=0;e<this.m_bodies.length;++e){var a=this.m_bodies[e],h=w.clone(a.c_position.c),c=a.c_position.a,_=w.clone(a.c_velocity.v),l=a.c_velocity.w,u=w.mul(m,_);if(w.dot(u,u)>z.maxTranslationSquared){var p=z.maxTranslation/u.length();_.mul(p)}var y=m*l;if(y*y>z.maxRotationSquared)l*=p=z.maxRotation/L.abs(y);h.wAdd(m,_),c+=m*l,a.c_position.c=h,a.c_position.a=c,a.c_velocity.v=_,a.c_velocity.w=l,a.m_sweep.c=h,a.m_sweep.a=c,a.m_linearVelocity=_,a.m_angularVelocity=l,a.synchronizeTransform()}this.postSolveIsland()},r.prototype.postSolveIsland=function(){for(var t=new m,i=0;i<this.m_contacts.length;++i){for(var o=this.m_contacts[i],e=0;e<o.v_points.length;++e)t.normalImpulses.push(o.v_points[e].normalImpulse),t.tangentImpulses.push(o.v_points[e].tangentImpulse);this.m_world.postSolve(o,t)}}},{"./Body":2,"./Contact":3,"./Joint":5,"./Settings":7,"./collision/Distance":13,"./collision/TimeOfImpact":15,"./common/Math":18,"./common/Vec2":23,"./util/common":50}],10:[function(t,i,o){i.exports=a;var e=t("./util/options"),c=(t("./util/common"),t("./common/Vec2")),s=t("./collision/BroadPhase"),n=t("./Solver"),r=t("./Body"),p=t("./Contact"),m={gravity:c.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};function a(t){if(!(this instanceof a))return new a(t);t&&c.isValid(t)&&(t={gravity:t}),t=e(t,m),this.m_solver=new n(this),this.m_broadPhase=new s,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=c.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0,this.m_stepCount=0,this.addPair=this.createContact.bind(this)}a.prototype.getBodyList=function(){return this.m_bodyList},a.prototype.getJointList=function(){return this.m_jointList},a.prototype.getContactList=function(){return this.m_contactList},a.prototype.getBodyCount=function(){return this.m_bodyCount},a.prototype.getJointCount=function(){return this.m_jointCount},a.prototype.getContactCount=function(){return this.m_contactCount},a.prototype.setGravity=function(t){this.m_gravity=t},a.prototype.getGravity=function(){return this.m_gravity},a.prototype.isLocked=function(){return this.m_locked},a.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var i=this.m_bodyList;i;i=i.m_next)i.setAwake(!0)},a.prototype.getAllowSleeping=function(){return this.m_allowSleep},a.prototype.setWarmStarting=function(t){this.m_warmStarting=t},a.prototype.getWarmStarting=function(){return this.m_warmStarting},a.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},a.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},a.prototype.setSubStepping=function(t){this.m_subStepping=t},a.prototype.getSubStepping=function(){return this.m_subStepping},a.prototype.setAutoClearForces=function(t){this.m_clearForces=t},a.prototype.getAutoClearForces=function(){return this.m_clearForces},a.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},a.prototype.queryAABB=function(t,o){var e=this.m_broadPhase;this.m_broadPhase.query(t,function(t){var i=e.getUserData(t);return o(i.fixture)})},a.prototype.rayCast=function(t,i,a){var h=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:i},function(t,i){var o=h.getUserData(i),e=o.fixture,s=o.childIndex,n={};if(e.rayCast(n,t,s)){var r=n.fraction,m=c.add(c.mul(1-r,t.p1),c.mul(r,t.p2));return a(e,m,n.normal,r)}return t.maxFraction})},a.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},a.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},a.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},a.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},a.prototype.shiftOrigin=function(t){if(!this.m_locked){for(var i=this.m_bodyList;i;i=i.m_next)i.m_xf.p.sub(t),i.m_sweep.c0.sub(t),i.m_sweep.c.sub(t);for(var o=this.m_jointList;o;o=o.m_next)o.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},a.prototype.createBody=function(t,i){if(this.isLocked())return null;t&&c.isValid(t)&&(t={position:t,angle:i});var o=new r(this,t);return o.m_prev=null,o.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=o),this.m_bodyList=o,++this.m_bodyCount,o},a.prototype.createDynamicBody=function(t,i){return t?c.isValid(t)&&(t={position:t,angle:i}):t={},t.type="dynamic",this.createBody(t)},a.prototype.createKinematicBody=function(t,i){return t?c.isValid(t)&&(t={position:t,angle:i}):t={},t.type="kinematic",this.createBody(t)},a.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var i=t.m_jointList;i;){var o=i;i=i.next,this.publish("remove-joint",o.joint),this.destroyJoint(o.joint),t.m_jointList=i}t.m_jointList=null;for(var e=t.m_contactList;e;){var s=e;e=e.next,this.destroyContact(s.contact),t.m_contactList=e}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var r=n;n=n.m_next,this.publish("remove-fixture",r),r.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,!0}},a.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,(t.m_edgeA.joint=t).m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,(t.m_edgeB.joint=t).m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(var i=t.m_bodyB.getContactList();i;i=i.next)i.other==t.m_bodyA&&i.contact.flagForFiltering();return t},a.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_bodyA,o=t.m_bodyB;if(i.setAwake(!0),o.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==o.m_jointList&&(o.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,0==t.m_collideConnected)for(var e=o.getContactList();e;)e.other==i&&e.contact.flagForFiltering(),e=e.next;this.publish("remove-joint",t)}};var h=new n.TimeStep;a.prototype.step=function(t,i,o){if((0|i)!==i&&(i=0),i=i||this.m_velocityIterations,o=o||this.m_positionIterations,this.m_stepCount++,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,h.reset(t),h.velocityIterations=i,h.positionIterations=o,h.warmStarting=this.m_warmStarting,h.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&0<t){this.m_solver.solveWorld(h);for(var e=this.m_bodyList;e;e=e.getNext())0!=e.m_islandFlag&&(e.isStatic()||e.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&0<t&&this.m_solver.solveWorldTOI(h),this.m_clearForces&&this.clearForces(),this.m_locked=!1},a.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.addPair)},a.prototype.createContact=function(t,i){var o=t.fixture,e=i.fixture,s=t.childIndex,n=i.childIndex,r=o.getBody(),m=e.getBody();if(r!=m){for(var a=m.getContactList();a;){if(a.other==r){var h=a.contact.getFixtureA(),c=a.contact.getFixtureB(),_=a.contact.getChildIndexA(),l=a.contact.getChildIndexB();if(h==o&&c==e&&_==s&&l==n)return;if(h==e&&c==o&&_==n&&l==s)return}a=a.next}if(0!=m.shouldCollide(r)&&0!=e.shouldCollide(o)){var u=p.create(o,s,e,n);null!=u&&((u.m_prev=null)!=this.m_contactList&&(u.m_next=this.m_contactList,this.m_contactList.m_prev=u),this.m_contactList=u,++this.m_contactCount)}}},a.prototype.updateContacts=function(){for(var t,i=this.m_contactList;t=i;){i=t.getNext();var o=t.getFixtureA(),e=t.getFixtureB(),s=t.getChildIndexA(),n=t.getChildIndexB(),r=o.getBody(),m=e.getBody();if(t.m_filterFlag){if(0==m.shouldCollide(r)){this.destroyContact(t);continue}if(0==e.shouldCollide(o)){this.destroyContact(t);continue}t.m_filterFlag=!1}var a=r.isAwake()&&!r.isStatic(),h=m.isAwake()&&!m.isStatic();if(0!=a||0!=h){var c=o.m_proxies[s].proxyId,_=e.m_proxies[n].proxyId;0!=this.m_broadPhase.testOverlap(c,_)?t.update(this):this.destroyContact(t)}}},a.prototype.destroyContact=function(t){p.destroy(t,this),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),--this.m_contactCount},a.prototype._listeners=null,a.prototype.on=function(t,i){return"string"!=typeof t||"function"!=typeof i||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(i)),this},a.prototype.off=function(t,i){if("string"!=typeof t||"function"!=typeof i)return this;var o=this._listeners&&this._listeners[t];if(!o||!o.length)return this;var e=o.indexOf(i);return 0<=e&&o.splice(e,1),this},a.prototype.publish=function(t,i,o,e){var s=this._listeners&&this._listeners[t];if(!s||!s.length)return 0;for(var n=0;n<s.length;n++)s[n].call(this,i,o,e);return s.length},a.prototype.beginContact=function(t){this.publish("begin-contact",t)},a.prototype.endContact=function(t){this.publish("end-contact",t)},a.prototype.preSolve=function(t,i){this.publish("pre-solve",t,i)},a.prototype.postSolve=function(t,i){this.publish("post-solve",t,i)}},{"./Body":2,"./Contact":3,"./Solver":9,"./collision/BroadPhase":12,"./common/Vec2":23,"./util/common":50,"./util/options":52}],11:[function(t,i,o){t("../Settings");var p=t("../common/Math"),y=t("../common/Vec2");function e(t,i){if(!(this instanceof e))return new e(t,i);this.lowerBound=y.zero(),this.upperBound=y.zero(),"object"==typeof t&&this.lowerBound.set(t),"object"==typeof i&&this.upperBound.set(i)}(i.exports=e).prototype.isValid=function(){return e.isValid(this)},e.isValid=function(t){var i=y.sub(t.upperBound,t.lowerBound);return 0<=i.x&&0<=i.y&&y.isValid(t.lowerBound)&&y.isValid(t.upperBound)},e.prototype.getCenter=function(){return y.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},e.prototype.getExtents=function(){return y.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},e.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},e.prototype.combine=function(t,i){i=i||this,this.lowerBound.set(p.min(t.lowerBound.x,i.lowerBound.x),p.min(t.lowerBound.y,i.lowerBound.y)),this.upperBound.set(p.max(t.upperBound.x,i.upperBound.x),p.max(t.upperBound.y,i.upperBound.y))},e.prototype.combinePoints=function(t,i){this.lowerBound.set(p.min(t.x,i.x),p.min(t.y,i.y)),this.upperBound.set(p.max(t.x,i.x),p.max(t.y,i.y))},e.prototype.set=function(t){this.lowerBound.set(t.lowerBound.x,t.lowerBound.y),this.upperBound.set(t.upperBound.x,t.upperBound.y)},e.prototype.contains=function(t){var i=!0;return i=(i=(i=(i=i&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},e.prototype.extend=function(t){e.extend(this,t)},e.extend=function(t,i){t.lowerBound.x-=i,t.lowerBound.y-=i,t.upperBound.x+=i,t.upperBound.y+=i},e.testOverlap=function(t,i){var o=i.lowerBound.x-t.upperBound.x,e=t.lowerBound.x-i.upperBound.x,s=i.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-i.upperBound.y;return!(0<o||0<s||0<e||0<n)},e.areEqual=function(t,i){return y.areEqual(t.lowerBound,i.lowerBound)&&y.areEqual(t.upperBound,i.upperBound)},e.diff=function(t,i){var o=p.max(0,p.min(t.upperBound.x,i.upperBound.x)-p.max(i.lowerBound.x,t.lowerBound.x)),e=p.max(0,p.min(t.upperBound.y,i.upperBound.y)-p.max(i.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(i.upperBound.x-i.lowerBound.x)*(i.upperBound.y-i.lowerBound.y)-o*e},e.prototype.rayCast=function(t,i){for(var o=-1/0,e=1/0,s=i.p1,n=y.sub(i.p2,i.p1),r=y.abs(n),m=y.zero(),a="x";null!==a;a="x"===a?"y":null)if(r.x<p.EPSILON){if(s[a]<this.lowerBound[a]||this.upperBound[a]<s[a])return!1}else{var h=1/n[a],c=(this.lowerBound[a]-s[a])*h,_=(this.upperBound[a]-s[a])*h,l=-1;if(_<c){var u=c;c=_,_=u,l=1}if(o<c&&(m.setZero(),m[a]=l,o=c),(e=p.min(e,_))<o)return!1}return!(o<0||i.maxFraction<o)&&(t.fraction=o,t.normal=m,!0)},e.prototype.toString=function(){return JSON.stringify(this)}},{"../Settings":7,"../common/Math":18,"../common/Vec2":23}],12:[function(t,i,o){t("../Settings"),t("../util/common");var n=t("../common/Math"),s=t("./AABB"),e=t("./DynamicTree");function r(){this.m_tree=new e,this.m_proxyCount=0,this.m_moveBuffer=[],this.queryCallback=this.queryCallback.bind(this)}(i.exports=r).prototype.getUserData=function(t){return this.m_tree.getUserData(t)},r.prototype.testOverlap=function(t,i){var o=this.m_tree.getFatAABB(t),e=this.m_tree.getFatAABB(i);return s.testOverlap(o,e)},r.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},r.prototype.getProxyCount=function(){return this.m_proxyCount},r.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},r.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},r.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},r.prototype.query=function(t,i){this.m_tree.query(t,i)},r.prototype.rayCast=function(t,i){this.m_tree.rayCast(t,i)},r.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},r.prototype.createProxy=function(t,i){var o=this.m_tree.createProxy(t,i);return this.m_proxyCount++,this.bufferMove(o),o},r.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_proxyCount--,this.m_tree.destroyProxy(t)},r.prototype.moveProxy=function(t,i,o){this.m_tree.moveProxy(t,i,o)&&this.bufferMove(t)},r.prototype.touchProxy=function(t){this.bufferMove(t)},r.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},r.prototype.unbufferMove=function(t){for(var i=0;i<this.m_moveBuffer.length;++i)this.m_moveBuffer[i]==t&&(this.m_moveBuffer[i]=null)},r.prototype.updatePairs=function(t){for(this.m_callback=t;0<this.m_moveBuffer.length;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var i=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(i,this.queryCallback)}},r.prototype.queryCallback=function(t){if(t==this.m_queryProxyId)return!0;var i=n.min(t,this.m_queryProxyId),o=n.max(t,this.m_queryProxyId),e=this.m_tree.getUserData(i),s=this.m_tree.getUserData(o);return this.m_callback(e,s),!0}},{"../Settings":7,"../common/Math":18,"../util/common":50,"./AABB":11,"./DynamicTree":14}],13:[function(t,i,o){i.exports=l,i.exports.Input=h,i.exports.Output=c,i.exports.Proxy=e,i.exports.Cache=_;var b=t("../Settings"),B=(t("../util/common"),t("../common/stats")),w=t("../common/Math"),S=t("../common/Vec2"),C=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),M=(t("../common/Sweep"),t("../common/Transform"));t("../common/Velocity"),t("../common/Position");function h(){this.proxyA=new e,this.proxyB=new e,this.transformA=null,this.transformB=null,this.useRadii=!1}function c(){this.pointA=S.zero(),this.pointB=S.zero(),this.distance,this.iterations}function _(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}function l(t,i,o){++B.gjkCalls;var e=o.proxyA,s=o.proxyB,n=o.transformA,r=o.transformB,m=new I;m.readCache(i,e,n,s,r);for(var a=m.m_v,h=b.maxDistnceIterations,c=[],_=[],l=0,u=0;u<h;){l=m.m_count;for(var p=0;p<l;++p)c[p]=a[p].indexA,_[p]=a[p].indexB;if(m.solve(),3==m.m_count)break;(g=m.getClosestPoint()).lengthSquared();var y=m.getSearchDirection();if(y.lengthSquared()<w.EPSILON*w.EPSILON)break;var d=a[m.m_count];d.indexA=e.getSupport(C.mulT(n.q,S.neg(y))),d.wA=M.mul(n,e.getVertex(d.indexA)),d.indexB=s.getSupport(C.mulT(r.q,y)),d.wB=M.mul(r,s.getVertex(d.indexB)),d.w=S.sub(d.wB,d.wA),++u,++B.gjkIters;var v=!1;for(p=0;p<l;++p)if(d.indexA==c[p]&&d.indexB==_[p]){v=!0;break}if(v)break;++m.m_count}if(B.gjkMaxIters=w.max(B.gjkMaxIters,u),m.getWitnessPoints(t.pointA,t.pointB),t.distance=S.distance(t.pointA,t.pointB),t.iterations=u,m.writeCache(i),o.useRadii){var f=e.m_radius,x=s.m_radius;if(t.distance>f+x&&t.distance>w.EPSILON){t.distance-=f+x;var A=S.sub(t.pointB,t.pointA);A.normalize(),t.pointA.wAdd(f,A),t.pointB.wSub(x,A)}else{var g=S.mid(t.pointA,t.pointB);t.pointA.set(g),t.pointB.set(g),t.distance=0}}}function e(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}function s(){this.indexA,this.indexB,this.wA=S.zero(),this.wB=S.zero(),this.w=S.zero(),this.a}function I(){this.m_v1=new s,this.m_v2=new s,this.m_v3=new s,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}B.gjkCalls=0,B.gjkIters=0,B.gjkMaxIters=0,e.prototype.getVertexCount=function(){return this.m_count},e.prototype.getVertex=function(t){return this.m_vertices[t]},e.prototype.getSupport=function(t){for(var i=0,o=S.dot(this.m_vertices[0],t),e=0;e<this.m_count;++e){var s=S.dot(this.m_vertices[e],t);o<s&&(i=e,o=s)}return i},e.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},e.prototype.set=function(t,i){t.computeDistanceProxy(this,i)},s.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.wA=S.clone(t.wA),this.wB=S.clone(t.wB),this.w=S.clone(t.w),this.a=t.a},I.prototype.print=function(){return 3==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},I.prototype.readCache=function(t,i,o,e,s){this.m_count=t.count;for(var n=0;n<this.m_count;++n){(c=this.m_v[n]).indexA=t.indexA[n],c.indexB=t.indexB[n];var r=i.getVertex(c.indexA),m=e.getVertex(c.indexB);c.wA=M.mul(o,r),c.wB=M.mul(s,m),c.w=S.sub(c.wB,c.wA),c.a=0}if(1<this.m_count){var a=t.metric,h=this.getMetric();(h<.5*a||2*a<h||h<w.EPSILON)&&(this.m_count=0)}if(0==this.m_count){var c;(c=this.m_v[0]).indexA=0,c.indexB=0;r=i.getVertex(0),m=e.getVertex(0);c.wA=M.mul(o,r),c.wB=M.mul(s,m),c.w=S.sub(c.wB,c.wA),c.a=1,this.m_count=1}},I.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var i=0;i<this.m_count;++i)t.indexA[i]=this.m_v[i].indexA,t.indexB[i]=this.m_v[i].indexB},I.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return S.neg(this.m_v1.w);case 2:var t=S.sub(this.m_v2.w,this.m_v1.w);return 0<S.cross(t,S.neg(this.m_v1.w))?S.cross(1,t):S.cross(t,1);default:return S.zero()}},I.prototype.getClosestPoint=function(){switch(this.m_count){case 0:return S.zero();case 1:return S.clone(this.m_v1.w);case 2:return S.wAdd(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:default:return S.zero()}},I.prototype.getWitnessPoints=function(t,i){switch(this.m_count){case 0:break;case 1:t.set(this.m_v1.wA),i.set(this.m_v1.wB);break;case 2:t.wSet(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),i.wSet(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:t.wSet(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.wAdd(this.m_v3.a,this.m_v3.wA),i.set(t)}},I.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return S.distance(this.m_v1.w,this.m_v2.w);case 3:return S.cross(S.sub(this.m_v2.w,this.m_v1.w),S.sub(this.m_v3.w,this.m_v1.w));default:return 0}},I.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},I.prototype.solve2=function(){var t=this.m_v1.w,i=this.m_v2.w,o=S.sub(i,t),e=-S.dot(t,o);if(e<=0)return this.m_v1.a=1,void(this.m_count=1);var s=S.dot(i,o);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var n=1/(s+e);this.m_v1.a=s*n,this.m_v2.a=e*n,this.m_count=2},I.prototype.solve3=function(){var t=this.m_v1.w,i=this.m_v2.w,o=this.m_v3.w,e=S.sub(i,t),s=S.dot(t,e),n=S.dot(i,e),r=-s,m=S.sub(o,t),a=S.dot(t,m),h=S.dot(o,m),c=-a,_=S.sub(o,i),l=S.dot(i,_),u=S.dot(o,_),p=-l,y=S.cross(e,m),d=y*S.cross(i,o),v=y*S.cross(o,t),f=y*S.cross(t,i);if(r<=0&&c<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<n&&0<r&&f<=0){var x=1/(n+r);return this.m_v1.a=n*x,this.m_v2.a=r*x,void(this.m_count=2)}if(0<h&&0<c&&v<=0){var A=1/(h+c);return this.m_v1.a=h*A,this.m_v3.a=c*A,this.m_count=2,void this.m_v2.set(this.m_v3)}if(n<=0&&p<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(h<=0&&u<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(0<u&&0<p&&d<=0){var g=1/(u+p);return this.m_v2.a=u*g,this.m_v3.a=p*g,this.m_count=2,void this.m_v1.set(this.m_v3)}var b=1/(d+v+f);this.m_v1.a=d*b,this.m_v2.a=v*b,this.m_v3.a=f*b,this.m_count=3},l.testOverlap=function(t,i,o,e,s,n){var r=new h;r.proxyA.set(t,i),r.proxyB.set(o,e),r.transformA=s,r.transformB=n,r.useRadii=!0;var m=new _,a=new c;return l(a,m,r),a.distance<10*w.EPSILON}},{"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../common/stats":26,"../util/common":50}],14:[function(t,i,o){var s=t("../Settings"),e=(t("../util/common"),t("../util/Pool")),d=t("../common/Vec2"),v=t("../common/Math"),f=t("./AABB");function n(t){this.id=t,this.aabb=new f,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.toString=function(){return this.id+": "+this.userData}}function r(){this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new e({create:function(){return new n}})}i.exports=r,n.prototype.isLeaf=function(){return null==this.child1},r.prototype.getUserData=function(t){var i=this.m_nodes[t];return i.userData},r.prototype.getFatAABB=function(t){var i=this.m_nodes[t];return i.aabb},r.prototype.allocateNode=function(){var t=this.m_pool.allocate();return t.id=++this.m_lastProxyId,t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,this.m_nodes[t.id]=t},r.prototype.freeNode=function(t){this.m_pool.release(t),t.height=-1,delete this.m_nodes[t.id]},r.prototype.createProxy=function(t,i){var o=this.allocateNode();return o.aabb.set(t),f.extend(o.aabb,s.aabbExtension),o.userData=i,o.height=0,this.insertLeaf(o),o.id},r.prototype.destroyProxy=function(t){var i=this.m_nodes[t];this.removeLeaf(i),this.freeNode(i)},r.prototype.moveProxy=function(t,i,o){var e=this.m_nodes[t];return!e.aabb.contains(i)&&(this.removeLeaf(e),e.aabb.set(i),i=e.aabb,f.extend(i,s.aabbExtension),o.x<0?i.lowerBound.x+=o.x*s.aabbMultiplier:i.upperBound.x+=o.x*s.aabbMultiplier,o.y<0?i.lowerBound.y+=o.y*s.aabbMultiplier:i.upperBound.y+=o.y*s.aabbMultiplier,this.insertLeaf(e),!0)},r.prototype.insertLeaf=function(t){if(null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var i=t.aabb,o=this.m_root;0==o.isLeaf();){var e=o.child1,s=o.child2,n=o.aabb.getPerimeter(),r=new f;r.combine(o.aabb,i);var m,a,h=r.getPerimeter(),c=2*h,_=2*(h-n);if(e.isLeaf()){(u=new f).combine(i,e.aabb),m=u.getPerimeter()+_}else{(u=new f).combine(i,e.aabb);var l=e.aabb.getPerimeter();m=u.getPerimeter()-l+_}if(s.isLeaf()){(u=new f).combine(i,s.aabb),a=u.getPerimeter()+_}else{var u;(u=new f).combine(i,s.aabb);l=s.aabb.getPerimeter();a=u.getPerimeter()-l+_}if(c<m&&c<a)break;o=m<a?e:s}var p=o,y=p.parent,d=this.allocateNode();for(d.parent=y,d.userData=null,d.aabb.combine(i,p.aabb),d.height=p.height+1,null!=y?(y.child1==p?y.child1=d:y.child2=d,d.child1=p,d.child2=t,p.parent=d,t.parent=d):(d.child1=p,d.child2=t,p.parent=d,t.parent=d,this.m_root=d),o=t.parent;null!=o;){e=(o=this.balance(o)).child1,s=o.child2;o.height=1+v.max(e.height,s.height),o.aabb.combine(e.aabb,s.aabb),o=o.parent}},r.prototype.removeLeaf=function(t){if(t!=this.m_root){var i,o=t.parent,e=o.parent;if(i=o.child1==t?o.child2:o.child1,null!=e){e.child1==o?e.child1=i:e.child2=i,i.parent=e,this.freeNode(o);for(var s=e;null!=s;){var n=(s=this.balance(s)).child1,r=s.child2;s.aabb.combine(n.aabb,r.aabb),s.height=1+v.max(n.height,r.height),s=s.parent}}else(this.m_root=i).parent=null,this.freeNode(o)}else this.m_root=null},r.prototype.balance=function(t){var i=t;if(i.isLeaf()||i.height<2)return t;var o=i.child1,e=i.child2,s=e.height-o.height;if(1<s){var n=e.child1,r=e.child2;return e.child1=i,e.parent=i.parent,null!=(i.parent=e).parent?e.parent.child1==t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,n.height>r.height?(e.child2=n,((i.child2=r).parent=i).aabb.combine(o.aabb,r.aabb),e.aabb.combine(i.aabb,n.aabb),i.height=1+v.max(o.height,r.height),e.height=1+v.max(i.height,n.height)):(e.child2=r,((i.child2=n).parent=i).aabb.combine(o.aabb,n.aabb),e.aabb.combine(i.aabb,r.aabb),i.height=1+v.max(o.height,n.height),e.height=1+v.max(i.height,r.height)),e}if(s<-1){var m=o.child1,a=o.child2;return o.child1=i,o.parent=i.parent,null!=(i.parent=o).parent?o.parent.child1==i?o.parent.child1=o:o.parent.child2=o:this.m_root=o,m.height>a.height?(o.child2=m,((i.child1=a).parent=i).aabb.combine(e.aabb,a.aabb),o.aabb.combine(i.aabb,m.aabb),i.height=1+v.max(e.height,a.height),o.height=1+v.max(i.height,m.height)):(o.child2=a,((i.child1=m).parent=i).aabb.combine(e.aabb,m.aabb),o.aabb.combine(i.aabb,a.aabb),i.height=1+v.max(e.height,m.height),o.height=1+v.max(i.height,a.height)),o}return i},r.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},r.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,i=this.m_root.aabb.getPerimeter(),o=0,e=g.allocate().preorder();t=e.next();)t.height<0||(o+=t.aabb.getPerimeter());return g.release(e),o/i},r.prototype.computeHeight=function(t){var i;if((i=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var o=ComputeHeight(i.child1),e=ComputeHeight(i.child2);return 1+v.max(o,e)},r.prototype.validateStructure=function(t){if(null!=t){this.m_root;var i=t.child1,o=t.child2;t.isLeaf()||(this.validateStructure(i),this.validateStructure(o))}},r.prototype.validateMetrics=function(t){if(null!=t){var i=t.child1,o=t.child2;if(!t.isLeaf()){var e=this.m_nodes[i].height,s=this.m_nodes[o].height,n=(v.max(e,s),new f);n.combine(i.aabb,o.aabb),this.validateMetrics(i),this.validateMetrics(o)}}},r.prototype.validate=function(){ValidateStructure(this.m_root),ValidateMetrics(this.m_root)},r.prototype.getMaxBalance=function(){for(var t,i=0,o=g.allocate().preorder();t=o.next();)if(!(t.height<=1)){var e=v.abs(t.child2.height-t.child1.height);i=v.max(i,e)}return g.release(o),i},r.prototype.rebuildBottomUp=function(){for(var t,i=[],o=0,e=g.allocate().preorder();t=e.next();)t.height<0||(t.isLeaf()?(t.parent=null,i[o]=t,++o):this.freeNode(t));for(g.release(e);1<o;){for(var s=1/0,n=-1,r=-1,m=0;m<o;++m)for(var a=i[m].aabb,h=m+1;h<o;++h){var c=i[h].aabb,_=new f;_.combine(a,c);var l=_.getPerimeter();l<s&&(n=m,r=h,s=l)}var u=i[n],p=i[r],y=this.allocateNode();y.child1=u,y.child2=p,y.height=1+v.max(u.height,p.height),y.aabb.combine(u.aabb,p.aabb),y.parent=null,u.parent=y,p.parent=y,i[r]=i[o-1],i[n]=y,--o}this.m_root=i[0],this.validate()},r.prototype.shiftOrigin=function(t){for(var i,o=g.allocate().preorder();i=o.next();){var e=i.aabb;e.lowerBound.x-=t.x,e.lowerBound.y-=t.y,e.lowerBound.x-=t.x,e.lowerBound.y-=t.y}g.release(o)},r.prototype.query=function(t,i){var o=A.allocate();for(o.push(this.m_root);0<o.length;){var e=o.pop();if(null!=e)if(f.testOverlap(e.aabb,t))if(e.isLeaf()){if(0==i(e.id))return}else o.push(e.child1),o.push(e.child2)}A.release(o)},r.prototype.rayCast=function(t,i){var o=t.p1,e=t.p2,s=d.sub(e,o);s.normalize();var n=d.cross(1,s),r=d.abs(n),m=t.maxFraction,a=new f,h=d.wAdd(1-m,o,m,e);a.combinePoints(o,h);var c=A.allocate(),_=x.allocate();for(c.push(this.m_root);0<c.length;){var l=c.pop();if(null!=l&&0!=f.testOverlap(l.aabb,a)){var u=l.aabb.getCenter(),p=l.aabb.getExtents();if(!(0<v.abs(d.dot(n,d.sub(o,u)))-d.dot(r,p)))if(l.isLeaf()){_.p1=d.clone(t.p1),_.p2=d.clone(t.p2),_.maxFraction=m;var y=i(_,l.id);if(0==y)return;0<y&&(m=y,h=d.wAdd(1-m,o,m,e),a.combinePoints(o,h))}else c.push(l.child1),c.push(l.child2)}}A.release(c),x.release(_)};var x=new e({create:function(){return{}},release:function(t){}}),A=new e({create:function(){return[]},release:function(t){t.length=0}}),g=new e({create:function(){return new m},release:function(t){t.close()}});function m(){var o=[],e=[];return{preorder:function(t){return o.length=0,o.push(t),e.length=0,e.push(0),this},next:function(){for(;0<o.length;){var t=o.length-1,i=o[t];if(0===e[t])return e[t]=1,i;if(1===e[t]&&(e[t]=2,i.child1))return o.push(i.child1),e.push(1),i.child1;if(2===e[t]&&(e[t]=3,i.child2))return o.push(i.child2),e.push(1),i.child2;o.pop(),e.pop()}},close:function(){o.length=0}}}},{"../Settings":7,"../common/Math":18,"../common/Vec2":23,"../util/Pool":48,"../util/common":50,"./AABB":11}],15:[function(t,i,o){i.exports=function(t,i){var o=z.now();++L.toiCalls,t.state=J.e_unknown,t.t=i.tMax;var e=i.proxyA,s=i.proxyB,n=i.sweepA,r=i.sweepB;n.normalize(),r.normalize();var m=i.tMax,a=e.m_radius+s.m_radius,h=F.max(V.linearSlop,a-3*V.linearSlop),c=.25*V.linearSlop;var _=0,l=V.maxTOIIterations,u=0,p=new j,y=new R;for(y.proxyA=i.proxyA,y.proxyB=i.proxyB,y.useRadii=!1;;){var d=q.identity(),v=q.identity();n.getTransform(d,_),r.getTransform(v,_),y.transformA=d,y.transformB=v;var f=new D;if(k(f,p,y),f.distance<=0){t.state=J.e_overlapped,t.t=0;break}if(f.distance<h+c){t.state=J.e_touching,t.t=_;break}var x=new E;x.initialize(p,e,n,s,r,_);for(var A=!1,g=m,b=0;;){var B=x.findMinSeparation(g);x.indexA,x.indexB;if(h+c<B){t.state=J.e_separated,t.t=m,A=!0;break}if(h-c<B){_=g;break}var w=x.evaluate(_);x.indexA,x.indexB;if(w<h-c){t.state=J.e_failed,t.t=_,A=!0;break}if(w<=h+c){t.state=J.e_touching,t.t=_,A=!0;break}for(var S=0,C=_,M=g;;){var I;I=1&S?C+(h-w)*(M-C)/(B-w):.5*(C+M),++S,++L.toiRootIters;var P=x.evaluate(I);x.indexA,x.indexB;if(F.abs(P-h)<c){g=I;break}if(h<P?(C=I,w=P):(M=I,B=P),50==S)break}if(L.toiMaxRootIters=F.max(L.toiMaxRootIters,S),++b==V.maxPolygonVertices)break}if(++u,++L.toiIters,A)break;if(u==l){t.state=J.e_failed,t.t=_;break}}L.toiMaxIters=F.max(L.toiMaxIters,u);var T=z.diff(o);L.toiMaxTime=F.max(L.toiMaxTime,T),L.toiTime+=T},i.exports.Input=function(){this.proxyA=new s,this.proxyB=new s,this.sweepA=new e,this.sweepB=new e,this.tMax},i.exports.Output=J;var V=t("../Settings"),z=(t("../util/common"),t("../util/Timer")),L=t("../common/stats"),F=t("../common/Math"),x=t("../common/Vec2"),A=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),e=t("../common/Sweep"),q=t("../common/Transform"),k=(t("../common/Velocity"),t("../common/Position"),t("./Distance")),R=k.Input,D=k.Output,s=k.Proxy,j=k.Cache;function J(){this.state,this.t}J.e_unknown=0,J.e_failed=1,J.e_overlapped=2,J.e_touching=3,J.e_separated=4,L.toiTime=0,L.toiMaxTime=0,L.toiCalls=0,L.toiIters=0,L.toiMaxIters=0,L.toiRootIters=0,L.toiMaxRootIters=0;function E(){this.m_proxyA=new s,this.m_proxyB=new s,this.m_sweepA,this.m_sweepB,this.m_type,this.m_localPoint=x.zero(),this.m_axis=x.zero()}E.prototype.initialize=function(t,i,o,e,s,n){this.m_proxyA=i,this.m_proxyB=e;var r=t.count;this.m_sweepA=o,this.m_sweepB=s;var m=q.identity(),a=q.identity();if(this.m_sweepA.getTransform(m,n),this.m_sweepB.getTransform(a,n),1==r){this.m_type=1;var h=this.m_proxyA.getVertex(t.indexA[0]),c=this.m_proxyB.getVertex(t.indexB[0]),_=q.mul(m,h),l=q.mul(a,c);return this.m_axis.wSet(1,l,-1,_),f=this.m_axis.normalize()}if(t.indexA[0]==t.indexA[1]){this.m_type=3;var u=e.getVertex(t.indexB[0]),p=e.getVertex(t.indexB[1]);this.m_axis=x.cross(x.sub(p,u),1),this.m_axis.normalize();var y=A.mul(a.q,this.m_axis);this.m_localPoint=x.mid(u,p);l=q.mul(a,this.m_localPoint),h=i.getVertex(t.indexA[0]),_=q.mul(m,h);return(f=x.dot(_,y)-x.dot(l,y))<0&&(this.m_axis=x.neg(this.m_axis),f=-f),f}this.m_type=2;var d=this.m_proxyA.getVertex(t.indexA[0]),v=this.m_proxyA.getVertex(t.indexA[1]);this.m_axis=x.cross(x.sub(v,d),1),this.m_axis.normalize();y=A.mul(m.q,this.m_axis);this.m_localPoint=x.mid(d,v);var f;_=q.mul(m,this.m_localPoint),c=this.m_proxyB.getVertex(t.indexB[0]),l=q.mul(a,c);return(f=x.dot(l,y)-x.dot(_,y))<0&&(this.m_axis=x.neg(this.m_axis),f=-f),f},E.prototype.compute=function(t,i){var o=q.identity(),e=q.identity();switch(this.m_sweepA.getTransform(o,i),this.m_sweepB.getTransform(e,i),this.m_type){case 1:if(t){var s=A.mulT(o.q,this.m_axis),n=A.mulT(e.q,x.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(s),this.indexB=this.m_proxyB.getSupport(n)}var r=this.m_proxyA.getVertex(this.indexA),m=this.m_proxyB.getVertex(this.indexB),a=q.mul(o,r),h=q.mul(e,m);return x.dot(h,this.m_axis)-x.dot(a,this.m_axis);case 2:var c=A.mul(o.q,this.m_axis);a=q.mul(o,this.m_localPoint);if(t){n=A.mulT(e.q,x.neg(c));this.indexA=-1,this.indexB=this.m_proxyB.getSupport(n)}m=this.m_proxyB.getVertex(this.indexB),h=q.mul(e,m);return x.dot(h,c)-x.dot(a,c);case 3:c=A.mul(e.q,this.m_axis),h=q.mul(e,this.m_localPoint);if(t){s=A.mulT(o.q,x.neg(c));this.indexB=-1,this.indexA=this.m_proxyA.getSupport(s)}r=this.m_proxyA.getVertex(this.indexA),a=q.mul(o,r);return x.dot(a,c)-x.dot(h,c);default:return t&&(this.indexA=-1,this.indexB=-1),0}},E.prototype.findMinSeparation=function(t){return this.compute(!0,t)},E.prototype.evaluate=function(t){return this.compute(!1,t)}},{"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../common/stats":26,"../util/Timer":49,"../util/common":50,"./Distance":13}],16:[function(t,i,o){i.exports=r;t("../util/common"),t("./Math");var m=t("./Vec2");function r(t,i,o,e){"object"==typeof t&&null!==t?(this.ex=m.clone(t),this.ey=m.clone(i)):"number"==typeof t?(this.ex=m.neo(t,o),this.ey=m.neo(i,e)):(this.ex=m.zero(),this.ey=m.zero())}r.prototype.toString=function(){return JSON.stringify(this)},r.isValid=function(t){return t&&m.isValid(t.ex)&&m.isValid(t.ey)},r.assert=function(t){},r.prototype.set=function(t,i,o,e){"number"==typeof t&&"number"==typeof i&&"number"==typeof o&&"number"==typeof e?(this.ex.set(t,o),this.ey.set(i,e)):"object"==typeof t&&"object"==typeof i?(this.ex.set(t),this.ey.set(i)):"object"==typeof t&&(this.ex.set(t.ex),this.ey.set(t.ey))},r.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},r.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},r.prototype.getInverse=function(){var t=this.ex.x,i=this.ey.x,o=this.ex.y,e=this.ey.y,s=t*e-i*o;0!=s&&(s=1/s);var n=new r;return n.ex.x=s*e,n.ey.x=-s*i,n.ex.y=-s*o,n.ey.y=s*t,n},r.prototype.solve=function(t){var i=this.ex.x,o=this.ey.x,e=this.ex.y,s=this.ey.y,n=i*s-o*e;0!=n&&(n=1/n);var r=m.zero();return r.x=n*(s*t.x-o*t.y),r.y=n*(i*t.y-e*t.x),r},r.mul=function(t,i){if(i&&"x"in i&&"y"in i){var o=t.ex.x*i.x+t.ey.x*i.y,e=t.ex.y*i.x+t.ey.y*i.y;return m.neo(o,e)}if(i&&"ex"in i&&"ey"in i)return new r(m.mul(t,i.ex),m.mul(t,i.ey))},r.mulT=function(t,i){return i&&"x"in i&&"y"in i?m.neo(m.dot(i,t.ex),m.dot(i,t.ey)):i&&"ex"in i&&"ey"in i?new r(m.neo(m.dot(t.ex,i.ex),m.dot(t.ey,i.ex)),m.neo(m.dot(t.ex,i.ey),m.dot(t.ey,i.ey))):void 0},r.abs=function(t){return new r(m.abs(t.ex),m.abs(t.ey))},r.add=function(t,i){return new r(m.add(t.ex+i.ex),m.add(t.ey+i.ey))}},{"../util/common":50,"./Math":18,"./Vec2":23}],17:[function(t,i,o){i.exports=e;t("../util/common"),t("./Math");var m=t("./Vec2"),a=t("./Vec3");function e(t,i,o){"object"==typeof t&&null!==t?(this.ex=a.clone(t),this.ey=a.clone(i),this.ez=a.clone(o)):(this.ex=a(),this.ey=a(),this.ez=a())}e.prototype.toString=function(){return JSON.stringify(this)},e.isValid=function(t){return t&&a.isValid(t.ex)&&a.isValid(t.ey)&&a.isValid(t.ez)},e.assert=function(t){},e.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},e.prototype.solve33=function(t){var i=a.dot(this.ex,a.cross(this.ey,this.ez));0!=i&&(i=1/i);var o=new a;return o.x=i*a.dot(t,a.cross(this.ey,this.ez)),o.y=i*a.dot(this.ex,a.cross(t,this.ez)),o.z=i*a.dot(this.ex,a.cross(this.ey,t)),o},e.prototype.solve22=function(t){var i=this.ex.x,o=this.ey.x,e=this.ex.y,s=this.ey.y,n=i*s-o*e;0!=n&&(n=1/n);var r=m.zero();return r.x=n*(s*t.x-o*t.y),r.y=n*(i*t.y-e*t.x),r},e.prototype.getInverse22=function(t){var i=this.ex.x,o=this.ey.x,e=this.ex.y,s=this.ey.y,n=i*s-o*e;0!=n&&(n=1/n),t.ex.x=n*s,t.ey.x=-n*o,t.ex.z=0,t.ex.y=-n*e,t.ey.y=n*i,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},e.prototype.getSymInverse33=function(t){var i=a.dot(this.ex,a.cross(this.ey,this.ez));0!=i&&(i=1/i);var o=this.ex.x,e=this.ey.x,s=this.ez.x,n=this.ey.y,r=this.ez.y,m=this.ez.z;t.ex.x=i*(n*m-r*r),t.ex.y=i*(s*r-e*m),t.ex.z=i*(e*r-s*n),t.ey.x=t.ex.y,t.ey.y=i*(o*m-s*s),t.ey.z=i*(s*e-o*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=i*(o*n-e*e)},e.mul=function(t,i){if(i&&"z"in i&&"y"in i&&"x"in i){var o=t.ex.x*i.x+t.ey.x*i.y+t.ez.x*i.z,e=t.ex.y*i.x+t.ey.y*i.y+t.ez.y*i.z,s=t.ex.z*i.x+t.ey.z*i.y+t.ez.z*i.z;return new a(o,e,s)}if(i&&"y"in i&&"x"in i){o=t.ex.x*i.x+t.ey.x*i.y,e=t.ex.y*i.x+t.ey.y*i.y;return m.neo(o,e)}},e.add=function(t,i){return new a(t.x+i.x,t.y+i.y,t.z+i.z)}},{"../util/common":50,"./Math":18,"./Vec2":23,"./Vec3":24}],18:[function(t,i,o){t("../util/common");var e=t("../util/create"),s=Math,n=i.exports=e(s);n.EPSILON=1e-9,n.isFinite=function(t){return"number"==typeof t&&isFinite(t)&&!isNaN(t)},n.assert=function(t){},n.invSqrt=function(t){return 1/s.sqrt(t)},n.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},n.isPowerOfTwo=function(t){return 0<t&&0==(t&t-1)},n.mod=function(t,i,o){return void 0===i?(o=1,i=0):void 0===o&&(o=i,i=0),i<o?(t=(t-i)%(o-i))+(t<0?o:i):(t=(t-o)%(i-o))+(t<=0?i:o)},n.clamp=function(t,i,o){return t<i?i:o<t?o:t},n.random=function(t,i){return void 0===t?(i=1,t=0):void 0===i&&(i=t,t=0),t==i?t:s.random()*(i-t)+t}},{"../util/common":50,"../util/create":51}],19:[function(t,i,o){i.exports=n;var e=t("./Vec2"),s=t("./Rot");function n(){this.c=e.zero(),this.a=0}n.prototype.getTransform=function(t,i){return t.q.set(this.a),t.p.set(e.sub(this.c,s.mul(t.q,i))),t}},{"./Rot":20,"./Vec2":23}],20:[function(t,i,o){i.exports=s;t("../util/common");var n=t("./Vec2"),e=t("./Math");function s(t){if(!(this instanceof s))return new s(t);"number"==typeof t?this.setAngle(t):"object"==typeof t?this.set(t):this.setIdentity()}s.neo=function(t){var i=Object.create(s.prototype);return i.setAngle(t),i},s.clone=function(t){var i=Object.create(s.prototype);return i.s=t.s,i.c=t.c,i},s.identity=function(t){var i=Object.create(s.prototype);return i.s=0,i.c=1,i},s.isValid=function(t){return t&&e.isFinite(t.s)&&e.isFinite(t.c)},s.assert=function(t){},s.prototype.setIdentity=function(){this.s=0,this.c=1},s.prototype.set=function(t){"object"==typeof t?(this.s=t.s,this.c=t.c):(this.s=e.sin(t),this.c=e.cos(t))},s.prototype.setAngle=function(t){this.s=e.sin(t),this.c=e.cos(t)},s.prototype.getAngle=function(){return e.atan2(this.s,this.c)},s.prototype.getXAxis=function(){return n.neo(this.c,this.s)},s.prototype.getYAxis=function(){return n.neo(-this.s,this.c)},s.mul=function(t,i){if("c"in i&&"s"in i){var o=s.identity();return o.s=t.s*i.c+t.c*i.s,o.c=t.c*i.c-t.s*i.s,o}if("x"in i&&"y"in i)return n.neo(t.c*i.x-t.s*i.y,t.s*i.x+t.c*i.y)},s.mulSub=function(t,i,o){var e=t.c*(i.x-o.x)-t.s*(i.y-o.y),s=t.s*(i.x-o.y)+t.c*(i.y-o.y);return n.neo(e,s)},s.mulT=function(t,i){if("c"in i&&"s"in i){var o=s.identity();return o.s=t.c*i.s-t.s*i.c,o.c=t.c*i.c+t.s*i.s,o}if("x"in i&&"y"in i)return n.neo(t.c*i.x+t.s*i.y,-t.s*i.x+t.c*i.y)}},{"../util/common":50,"./Math":18,"./Vec2":23}],21:[function(t,i,o){i.exports=m;t("../util/common");var e=t("./Math"),s=t("./Vec2"),n=t("./Rot"),r=t("./Transform");function m(t,i){this.localCenter=s.zero(),this.c=s.zero(),this.a=0,this.alpha0=0,this.c0=s.zero(),this.a0=0}m.prototype.setTransform=function(t){var i=r.mul(t,this.localCenter);this.c.set(i),this.c0.set(i),this.a=t.q.getAngle(),this.a0=t.q.getAngle()},m.prototype.setLocalCenter=function(t,i){this.localCenter.set(t);var o=r.mul(i,this.localCenter);this.c.set(o),this.c0.set(o)},m.prototype.getTransform=function(t,i){i=void 0===i?0:i,t.q.setAngle((1-i)*this.a0+i*this.a),t.p.wSet(1-i,this.c0,i,this.c),t.p.sub(n.mul(t.q,this.localCenter))},m.prototype.advance=function(t){var i=(t-this.alpha0)/(1-this.alpha0);this.c0.wSet(i,this.c,1-i,this.c0),this.a0=i*this.a+(1-i)*this.a0,this.alpha0=t},m.prototype.forward=function(){this.a0=this.a,this.c0.set(this.c)},m.prototype.normalize=function(){var t=e.mod(this.a0,-e.PI,+e.PI);this.a-=this.a0-t,this.a0=t},m.prototype.clone=function(){var t=new m;return t.localCenter.set(this.localCenter),t.alpha0=this.alpha0,t.a0=this.a0,t.a=this.a,t.c0.set(this.c0),t.c.set(this.c),t},m.prototype.set=function(t){this.localCenter.set(t.localCenter),this.alpha0=t.alpha0,this.a0=t.a0,this.a=t.a,this.c0.set(t.c0),this.c.set(t.c)}},{"../util/common":50,"./Math":18,"./Rot":20,"./Transform":22,"./Vec2":23}],22:[function(t,i,o){i.exports=h;t("../util/common");var m=t("./Vec2"),a=t("./Rot");function h(t,i){if(!(this instanceof h))return new h(t,i);this.p=m.zero(),this.q=a.identity(),void 0!==t&&this.p.set(t),void 0!==i&&this.q.set(i)}h.clone=function(t){var i=Object.create(h.prototype);return i.p=m.clone(t.p),i.q=a.clone(t.q),i},h.neo=function(t,i){var o=Object.create(h.prototype);return o.p=m.clone(t),o.q=a.clone(i),o},h.identity=function(){var t=Object.create(h.prototype);return t.p=m.zero(),t.q=a.identity(),t},h.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},h.prototype.set=function(t,i){h.isValid(t)?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(i))},h.isValid=function(t){return t&&m.isValid(t.p)&&a.isValid(t.q)},h.assert=function(t){},h.mul=function(t,i){if(Array.isArray(i)){for(var o=[],e=0;e<i.length;e++)o[e]=h.mul(t,i[e]);return o}if("x"in i&&"y"in i){var s=t.q.c*i.x-t.q.s*i.y+t.p.x,n=t.q.s*i.x+t.q.c*i.y+t.p.y;return m.neo(s,n)}if("p"in i&&"q"in i){var r=h.identity();return r.q=a.mul(t.q,i.q),r.p=m.add(a.mul(t.q,i.p),t.p),r}},h.mulT=function(t,i){if("x"in i&&"y"in i){var o=i.x-t.p.x,e=i.y-t.p.y,s=t.q.c*o+t.q.s*e,n=-t.q.s*o+t.q.c*e;return m.neo(s,n)}if("p"in i&&"q"in i){var r=h.identity();return r.q.set(a.mulT(t.q,i.q)),r.p.set(a.mulT(t.q,m.sub(i.p,t.p))),r}}},{"../util/common":50,"./Rot":20,"./Vec2":23}],23:[function(t,i,o){var r=!1;i.exports=a;var e=t("../util/common"),m=t("./Math");function a(t,i){if(!(this instanceof a))return new a(t,i);void 0===t?(this.x=0,this.y=0):"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i),r&&a.assert(this)}a.zero=function(){var t=Object.create(a.prototype);return t.x=0,t.y=0,t},a.neo=function(t,i){var o=Object.create(a.prototype);return o.x=t,o.y=i,o},a.clone=function(t,i){return r&&a.assert(t),r&&e.assert(!i),a.neo(t.x,t.y)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&m.isFinite(t.x)&&m.isFinite(t.y)},a.assert=function(t){if(r&&!a.isValid(t))throw new Error("Invalid Vec2!")},a.prototype.clone=function(t){return a.clone(this,t)},a.prototype.setZero=function(){return this.x=0,this.y=0,this},a.prototype.set=function(t,i){return"object"==typeof t?(r&&a.assert(t),this.x=t.x,this.y=t.y):(r&&m.assert(t),r&&m.assert(i),this.x=t,this.y=i),this},a.prototype.wSet=function(t,i,o,e){r&&m.assert(t),r&&a.assert(i);var s=t*i.x,n=t*i.y;return void 0===o&&void 0===e||(r&&m.assert(o),r&&a.assert(e),s+=o*e.x,n+=o*e.y),this.x=s,this.y=n,this},a.prototype.add=function(t){return r&&a.assert(t),this.x+=t.x,this.y+=t.y,this},a.prototype.wAdd=function(t,i,o,e){r&&m.assert(t),r&&a.assert(i);var s=t*i.x,n=t*i.y;return void 0===o&&void 0===e||(r&&m.assert(o),r&&a.assert(e),s+=o*e.x,n+=o*e.y),this.x+=s,this.y+=n,this},a.prototype.wSub=function(t,i,o,e){r&&m.assert(t),r&&a.assert(i);var s=t*i.x,n=t*i.y;return void 0===o&&void 0===e||(r&&m.assert(o),r&&a.assert(e),s+=o*e.x,n+=o*e.y),this.x-=s,this.y-=n,this},a.prototype.sub=function(t){return r&&a.assert(t),this.x-=t.x,this.y-=t.y,this},a.prototype.mul=function(t){return r&&m.assert(t),this.x*=t,this.y*=t,this},a.prototype.length=function(){return a.lengthOf(this)},a.prototype.lengthSquared=function(){return a.lengthSquared(this)},a.prototype.normalize=function(){var t=this.length();if(t<m.EPSILON)return 0;var i=1/t;return this.x*=i,this.y*=i,t},a.lengthOf=function(t){return r&&a.assert(t),m.sqrt(t.x*t.x+t.y*t.y)},a.lengthSquared=function(t){return r&&a.assert(t),t.x*t.x+t.y*t.y},a.distance=function(t,i){r&&a.assert(t),r&&a.assert(i);var o=t.x-i.x,e=t.y-i.y;return m.sqrt(o*o+e*e)},a.distanceSquared=function(t,i){r&&a.assert(t),r&&a.assert(i);var o=t.x-i.x,e=t.y-i.y;return o*o+e*e},a.areEqual=function(t,i){return r&&a.assert(t),r&&a.assert(i),t==i||"object"==typeof i&&null!==i&&t.x==i.x&&t.y==i.y},a.skew=function(t){return r&&a.assert(t),a.neo(-t.y,t.x)},a.dot=function(t,i){return r&&a.assert(t),r&&a.assert(i),t.x*i.x+t.y*i.y},a.cross=function(t,i){return"number"==typeof i?(r&&a.assert(t),r&&m.assert(i),a.neo(i*t.y,-i*t.x)):"number"==typeof t?(r&&m.assert(t),r&&a.assert(i),a.neo(-t*i.y,t*i.x)):(r&&a.assert(t),r&&a.assert(i),t.x*i.y-t.y*i.x)},a.addCross=function(t,i,o){return"number"==typeof o?(r&&a.assert(i),r&&m.assert(o),a.neo(o*i.y+t.x,-o*i.x+t.y)):"number"==typeof i?(r&&m.assert(i),r&&a.assert(o),a.neo(-i*o.y+t.x,i*o.x+t.y)):void(r&&e.assert(!1))},a.add=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(t.x+i.x,t.y+i.y)},a.wAdd=function(t,i,o,e){var s=a.zero();return s.wAdd(t,i,o,e),s},a.sub=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(t.x-i.x,t.y-i.y)},a.mul=function(t,i){return"object"==typeof t?(r&&a.assert(t),r&&m.assert(i),a.neo(t.x*i,t.y*i)):"object"==typeof i?(r&&m.assert(t),r&&a.assert(i),a.neo(t*i.x,t*i.y)):void 0},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},a.neg=function(t){return r&&a.assert(t),a.neo(-t.x,-t.y)},a.abs=function(t){return r&&a.assert(t),a.neo(m.abs(t.x),m.abs(t.y))},a.mid=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(.5*(t.x+i.x),.5*(t.y+i.y))},a.upper=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(m.max(t.x,i.x),m.max(t.y,i.y))},a.lower=function(t,i){return r&&a.assert(t),r&&a.assert(i),a.neo(m.min(t.x,i.x),m.min(t.y,i.y))},a.prototype.clamp=function(t){var i=this.x*this.x+this.y*this.y;if(t*t<i){var o=m.invSqrt(i);this.x*=o*t,this.y*=o*t}return this},a.clamp=function(t,i){return(t=a.neo(t.x,t.y)).clamp(i),t}},{"../util/common":50,"./Math":18}],24:[function(t,i,o){var e=!1;i.exports=n;t("../util/common");var s=t("./Math");function n(t,i,o){if(!(this instanceof n))return new n(t,i,o);void 0===t?(this.x=0,this.y=0,this.z=0):"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=i,this.z=o),e&&n.assert(this)}n.prototype.toString=function(){return JSON.stringify(this)},n.isValid=function(t){return t&&s.isFinite(t.x)&&s.isFinite(t.y)&&s.isFinite(t.z)},n.assert=function(t){if(e&&!n.isValid(t))throw new Error("Invalid Vec3!")},n.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},n.prototype.set=function(t,i,o){return this.x=t,this.y=i,this.z=o,this},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.areEqual=function(t,i){return t==i||"object"==typeof i&&null!==i&&t.x==i.x&&t.y==i.y&&t.z==i.z},n.dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},n.cross=function(t,i){return new n(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)},n.add=function(t,i){return new n(t.x+i.x,t.y+i.y,t.z+i.z)},n.sub=function(t,i){return new n(t.x-i.x,t.y-i.y,t.z-i.z)},n.mul=function(t,i){return new n(i*t.x,i*t.y,i*t.z)},n.prototype.neg=function(t){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.neg=function(t){return new n(-t.x,-t.y,-t.z)}},{"../util/common":50,"./Math":18}],25:[function(t,i,o){i.exports=function(){this.v=e.zero(),this.w=0};var e=t("./Vec2")},{"./Vec2":23}],26:[function(t,i,o){o.toString=function(t){t="string"==typeof t?t:"\n";var i="";for(var o in this)"function"!=typeof this[o]&&"object"!=typeof this[o]&&(i+=o+": "+this[o]+t);return i}},{}],27:[function(t,i,o){i.exports=a;var n=t("../util/options"),e=t("../util/create"),g=t("../Settings"),b=t("../common/Math"),B=t("../common/Vec2"),w=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),r=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));a.TYPE="distance-joint",a.prototype=e((a._super=r).prototype);var m={frequencyHz:0,dampingRatio:0};function a(t,i,o,e,s){if(!(this instanceof a))return new a(t,i,o,e,s);t=n(t,m),r.call(this,t,i,e),this.m_type=a.TYPE,this.m_localAnchorA=t.localAnchorA||i.getLocalPoint(o),this.m_localAnchorB=t.localAnchorB||e.getLocalPoint(s),this.m_length=B.distance(s,o),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}a.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},a.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},a.prototype.setLength=function(t){this.m_length=t},a.prototype.getLength=function(){return this.m_length},a.prototype.setFrequency=function(t){this.m_frequencyHz=t},a.prototype.getFrequency=function(){return this.m_frequencyHz},a.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},a.prototype.getDampingRatio=function(){return this.m_dampingRatio},a.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},a.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},a.prototype.getReactionForce=function(t){return B.mul(this.m_impulse,this.m_u).mul(t)},a.prototype.getReactionTorque=function(t){return 0},a.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=w.neo(o),c=w.neo(r);this.m_rA=w.mul(h,B.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=w.mul(c,B.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=B.sub(B.add(n,this.m_rB),B.add(i,this.m_rA));var _=this.m_u.length();_>g.linearSlop?this.m_u.mul(1/_):this.m_u.set(0,0);var l=B.cross(this.m_rA,this.m_u),u=B.cross(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,0<this.m_frequencyHz){var y=_-this.m_length,d=2*b.PI*this.m_frequencyHz,v=2*this.m_mass*this.m_dampingRatio*d,f=this.m_mass*d*d,x=t.dt;this.m_gamma=x*(v+x*f),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*x*f*this.m_gamma,p+=this.m_gamma,this.m_mass=0!=p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var A=B.mul(this.m_impulse,this.m_u);e.wSub(this.m_invMassA,A),s-=this.m_invIA*B.cross(this.m_rA,A),m.wAdd(this.m_invMassB,A),a+=this.m_invIB*B.cross(this.m_rB,A)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=a},a.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=B.add(i,B.cross(o,this.m_rA)),r=B.add(e,B.cross(s,this.m_rB)),m=B.dot(this.m_u,r)-B.dot(this.m_u,n),a=-this.m_mass*(m+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;var h=B.mul(a,this.m_u);i.wSub(this.m_invMassA,h),o-=this.m_invIA*B.cross(this.m_rA,h),e.wAdd(this.m_invMassB,h),s+=this.m_invIB*B.cross(this.m_rB,h),this.m_bodyA.c_velocity.v.set(i),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(e),this.m_bodyB.c_velocity.w=s},a.prototype.solvePositionConstraints=function(t){if(0<this.m_frequencyHz)return!0;var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=w.neo(o),r=w.neo(s),m=w.mulSub(n,this.m_localAnchorA,this.m_localCenterA),a=w.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=B.sub(B.add(e,a),B.add(i,m)),c=h.normalize()-this.m_length;c=b.clamp(c,-g.maxLinearCorrection,g.maxLinearCorrection);var _=-this.m_mass*c,l=B.mul(_,h);return i.wSub(this.m_invMassA,l),o-=this.m_invIA*B.cross(m,l),e.wAdd(this.m_invMassB,l),s+=this.m_invIB*B.cross(a,l),this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.set(e),this.m_bodyB.c_position.a=s,b.abs(c)<g.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/create":51,"../util/options":52}],28:[function(t,i,o){i.exports=m;t("../util/common");var s=t("../util/options"),e=t("../util/create"),p=(t("../Settings"),t("../common/Math")),y=t("../common/Vec2"),d=(t("../common/Vec3"),t("../common/Mat22")),v=(t("../common/Mat33"),t("../common/Rot")),n=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));m.TYPE="friction-joint",m.prototype=e((m._super=n).prototype);var r={maxForce:0,maxTorque:0};function m(t,i,o,e){if(!(this instanceof m))return new m(t,i,o,e);t=s(t,r),n.call(this,t,i,o),this.m_type=m.TYPE,e?(this.m_localAnchorA=i.getLocalPoint(e),this.m_localAnchorB=o.getLocalPoint(e)):(this.m_localAnchorA=y.zero(),this.m_localAnchorB=y.zero()),this.m_linearImpulse=y.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}m.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},m.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},m.prototype.setMaxForce=function(t){this.m_maxForce=t},m.prototype.getMaxForce=function(){return this.m_maxForce},m.prototype.setMaxTorque=function(t){this.m_maxTorque=t},m.prototype.getMaxTorque=function(){return this.m_maxTorque},m.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},m.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},m.prototype.getReactionForce=function(t){return y.mul(t,this.m_linearImpulse)},m.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},m.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=v.neo(i),a=v.neo(s);this.m_rA=v.mul(m,y.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=v.mul(a,y.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=new d;if(u.ex.x=h+c+_*this.m_rA.y*this.m_rA.y+l*this.m_rB.y*this.m_rB.y,u.ex.y=-_*this.m_rA.x*this.m_rA.y-l*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=h+c+_*this.m_rA.x*this.m_rA.x+l*this.m_rB.x*this.m_rB.x,this.m_linearMass=u.getInverse(),this.m_angularMass=_+l,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var p=y.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);o.wSub(h,p),e-=_*(y.cross(this.m_rA,p)+this.m_angularImpulse),n.wAdd(c,p),r+=l*(y.cross(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},m.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=t.dt,c=s-o,_=-this.m_angularMass*c,l=this.m_angularImpulse,u=h*this.m_maxTorque;this.m_angularImpulse=p.clamp(this.m_angularImpulse+_,-u,u),o-=m*(_=this.m_angularImpulse-l),s+=a*_;c=y.sub(y.add(e,y.cross(s,this.m_rB)),y.add(i,y.cross(o,this.m_rA))),_=y.neg(d.mul(this.m_linearMass,c)),l=this.m_linearImpulse;this.m_linearImpulse.add(_);u=h*this.m_maxForce;this.m_linearImpulse.lengthSquared()>u*u&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(u)),_=y.sub(this.m_linearImpulse,l),i.wSub(n,_),o-=m*y.cross(this.m_rA,_),e.wAdd(r,_),s+=a*y.cross(this.m_rB,_),this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=e,this.m_bodyB.c_velocity.w=s},m.prototype.solvePositionConstraints=function(t){return!0}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],29:[function(t,i,o){var b=!1;i.exports=I;var B=t("../util/common"),w=t("../util/options"),e=t("../util/create"),L=t("../Settings"),s=t("../common/Math"),F=t("../common/Vec2"),q=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),S=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint")),k=t("./RevoluteJoint"),C=t("./PrismaticJoint");I.TYPE="gear-joint",I.prototype=e((I._super=S).prototype);var M={ratio:1};function I(t,i,o,e,s,n){if(!(this instanceof I))return new I(t,i,o,e,s,n);var r,m;t=w(t,M),S.call(this,t,i,o),this.m_type=I.TYPE,b&&B.assert(e.m_type==k.TYPE||e.m_type==C.TYPE),b&&B.assert(s.m_type==k.TYPE||s.m_type==C.TYPE),this.m_joint1=e,this.m_joint2=s,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType(),this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();var a=this.m_bodyA.m_xf,h=this.m_bodyA.m_sweep.a,c=this.m_bodyC.m_xf,_=this.m_bodyC.m_sweep.a;if(this.m_type1==k.TYPE){var l=e;this.m_localAnchorC=l.m_localAnchorA,this.m_localAnchorA=l.m_localAnchorB,this.m_referenceAngleA=l.m_referenceAngle,this.m_localAxisC=F.zero(),r=h-_-this.m_referenceAngleA}else{var u=e;this.m_localAnchorC=u.m_localAnchorA,this.m_localAnchorA=u.m_localAnchorB,this.m_referenceAngleA=u.m_referenceAngle,this.m_localAxisC=u.m_localXAxisA;var p=this.m_localAnchorC,y=q.mulT(c.q,F.add(q.mul(a.q,this.m_localAnchorA),F.sub(a.p,c.p)));r=F.dot(y,this.m_localAxisC)-F.dot(p,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();var d=this.m_bodyB.m_xf,v=this.m_bodyB.m_sweep.a,f=this.m_bodyD.m_xf,x=this.m_bodyD.m_sweep.a;if(this.m_type2==k.TYPE){l=s;this.m_localAnchorD=l.m_localAnchorA,this.m_localAnchorB=l.m_localAnchorB,this.m_referenceAngleB=l.m_referenceAngle,this.m_localAxisD=F.zero(),m=v-x-this.m_referenceAngleB}else{u=s;this.m_localAnchorD=u.m_localAnchorA,this.m_localAnchorB=u.m_localAnchorB,this.m_referenceAngleB=u.m_referenceAngle,this.m_localAxisD=u.m_localXAxisA;var A=this.m_localAnchorD,g=q.mulT(f.q,F.add(q.mul(d.q,this.m_localAnchorB),F.sub(d.p,f.p)));m=F.dot(g,this.m_localAxisD)-F.dot(A,this.m_localAxisD)}this.m_ratio=n||t.ratio,this.m_constant=r+this.m_ratio*m,this.m_impulse=0,this.m_lcA,this.m_lcB,this.m_lcC,this.m_lcD,this.m_mA,this.m_mB,this.m_mC,this.m_mD,this.m_iA,this.m_iB,this.m_iC,this.m_iD,this.m_JvAC,this.m_JvBD,this.m_JwA,this.m_JwB,this.m_JwC,this.m_JwD,this.m_mass}I.prototype.getJoint1=function(){return this.m_joint1},I.prototype.getJoint2=function(){return this.m_joint2},I.prototype.setRatio=function(t){b&&B.assert(s.isFinite(t)),this.m_ratio=t},I.prototype.getRatio=function(){return this.m_ratio},I.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},I.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},I.prototype.getReactionForce=function(t){return F.mul(this.m_impulse,this.m_JvAC).mul(t)},I.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},I.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=this.m_bodyC.c_position.a,a=this.m_bodyC.c_velocity.v,h=this.m_bodyC.c_velocity.w,c=this.m_bodyD.c_position.a,_=this.m_bodyD.c_velocity.v,l=this.m_bodyD.c_velocity.w,u=q.neo(i),p=q.neo(s),y=q.neo(m),d=q.neo(c);if(this.m_mass=0,this.m_type1==k.TYPE)this.m_JvAC=F.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var v=q.mul(y,this.m_localAxisC),f=q.mulSub(y,this.m_localAnchorC,this.m_lcC),x=q.mulSub(u,this.m_localAnchorA,this.m_lcA);this.m_JvAC=v,this.m_JwC=F.cross(f,v),this.m_JwA=F.cross(x,v),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==k.TYPE)this.m_JvBD=F.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{v=q.mul(d,this.m_localAxisD);var A=q.mulSub(d,this.m_localAnchorD,this.m_lcD),g=q.mulSub(p,this.m_localAnchorB,this.m_lcB);this.m_JvBD=F.mul(this.m_ratio,v),this.m_JwD=this.m_ratio*F.cross(A,v),this.m_JwB=this.m_ratio*F.cross(g,v),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=0<this.m_mass?1/this.m_mass:0,t.warmStarting?(o.wAdd(this.m_mA*this.m_impulse,this.m_JvAC),e+=this.m_iA*this.m_impulse*this.m_JwA,n.wAdd(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,a.wSub(this.m_mC*this.m_impulse,this.m_JvAC),h-=this.m_iC*this.m_impulse*this.m_JwC,_.wSub(this.m_mD*this.m_impulse,this.m_JvBD),l-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.set(o),this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.set(a),this.m_bodyC.c_velocity.w=h,this.m_bodyD.c_velocity.v.set(_),this.m_bodyD.c_velocity.w=l},I.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,m=this.m_bodyD.c_velocity.v,a=this.m_bodyD.c_velocity.w,h=F.dot(this.m_JvAC,i)-F.dot(this.m_JvAC,n)+F.dot(this.m_JvBD,e)-F.dot(this.m_JvBD,m);h+=this.m_JwA*o-this.m_JwC*r+(this.m_JwB*s-this.m_JwD*a);var c=-this.m_mass*h;this.m_impulse+=c,i.wAdd(this.m_mA*c,this.m_JvAC),o+=this.m_iA*c*this.m_JwA,e.wAdd(this.m_mB*c,this.m_JvBD),s+=this.m_iB*c*this.m_JwB,n.wSub(this.m_mC*c,this.m_JvAC),r-=this.m_iC*c*this.m_JwC,m.wSub(this.m_mD*c,this.m_JvBD),a-=this.m_iD*c*this.m_JwD,this.m_bodyA.c_velocity.v.set(i),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(e),this.m_bodyB.c_velocity.w=s,this.m_bodyC.c_velocity.v.set(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.set(m),this.m_bodyD.c_velocity.w=a},I.prototype.solvePositionConstraints=function(t){var i,o,e,s,n,r,m,a,h=this.m_bodyA.c_position.c,c=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,u=this.m_bodyC.c_position.c,p=this.m_bodyC.c_position.a,y=this.m_bodyD.c_position.c,d=this.m_bodyD.c_position.a,v=q.neo(c),f=q.neo(l),x=q.neo(p),A=q.neo(d),g=0;if(this.m_type1==k.TYPE)e=F.zero(),m=n=1,g+=this.m_iA+this.m_iC,i=c-p-this.m_referenceAngleA;else{var b=q.mul(x,this.m_localAxisC),B=q.mulSub(x,this.m_localAnchorC,this.m_lcC),w=q.mulSub(v,this.m_localAnchorA,this.m_lcA);e=b,m=F.cross(B,b),n=F.cross(w,b),g+=this.m_mC+this.m_mA+this.m_iC*m*m+this.m_iA*n*n;var S=F.sub(this.m_localAnchorC,this.m_lcC),C=q.mulT(x,F.add(w,F.sub(h,u)));i=F.dot(F.sub(C,S),this.m_localAxisC)}if(this.m_type2==k.TYPE)s=F.zero(),r=this.m_ratio,a=this.m_ratio,g+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),o=l-d-this.m_referenceAngleB;else{b=q.mul(A,this.m_localAxisD);var M=q.mulSub(A,this.m_localAnchorD,this.m_lcD),I=q.mulSub(f,this.m_localAnchorB,this.m_lcB);s=F.mul(this.m_ratio,b),a=this.m_ratio*F.cross(M,b),r=this.m_ratio*F.cross(I,b),g+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*a*a+this.m_iB*r*r;var P=F.sub(this.m_localAnchorD,this.m_lcD),T=q.mulT(A,F.add(I,F.sub(_,y)));o=F.dot(T,this.m_localAxisD)-F.dot(P,this.m_localAxisD)}var V=i+this.m_ratio*o-this.m_constant,z=0;return 0<g&&(z=-V/g),h.wAdd(this.m_mA*z,e),c+=this.m_iA*z*n,_.wAdd(this.m_mB*z,s),l+=this.m_iB*z*r,u.wSub(this.m_mC*z,e),p-=this.m_iC*z*m,y.wSub(this.m_mD*z,s),d-=this.m_iD*z*a,this.m_bodyA.c_position.c.set(h),this.m_bodyA.c_position.a=c,this.m_bodyB.c_position.c.set(_),this.m_bodyB.c_position.a=l,this.m_bodyC.c_position.c.set(u),this.m_bodyC.c_position.a=p,this.m_bodyD.c_position.c.set(y),this.m_bodyD.c_position.a=d,0<L.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52,"./PrismaticJoint":32,"./RevoluteJoint":34}],30:[function(t,i,o){i.exports=h;t("../util/common");var r=t("../util/options"),e=t("../util/create"),y=(t("../Settings"),t("../common/Math")),v=t("../common/Vec2"),f=(t("../common/Vec3"),t("../common/Mat22")),x=(t("../common/Mat33"),t("../common/Rot")),m=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));h.TYPE="motor-joint",h.prototype=e((h._super=m).prototype);var a={maxForce:1,maxTorque:1,correctionFactor:.3};function h(t,i,o){if(!(this instanceof h))return new h(t,i,o);t=r(t,a),m.call(this,t,i,o),this.m_type=h.TYPE;var e=o.getPosition();this.m_linearOffset=i.getLocalPoint(e);var s=i.getAngle(),n=o.getAngle();this.m_angularOffset=n-s,this.m_linearImpulse=v.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_linearError,this.m_angularError,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}h.prototype.setMaxForce=function(t){this.m_maxForce=t},h.prototype.getMaxForce=function(){return this.m_maxForce},h.prototype.setMaxTorque=function(t){this.m_maxTorque=t},h.prototype.getMaxTorque=function(){return this.m_maxTorque},h.prototype.setCorrectionFactor=function(t){this.m_correctionFactor=t},h.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},h.prototype.setLinearOffset=function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=t)},h.prototype.getLinearOffset=function(){return this.m_linearOffset},h.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},h.prototype.getAngularOffset=function(){return this.m_angularOffset},h.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},h.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},h.prototype.getReactionForce=function(t){return v.mul(t,this.m_linearImpulse)},h.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},h.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=x.neo(o),c=x.neo(r);this.m_rA=x.mul(h,v.neg(this.m_localCenterA)),this.m_rB=x.mul(c,v.neg(this.m_localCenterB));var _=this.m_invMassA,l=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,y=new f;if(y.ex.x=_+l+u*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,y.ex.y=-u*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=_+l+u*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=y.getInverse(),this.m_angularMass=u+p,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=v.zero(),this.m_linearError.wAdd(1,n,1,this.m_rB),this.m_linearError.wSub(1,i,1,this.m_rA),this.m_linearError.sub(x.mul(h,this.m_linearOffset)),this.m_angularError=r-o-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var d=v.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);e.wSub(_,d),s-=u*(v.cross(this.m_rA,d)+this.m_angularImpulse),m.wAdd(l,d),a+=p*(v.cross(this.m_rB,d)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=a},h.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=t.dt,c=t.inv_dt,_=s-o+c*this.m_correctionFactor*this.m_angularError,l=-this.m_angularMass*_,u=this.m_angularImpulse,p=h*this.m_maxTorque;this.m_angularImpulse=y.clamp(this.m_angularImpulse+l,-p,p),o-=m*(l=this.m_angularImpulse-u),s+=a*l,(_=v.zero()).wAdd(1,e,1,v.cross(s,this.m_rB)),_.wSub(1,i,1,v.cross(o,this.m_rA)),_.wAdd(c*this.m_correctionFactor,this.m_linearError);l=v.neg(f.mul(this.m_linearMass,_)),u=v.clone(this.m_linearImpulse);this.m_linearImpulse.add(l);p=h*this.m_maxForce;this.m_linearImpulse.clamp(p),l=v.sub(this.m_linearImpulse,u),i.wSub(n,l),o-=m*v.cross(this.m_rA,l),e.wAdd(r,l),s+=a*v.cross(this.m_rB,l),this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=e,this.m_bodyB.c_velocity.w=s},h.prototype.solvePositionConstraints=function(t){return!0}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],31:[function(t,i,o){var p=!1;i.exports=a;var y=t("../util/common"),s=t("../util/options"),e=t("../util/create"),d=t("../common/Math"),v=t("../common/Vec2"),f=(t("../common/Vec3"),t("../common/Mat22")),x=(t("../common/Mat33"),t("../common/Rot")),n=(t("../common/Sweep"),t("../common/Transform")),r=(t("../common/Velocity"),t("../common/Position"),t("../Joint"));a.TYPE="mouse-joint",a.prototype=e((a._super=r).prototype);var m={maxForce:0,frequencyHz:5,dampingRatio:.7};function a(t,i,o,e){if(!(this instanceof a))return new a(t,i,o,e);t=s(t,m),r.call(this,t,i,o),this.m_type=a.TYPE,p&&y.assert(d.isFinite(t.maxForce)&&0<=t.maxForce),p&&y.assert(d.isFinite(t.frequencyHz)&&0<=t.frequencyHz),p&&y.assert(d.isFinite(t.dampingRatio)&&0<=t.dampingRatio),this.m_targetA=v.clone(e),this.m_localAnchorB=n.mulT(this.m_bodyB.getTransform(),this.m_targetA),this.m_maxForce=t.maxForce,this.m_impulse=v.zero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=v.zero(),this.m_localCenterB=v.zero(),this.m_invMassB=0,this.m_invIB=0,this.mass=new f,this.m_C=v.zero()}a.prototype.setTarget=function(t){0==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_targetA=v.clone(t)},a.prototype.getTarget=function(){return this.m_targetA},a.prototype.setMaxForce=function(t){this.m_maxForce=t},a.getMaxForce=function(){return this.m_maxForce},a.prototype.setFrequency=function(t){this.m_frequencyHz=t},a.prototype.getFrequency=function(){return this.m_frequencyHz},a.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},a.prototype.getDampingRatio=function(){return this.m_dampingRatio},a.prototype.getAnchorA=function(){return v.clone(this.m_targetA)},a.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},a.prototype.getReactionForce=function(t){return v.mul(t,this.m_impulse)},a.prototype.getReactionTorque=function(t){return 0*t},a.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},a.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyB.c_position,o=this.m_bodyB.c_velocity,e=i.c,s=i.a,n=o.v,r=o.w,m=x.neo(s),a=this.m_bodyB.getMass(),h=2*d.PI*this.m_frequencyHz,c=2*a*this.m_dampingRatio*h,_=a*(h*h),l=t.dt;p&&y.assert(c+l*_>d.EPSILON),this.m_gamma=l*(c+l*_),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=l*_*this.m_gamma,this.m_rB=x.mul(m,v.sub(this.m_localAnchorB,this.m_localCenterB));var u=new f;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=u.getInverse(),this.m_C.set(e),this.m_C.wAdd(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),r*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),n.wAdd(this.m_invMassB,this.m_impulse),r+=this.m_invIB*v.cross(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),o.v.set(n),o.w=r},a.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyB.c_velocity,o=v.clone(i.v),e=i.w,s=v.cross(e,this.m_rB);s.add(o),s.wAdd(1,this.m_C,this.m_gamma,this.m_impulse),s.neg();var n=f.mul(this.m_mass,s),r=v.clone(this.m_impulse);this.m_impulse.add(n);var m=t.dt*this.m_maxForce;this.m_impulse.clamp(m),n=v.sub(this.m_impulse,r),o.wAdd(this.m_invMassB,n),e+=this.m_invIB*v.cross(this.m_rB,n),i.v.set(o),i.w=e},a.prototype.solvePositionConstraints=function(t){return!0}},{"../Joint":5,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],32:[function(t,i,o){i.exports=a;t("../util/common");var n=t("../util/options"),e=t("../util/create"),E=t("../Settings"),O=t("../common/Math"),N=t("../common/Vec2"),Y=t("../common/Vec3"),W=t("../common/Mat22"),H=t("../common/Mat33"),Z=t("../common/Rot"),r=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint")),I=0;a.TYPE="prismatic-joint",a.prototype=e((a._super=r).prototype);var m={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};function a(t,i,o,e,s){if(!(this instanceof a))return new a(t,i,o,e,s);t=n(t,m),r.call(this,t,i,o),this.m_type=a.TYPE,this.m_localAnchorA=t.localAnchorA||i.getLocalPoint(e),this.m_localAnchorB=t.localAnchorB||o.getLocalPoint(e),this.m_localXAxisA=t.localAxisA||i.getLocalVector(s),this.m_localXAxisA.normalize(),this.m_localYAxisA=N.cross(1,this.m_localXAxisA),this.m_referenceAngle=o.getAngle()-i.getAngle(),this.m_impulse=Y(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=I,this.m_axis=N.zero(),this.m_perp=N.zero(),this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_axis,this.m_perp,this.m_s1,this.m_s2,this.m_a1,this.m_a2,this.m_K=new H,this.m_motorMass}a.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},a.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},a.prototype.getLocalAxisA=function(){return this.m_localXAxisA},a.prototype.getReferenceAngle=function(){return this.m_referenceAngle},a.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),i=this.m_bodyB.getWorldPoint(this.m_localAnchorB),o=N.sub(i,t),e=this.m_bodyA.getWorldVector(this.m_localXAxisA);return N.dot(o,e)},a.prototype.getJointSpeed=function(){var t=this.m_bodyA,i=this.m_bodyB,o=Mul(t.m_xf.q,this.m_localAnchorA-t.m_sweep.localCenter),e=Mul(i.m_xf.q,this.m_localAnchorB-i.m_sweep.localCenter),s=t.m_sweep.c+o,n=i.m_sweep.c+e-s,r=Mul(t.m_xf.q,this.m_localXAxisA),m=t.m_linearVelocity,a=i.m_linearVelocity,h=t.m_angularVelocity,c=i.m_angularVelocity;return Dot(n,Cross(h,r))+Dot(r,a+Cross(c,e)-m-Cross(h,o))},a.prototype.isLimitEnabled=function(){return this.m_enableLimit},a.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},a.prototype.getLowerLimit=function(){return this.m_lowerTranslation},a.prototype.getUpperLimit=function(){return this.m_upperTranslation},a.prototype.setLimits=function(t,i){t==this.m_lowerTranslation&&i==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=i,this.m_impulse.z=0)},a.prototype.isMotorEnabled=function(){return this.m_enableMotor},a.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},a.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},a.prototype.setMaxMotorForce=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},a.prototype.getMotorSpeed=function(){return this.m_motorSpeed},a.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},a.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},a.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},a.prototype.getReactionForce=function(t){return N.wAdd(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},a.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},a.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=Z.neo(o),c=Z.neo(r),_=Z.mul(h,N.sub(this.m_localAnchorA,this.m_localCenterA)),l=Z.mul(c,N.sub(this.m_localAnchorB,this.m_localCenterB)),u=N.zero();u.wAdd(1,n,1,l),u.wSub(1,i,1,_);var p=this.m_invMassA,y=this.m_invMassB,d=this.m_invIA,v=this.m_invIB;this.m_axis=Z.mul(h,this.m_localXAxisA),this.m_a1=N.cross(N.add(u,_),this.m_axis),this.m_a2=N.cross(l,this.m_axis),this.m_motorMass=p+y+d*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=Z.mul(h,this.m_localYAxisA),this.m_s1=N.cross(N.add(u,_),this.m_perp),this.m_s2=N.cross(l,this.m_perp);N.cross(_,this.m_perp);var f=p+y+d*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2,x=d*this.m_s1+v*this.m_s2,A=d*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2,g=d+v;0==g&&(g=1);var b=d*this.m_a1+v*this.m_a2,B=p+y+d*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2;if(this.m_K.ex.set(f,x,A),this.m_K.ey.set(x,g,b),this.m_K.ez.set(A,b,B),this.m_enableLimit){var w=N.dot(this.m_axis,u);O.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*E.linearSlop?this.m_limitState=3:w<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):w>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=I,this.m_impulse.z=0)}else this.m_limitState=I,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var S=N.wAdd(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),C=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,M=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;e.wSub(p,S),s-=d*C,m.wAdd(y,S),a+=v*M}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=a},a.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){var h=N.dot(this.m_axis,N.sub(e,i))+this.m_a2*s-this.m_a1*o,c=this.m_motorMass*(this.m_motorSpeed-h),_=this.m_motorImpulse,l=t.dt*this.m_maxMotorForce;this.m_motorImpulse=O.clamp(this.m_motorImpulse+c,-l,l),c=this.m_motorImpulse-_;var u=N.zero().wSet(c,this.m_axis),p=c*this.m_a1,y=c*this.m_a2;i.wSub(n,u),o-=m*p,e.wAdd(r,u),s+=a*y}var d=N.zero();if(d.x+=N.dot(this.m_perp,e)+this.m_s2*s,d.x-=N.dot(this.m_perp,i)+this.m_s1*o,d.y=s-o,this.m_enableLimit&&this.m_limitState!=I){var v=0;v+=N.dot(this.m_axis,e)+this.m_a2*s,v-=N.dot(this.m_axis,i)+this.m_a1*o;h=Y(d.x,d.y,v);var f=Y(this.m_impulse),x=this.m_K.solve33(Y.neg(h));this.m_impulse.add(x),1==this.m_limitState?this.m_impulse.z=O.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=O.min(this.m_impulse.z,0));var A=N.wAdd(-1,d,-(this.m_impulse.z-f.z),N.neo(this.m_K.ez.x,this.m_K.ez.y)),g=N.add(this.m_K.solve22(A),N.neo(f.x,f.y));this.m_impulse.x=g.x,this.m_impulse.y=g.y,x=Y.sub(this.m_impulse,f);u=N.wAdd(x.x,this.m_perp,x.z,this.m_axis),p=x.x*this.m_s1+x.y+x.z*this.m_a1,y=x.x*this.m_s2+x.y+x.z*this.m_a2;i.wSub(n,u),o-=m*p,e.wAdd(r,u),s+=a*y}else{x=this.m_K.solve22(N.neg(d));this.m_impulse.x+=x.x,this.m_impulse.y+=x.y;u=N.zero().wAdd(x.x,this.m_perp),p=x.x*this.m_s1+x.y,y=x.x*this.m_s2+x.y;i.wSub(n,u),o-=m*p,e.wAdd(r,u),s+=a*y}this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=e,this.m_bodyB.c_velocity.w=s},a.prototype.solvePositionConstraints=function(t){var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=Z.neo(o),r=Z.neo(s),m=this.m_invMassA,a=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,_=Z.mul(n,N.sub(this.m_localAnchorA,this.m_localCenterA)),l=Z.mul(r,N.sub(this.m_localAnchorB,this.m_localCenterB)),u=N.sub(N.add(e,l),N.add(i,_)),p=Z.mul(n,this.m_localXAxisA),y=N.cross(N.add(u,_),p),d=N.cross(l,p),v=Z.mul(n,this.m_localYAxisA),f=N.cross(N.add(u,_),v),x=N.cross(l,v),A=Y(),g=N.zero();g.x=N.dot(v,u),g.y=s-o-this.m_referenceAngle;var b=O.abs(g.x),B=O.abs(g.y),w=E.linearSlop,S=E.maxLinearCorrection,C=!1,M=0;if(this.m_enableLimit){var I=N.dot(p,u);O.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*w?(M=O.clamp(I,-S,S),b=O.max(b,O.abs(I)),C=!0):I<=this.m_lowerTranslation?(M=O.clamp(I-this.m_lowerTranslation+w,-S,0),b=O.max(b,this.m_lowerTranslation-I),C=!0):I>=this.m_upperTranslation&&(M=O.clamp(I-this.m_upperTranslation-w,0,S),b=O.max(b,I-this.m_upperTranslation),C=!0)}if(C){var P=m+a+h*f*f+c*x*x,T=h*f+c*x,V=h*f*y+c*x*d;0==(q=h+c)&&(q=1);var z=h*y+c*d,L=m+a+h*y*y+c*d*d;(k=new H).ex.set(P,T,V),k.ey.set(T,q,z),k.ez.set(V,z,L);var F=Y();F.x=g.x,F.y=g.y,F.z=M,A=k.solve33(Y.neg(F))}else{var q,k;P=m+a+h*f*f+c*x*x,T=h*f+c*x;0==(q=h+c)&&(q=1),(k=new W).ex.set(P,T),k.ey.set(T,q);var R=k.solve(N.neg(g));A.x=R.x,A.y=R.y,A.z=0}var D=N.wAdd(A.x,v,A.z,p),j=A.x*f+A.y+A.z*y,J=A.x*x+A.y+A.z*d;return i.wSub(m,D),o-=h*j,e.wAdd(a,D),s+=c*J,this.m_bodyA.c_position.c=i,this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c=e,this.m_bodyB.c_position.a=s,b<=E.linearSlop&&B<=E.angularSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],33:[function(t,i,o){var a=!1;i.exports=u;var h=t("../util/common"),c=t("../util/options"),e=t("../util/create"),B=t("../Settings"),w=t("../common/Math"),S=t("../common/Vec2"),s=t("../common/Vec3"),C=(t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),_=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));u.TYPE="pulley-joint",u.MIN_PULLEY_LENGTH=2,u.prototype=e((u._super=_).prototype);var l={collideConnected:!0};function u(t,i,o,e,s,n,r,m){if(!(this instanceof u))return new u(t,i,o,e,s,n,r,m);t=c(t,l),_.call(this,t,i,o),this.m_type=u.TYPE,this.m_groundAnchorA=e,this.m_groundAnchorB=s,this.m_localAnchorA=i.getLocalPoint(n),this.m_localAnchorB=o.getLocalPoint(r),this.m_lengthA=S.distance(n,e),this.m_lengthB=S.distance(r,s),this.m_ratio=t.ratio||m,a&&h.assert(m>w.EPSILON),this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0,this.m_uA,this.m_uB,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}u.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},u.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},u.prototype.getLengthA=function(){return this.m_lengthA},u.prototype.getLengthB=function(){return this.m_lengthB},u.prototype.getRatio=function(){return this.m_ratio},u.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),i=this.m_groundAnchorA;return S.distance(t,i)},u.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=this.m_groundAnchorB;return S.distance(t,i)},u.prototype.shiftOrigin=function(t){this.m_groundAnchorA-=t,this.m_groundAnchorB-=t},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return s.mul(this.m_impulse,this.m_uB).mul(t)},u.prototype.getReactionTorque=function(t){return 0},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=C.neo(o),c=C.neo(r);this.m_rA=C.mul(h,S.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=C.mul(c,S.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=S.sub(S.add(i,this.m_rA),this.m_groundAnchorA),this.m_uB=S.sub(S.add(n,this.m_rB),this.m_groundAnchorB);var _=this.m_uA.length(),l=this.m_uB.length();_>10*B.linearSlop?this.m_uA.mul(1/_):this.m_uA.setZero(),l>10*B.linearSlop?this.m_uB.mul(1/l):this.m_uB.setZero();var u=S.cross(this.m_rA,this.m_uA),p=S.cross(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*u*u,d=this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=y+this.m_ratio*this.m_ratio*d,0<this.m_mass&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var v=S.mul(-this.m_impulse,this.m_uA),f=S.mul(-this.m_ratio*this.m_impulse,this.m_uB);e.wAdd(this.m_invMassA,v),s+=this.m_invIA*S.cross(this.m_rA,v),m.wAdd(this.m_invMassB,f),a+=this.m_invIB*S.cross(this.m_rB,f)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=m,this.m_bodyB.c_velocity.w=a},u.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=S.add(i,S.cross(o,this.m_rA)),r=S.add(e,S.cross(s,this.m_rB)),m=-S.dot(this.m_uA,n)-this.m_ratio*S.dot(this.m_uB,r),a=-this.m_mass*m;this.m_impulse+=a;var h=S.zero().wSet(-a,this.m_uA),c=S.zero().wSet(-this.m_ratio*a,this.m_uB);i.wAdd(this.m_invMassA,h),o+=this.m_invIA*S.cross(this.m_rA,h),e.wAdd(this.m_invMassB,c),s+=this.m_invIB*S.cross(this.m_rB,c),this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=e,this.m_bodyB.c_velocity.w=s},u.prototype.solvePositionConstraints=function(t){var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=C.neo(o),r=C.neo(s),m=C.mul(n,S.sub(this.m_localAnchorA,this.m_localCenterA)),a=C.mul(r,S.sub(this.m_localAnchorB,this.m_localCenterB)),h=S.sub(S.add(i,this.m_rA),this.m_groundAnchorA),c=S.sub(S.add(e,this.m_rB),this.m_groundAnchorB),_=h.length(),l=c.length();_>10*B.linearSlop?h.mul(1/_):h.setZero(),l>10*B.linearSlop?c.mul(1/l):c.setZero();var u=S.cross(m,h),p=S.cross(a,c),y=this.m_invMassA+this.m_invIA*u*u,d=this.m_invMassB+this.m_invIB*p*p,v=y+this.m_ratio*this.m_ratio*d;0<v&&(v=1/v);var f=this.m_constant-_-this.m_ratio*l,x=w.abs(f),A=-v*f,g=S.zero().wSet(-A,h),b=S.zero().wSet(-this.m_ratio*A,c);return i.wAdd(this.m_invMassA,g),o+=this.m_invIA*S.cross(m,g),e.wAdd(this.m_invMassB,b),s+=this.m_invIB*S.cross(a,b),this.m_bodyA.c_position.c=i,this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c=e,this.m_bodyB.c_position.a=s,x<B.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],34:[function(t,i,o){i.exports=a;t("../util/common");var s=t("../util/options"),e=t("../util/create"),g=t("../Settings"),b=t("../common/Math"),B=t("../common/Vec2"),x=t("../common/Vec3"),w=t("../common/Mat22"),n=t("../common/Mat33"),S=t("../common/Rot"),r=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint")),C=0;a.TYPE="revolute-joint",a.prototype=e((a._super=r).prototype);var m={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};function a(t,i,o,e){if(!(this instanceof a))return new a(t,i,o,e);t=s(t,m),r.call(this,t,i,o),this.m_type=a.TYPE,this.m_localAnchorA=t.localAnchorA||i.getLocalPoint(e),this.m_localAnchorB=t.localAnchorB||o.getLocalPoint(e),this.m_referenceAngle=o.getAngle()-i.getAngle(),this.m_impulse=x(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new n,this.m_motorMass,this.m_limitState=C}a.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},a.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},a.prototype.getReferenceAngle=function(){return this.m_referenceAngle},a.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},a.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},a.prototype.isMotorEnabled=function(){return this.m_enableMotor},a.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},a.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},a.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},a.prototype.getMotorSpeed=function(){return this.m_motorSpeed},a.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},a.prototype.isLimitEnabled=function(){return this.m_enableLimit},a.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},a.prototype.getLowerLimit=function(){return this.m_lowerAngle},a.prototype.getUpperLimit=function(){return this.m_upperAngle},a.prototype.setLimits=function(t,i){t==this.m_lowerAngle&&i==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=i)},a.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},a.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},a.prototype.getReactionForce=function(t){return B.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},a.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},a.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=S.neo(i),a=S.neo(s);this.m_rA=S.mul(m,B.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=S.mul(a,B.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=_+l==0;if(this.m_mass.ex.x=h+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*l,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*l,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*l,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=h+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*l,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*l,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+l,this.m_motorMass=_+l,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||u)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==u){var p=s-i-this.m_referenceAngle;b.abs(this.m_upperAngle-this.m_lowerAngle)<2*g.angularSlop?this.m_limitState=3:p<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):p>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=C,this.m_impulse.z=0)}else this.m_limitState=C;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var y=B.neo(this.m_impulse.x,this.m_impulse.y);o.wSub(h,y),e-=_*(B.cross(this.m_rA,y)+this.m_motorImpulse+this.m_impulse.z),n.wAdd(c,y),r+=l*(B.cross(this.m_rB,y)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},a.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB,h=m+a==0;if(this.m_enableMotor&&3!=this.m_limitState&&0==h){var c=s-o-this.m_motorSpeed,_=-this.m_motorMass*c,l=this.m_motorImpulse,u=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=b.clamp(this.m_motorImpulse+_,-u,u),o-=m*(_=this.m_motorImpulse-l),s+=a*_}if(this.m_enableLimit&&this.m_limitState!=C&&0==h){var p=B.zero();p.wAdd(1,e,1,B.cross(s,this.m_rB)),p.wSub(1,i,1,B.cross(o,this.m_rA));var y=s-o;c=x(p.x,p.y,y),_=x.neg(this.m_mass.solve33(c));if(3==this.m_limitState)this.m_impulse.add(_);else if(1==this.m_limitState){if(this.m_impulse.z+_.z<0){var d=B.wAdd(-1,p,this.m_impulse.z,B.neo(this.m_mass.ez.x,this.m_mass.ez.y)),v=this.m_mass.solve22(d);_.x=v.x,_.y=v.y,_.z=-this.m_impulse.z,this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,this.m_impulse.z=0}else this.m_impulse.add(_)}else if(2==this.m_limitState){if(0<this.m_impulse.z+_.z){d=B.wAdd(-1,p,this.m_impulse.z,B.neo(this.m_mass.ez.x,this.m_mass.ez.y)),v=this.m_mass.solve22(d);_.x=v.x,_.y=v.y,_.z=-this.m_impulse.z,this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,this.m_impulse.z=0}else this.m_impulse.add(_)}var f=B.neo(_.x,_.y);i.wSub(n,f),o-=m*(B.cross(this.m_rA,f)+_.z),e.wAdd(r,f),s+=a*(B.cross(this.m_rB,f)+_.z)}else{(c=B.zero()).wAdd(1,e,1,B.cross(s,this.m_rB)),c.wSub(1,i,1,B.cross(o,this.m_rA));_=this.m_mass.solve22(B.neg(c));this.m_impulse.x+=_.x,this.m_impulse.y+=_.y,i.wSub(n,_),o-=m*B.cross(this.m_rA,_),e.wAdd(r,_),s+=a*B.cross(this.m_rB,_)}this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=e,this.m_bodyB.c_velocity.w=s},a.prototype.solvePositionConstraints=function(t){var i,o=this.m_bodyA.c_position.c,e=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,r=S.neo(e),m=S.neo(n),a=0,h=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=C&&0==h){var c=n-e-this.m_referenceAngle,_=0;if(3==this.m_limitState){var l=b.clamp(c-this.m_lowerAngle,-g.maxAngularCorrection,g.maxAngularCorrection);_=-this.m_motorMass*l,a=b.abs(l)}else if(1==this.m_limitState){a=-(l=c-this.m_lowerAngle),l=b.clamp(l+g.angularSlop,-g.maxAngularCorrection,0),_=-this.m_motorMass*l}else if(2==this.m_limitState){a=l=c-this.m_upperAngle,l=b.clamp(l-g.angularSlop,0,g.maxAngularCorrection),_=-this.m_motorMass*l}e-=this.m_invIA*_,n+=this.m_invIB*_}r.set(e),m.set(n);var u=S.mul(r,B.sub(this.m_localAnchorA,this.m_localCenterA)),p=S.mul(m,B.sub(this.m_localAnchorB,this.m_localCenterB));(l=B.zero()).wAdd(1,s,1,p),l.wSub(1,o,1,u),i=l.length();var y=this.m_invMassA,d=this.m_invMassB,v=this.m_invIA,f=this.m_invIB,x=new w;x.ex.x=y+d+v*u.y*u.y+f*p.y*p.y,x.ex.y=-v*u.x*u.y-f*p.x*p.y,x.ey.x=x.ex.y,x.ey.y=y+d+v*u.x*u.x+f*p.x*p.x;var A=B.neg(x.solve(l));return o.wSub(y,A),e-=v*B.cross(u,A),s.wAdd(d,A),n+=f*B.cross(p,A),this.m_bodyA.c_position.c.set(o),this.m_bodyA.c_position.a=e,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=n,i<=g.linearSlop&&a<=g.angularSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/common":50,"../util/create":51,"../util/options":52}],35:[function(t,i,o){i.exports=m;var s=t("../util/options"),e=t("../util/create"),d=t("../Settings"),p=t("../common/Math"),v=t("../common/Vec2"),f=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),n=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint")),x=0;m.TYPE="rope-joint",m.prototype=e((m._super=n).prototype);var r={maxLength:0};function m(t,i,o,e){if(!(this instanceof m))return new m(t,i,o,e);t=s(t,r),n.call(this,t,i,o),this.m_type=m.TYPE,this.m_localAnchorA=t.localAnchorA||i.getLocalPoint(e),this.m_localAnchorB=t.localAnchorB||o.getLocalPoint(e),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=x,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}m.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},m.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},m.prototype.setMaxLength=function(t){this.m_maxLength=t},m.prototype.getMaxLength=function(){return this.m_maxLength},m.prototype.getLimitState=function(){return this.m_state},m.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},m.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},m.prototype.getReactionForce=function(t){return v.mul(this.m_impulse,this.m_u).mul(t)},m.prototype.getReactionTorque=function(t){return 0},m.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=f.neo(o),c=f.neo(r);this.m_rA=f.mulSub(h,this.m_localAnchorA,this.m_localCenterA),this.m_rB=f.mulSub(c,this.m_localAnchorB,this.m_localCenterB),this.m_u=v.zero(),this.m_u.wAdd(1,n,1,this.m_rB),this.m_u.wSub(1,i,1,this.m_rA),this.m_length=this.m_u.length();var _=this.m_length-this.m_maxLength;if(this.m_state=0<_?2:x,!(this.m_length>d.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var l=v.cross(this.m_rA,this.m_u),u=v.cross(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,t.warmStarting){this.m_impulse*=t.dtRatio;var y=v.mul(this.m_impulse,this.m_u);e.wSub(this.m_invMassA,y),s-=this.m_invIA*v.cross(this.m_rA,y),m.wAdd(this.m_invMassB,y),a+=this.m_invIB*v.cross(this.m_rB,y)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=a},m.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=v.addCross(i,o,this.m_rA),r=v.addCross(e,s,this.m_rB),m=this.m_length-this.m_maxLength,a=v.dot(this.m_u,v.sub(r,n));m<0&&(a+=t.inv_dt*m);var h=-this.m_mass*a,c=this.m_impulse;this.m_impulse=p.min(0,this.m_impulse+h),h=this.m_impulse-c;var _=v.mul(h,this.m_u);i.wSub(this.m_invMassA,_),o-=this.m_invIA*v.cross(this.m_rA,_),e.wAdd(this.m_invMassB,_),s+=this.m_invIB*v.cross(this.m_rB,_),this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=e,this.m_bodyB.c_velocity.w=s},m.prototype.solvePositionConstraints=function(t){var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=f.neo(o),r=f.neo(s),m=f.mulSub(n,this.m_localAnchorA,this.m_localCenterA),a=f.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=v.zero();h.wAdd(1,e,1,a),h.wSub(1,i,1,m);var c=h.normalize(),_=c-this.m_maxLength;_=p.clamp(_,0,d.maxLinearCorrection);var l=-this.m_mass*_,u=v.mul(l,h);return i.wSub(this.m_invMassA,u),o-=this.m_invIA*v.cross(m,u),e.wAdd(this.m_invMassB,u),s+=this.m_invIB*v.cross(a,u),this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.set(e),this.m_bodyB.c_position.a=s,c-this.m_maxLength<d.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/create":51,"../util/options":52}],36:[function(t,i,o){i.exports=m;var s=t("../util/options"),e=t("../util/create"),b=t("../Settings"),B=t("../common/Math"),w=t("../common/Vec2"),S=t("../common/Vec3"),C=(t("../common/Mat22"),t("../common/Mat33")),M=t("../common/Rot"),n=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));m.TYPE="weld-joint",m.prototype=e((m._super=n).prototype);var r={frequencyHz:0,dampingRatio:0};function m(t,i,o,e){if(!(this instanceof m))return new m(t,i,o,e);t=s(t,r),n.call(this,t,i,o),this.m_type=m.TYPE,this.m_localAnchorA=i.getLocalPoint(e),this.m_localAnchorB=o.getLocalPoint(e),this.m_referenceAngle=o.getAngle()-i.getAngle(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=S(),this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new C}m.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},m.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},m.prototype.getReferenceAngle=function(){return this.m_referenceAngle},m.prototype.setFrequency=function(t){this.m_frequencyHz=t},m.prototype.getFrequency=function(){return this.m_frequencyHz},m.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},m.prototype.getDampingRatio=function(){return this.m_dampingRatio},m.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},m.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},m.prototype.getReactionForce=function(t){return w.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},m.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},m.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,e=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,m=M.neo(i),a=M.neo(s);this.m_rA=M.mul(m,w.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=M.mul(a,w.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=new C;if(u.ex.x=h+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*l,u.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*l,u.ez.x=-this.m_rA.y*_-this.m_rB.y*l,u.ex.y=u.ey.x,u.ey.y=h+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*l,u.ez.y=this.m_rA.x*_+this.m_rB.x*l,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=_+l,0<this.m_frequencyHz){u.getInverse22(this.m_mass);var p=_+l,y=0<p?1/p:0,d=s-i-this.m_referenceAngle,v=2*B.PI*this.m_frequencyHz,f=2*y*this.m_dampingRatio*v,x=y*v*v,A=t.dt;this.m_gamma=A*(f+A*x),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*A*x*this.m_gamma,p+=this.m_gamma,this.m_mass.ez.z=0!=p?1/p:0}else 0==u.ez.z?u.getInverse22(this.m_mass):u.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var g=w.neo(this.m_impulse.x,this.m_impulse.y);o.wSub(h,g),e-=_*(w.cross(this.m_rA,g)+this.m_impulse.z),n.wAdd(c,g),r+=l*(w.cross(this.m_rB,g)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=e,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},m.prototype.solveVelocityConstraints=function(t){var i=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,e=this.m_bodyB.c_velocity.v,s=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,m=this.m_invIA,a=this.m_invIB;if(0<this.m_frequencyHz){var h=s-o,c=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,o-=m*c,s+=a*c,(u=w.zero()).wAdd(1,e,1,w.cross(s,this.m_rB)),u.wSub(1,i,1,w.cross(o,this.m_rA));var _=w.neg(C.mul(this.m_mass,u));this.m_impulse.x+=_.x,this.m_impulse.y+=_.y;var l=w.clone(_);i.wSub(n,l),o-=m*w.cross(this.m_rA,l),e.wAdd(r,l),s+=a*w.cross(this.m_rB,l)}else{var u;(u=w.zero()).wAdd(1,e,1,w.cross(s,this.m_rB)),u.wSub(1,i,1,w.cross(o,this.m_rA));h=s-o;var p=S(u.x,u.y,h),y=S.neg(C.mul(this.m_mass,p));this.m_impulse.add(y);l=w.neo(y.x,y.y);i.wSub(n,l),o-=m*(w.cross(this.m_rA,l)+y.z),e.wAdd(r,l),s+=a*(w.cross(this.m_rB,l)+y.z)}this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=e,this.m_bodyB.c_velocity.w=s},m.prototype.solvePositionConstraints=function(t){var i,o,e=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,m=M.neo(s),a=M.neo(r),h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=M.mul(m,w.sub(this.m_localAnchorA,this.m_localCenterA)),p=M.mul(a,w.sub(this.m_localAnchorB,this.m_localCenterB)),y=new C;if(y.ex.x=h+c+u.y*u.y*_+p.y*p.y*l,y.ey.x=-u.y*u.x*_-p.y*p.x*l,y.ez.x=-u.y*_-p.y*l,y.ex.y=y.ey.x,y.ey.y=h+c+u.x*u.x*_+p.x*p.x*l,y.ez.y=u.x*_+p.x*l,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=_+l,0<this.m_frequencyHz){(v=w.zero()).wAdd(1,n,1,p),v.wSub(1,e,1,u),i=v.length(),o=0;var d=w.neg(y.solve22(v));e.wSub(h,d),s-=_*w.cross(u,d),n.wAdd(c,d),r+=l*w.cross(p,d)}else{var v;(v=w.zero()).wAdd(1,n,1,p),v.wSub(1,e,1,u);var f=r-s-this.m_referenceAngle;i=v.length(),o=B.abs(f);var x=S(v.x,v.y,f),A=S();if(0<y.ez.z)A=S.neg(y.solve33(x));else{var g=w.neg(y.solve22(v));A.set(g.x,g.y,0)}d=w.neo(A.x,A.y);e.wSub(h,d),s-=_*(w.cross(u,d)+A.z),n.wAdd(c,d),r+=l*(w.cross(p,d)+A.z)}return this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,i<=b.linearSlop&&o<=b.angularSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/create":51,"../util/options":52}],37:[function(t,i,o){i.exports=a;var n=t("../util/options"),e=t("../util/create"),x=t("../Settings"),C=t("../common/Math"),M=t("../common/Vec2"),I=(t("../common/Vec3"),t("../common/Mat22"),t("../common/Mat33"),t("../common/Rot")),r=(t("../common/Sweep"),t("../common/Transform"),t("../common/Velocity"),t("../common/Position"),t("../Joint"));a.TYPE="wheel-joint",a.prototype=e((a._super=r).prototype);var m={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};function a(t,i,o,e,s){if(!(this instanceof a))return new a(t,i,o,e,s);t=n(t,m),r.call(this,t,i,o),this.m_type=a.TYPE,this.m_localAnchorA=i.getLocalPoint(e),this.m_localAnchorB=o.getLocalPoint(e),this.m_localXAxisA=i.getLocalVector(s||M.neo(1,0)),this.m_localYAxisA=M.cross(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_ax=M.zero(),this.m_ay=M.zero(),this.m_sAx,this.m_sBx,this.m_sAy,this.m_sBy}a.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},a.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},a.prototype.getLocalAxisA=function(){return this.m_localXAxisA},a.prototype.getJointTranslation=function(){var t=this.m_bodyA,i=this.m_bodyB,o=t.getWorldPoint(this.m_localAnchorA),e=i.getWorldPoint(this.m_localAnchorB)-o,s=t.getWorldVector(this.m_localXAxisA);return Dot(e,s)},a.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},a.prototype.isMotorEnabled=function(){return this.m_enableMotor},a.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},a.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},a.prototype.getMotorSpeed=function(){return this.m_motorSpeed},a.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},a.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},a.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},a.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},a.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},a.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},a.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},a.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},a.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},a.prototype.getReactionForce=function(t){return M.wAdd(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},a.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},a.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=this.m_invMassA,o=this.m_invMassB,e=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,m=this.m_bodyA.c_velocity.v,a=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,u=I.neo(r),p=I.neo(c),y=I.mul(u,M.sub(this.m_localAnchorA,this.m_localCenterA)),d=I.mul(p,M.sub(this.m_localAnchorB,this.m_localCenterB));if((A=M.zero()).wAdd(1,h,1,d),A.wSub(1,n,1,y),this.m_ay=I.mul(u,this.m_localYAxisA),this.m_sAy=M.cross(M.add(A,y),this.m_ay),this.m_sBy=M.cross(d,this.m_ay),this.m_mass=i+o+e*this.m_sAy*this.m_sAy+s*this.m_sBy*this.m_sBy,0<this.m_mass&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,(this.m_gamma=0)<this.m_frequencyHz){this.m_ax=I.mul(u,this.m_localXAxisA),this.m_sAx=M.cross(M.add(A,y),this.m_ax),this.m_sBx=M.cross(d,this.m_ax);var v=i+o+e*this.m_sAx*this.m_sAx+s*this.m_sBx*this.m_sBx;if(0<v){this.m_springMass=1/v;var f=M.dot(A,this.m_ax),x=2*C.PI*this.m_frequencyHz,A=2*this.m_springMass*this.m_dampingRatio*x,g=this.m_springMass*x*x,b=t.dt;this.m_gamma=b*(A+b*g),0<this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_bias=f*b*g*this.m_gamma,this.m_springMass=v+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=e+s,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var B=M.wAdd(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),w=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,S=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;m.wSub(this.m_invMassA,B),a-=this.m_invIA*w,_.wAdd(this.m_invMassB,B),l+=this.m_invIB*S}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(m),this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v.set(_),this.m_bodyB.c_velocity.w=l},a.prototype.solveVelocityConstraints=function(t){var i=this.m_invMassA,o=this.m_invMassB,e=this.m_invIA,s=this.m_invIB,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,a=this.m_bodyB.c_velocity.w,h=M.dot(this.m_ax,m)-M.dot(this.m_ax,n)+this.m_sBx*a-this.m_sAx*r,c=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var _=M.zero().wSet(c,this.m_ax),l=c*this.m_sAx,u=c*this.m_sBx;n.wSub(i,_),r-=e*l,m.wAdd(o,_);h=(a+=s*u)-r-this.m_motorSpeed,c=-this.m_motorMass*h;var p=this.m_motorImpulse,y=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=C.clamp(this.m_motorImpulse+c,-y,y),r-=e*(c=this.m_motorImpulse-p),a+=s*c;h=M.dot(this.m_ay,m)-M.dot(this.m_ay,n)+this.m_sBy*a-this.m_sAy*r,c=-this.m_mass*h;this.m_impulse+=c;_=M.zero().wSet(c,this.m_ay),l=c*this.m_sAy,u=c*this.m_sBy;n.wSub(i,_),r-=e*l,m.wAdd(o,_),a+=s*u,this.m_bodyA.c_velocity.v.set(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=a},a.prototype.solvePositionConstraints=function(t){var i=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,e=this.m_bodyB.c_position.c,s=this.m_bodyB.c_position.a,n=I.neo(o),r=I.neo(s),m=I.mul(n,M.sub(this.m_localAnchorA,this.m_localCenterA)),a=I.mul(r,M.sub(this.m_localAnchorB,this.m_localCenterB)),h=M.zero();h.wAdd(1,e,1,a),h.wSub(1,i,1,m);var c,_=I.mul(n,this.m_localYAxisA),l=M.cross(M.add(h,m),_),u=M.cross(a,_),p=M.dot(h,_),y=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;c=0!=y?-p/y:0;var d=M.zero().wSet(c,_),v=c*l,f=c*u;return i.wSub(this.m_invMassA,d),o-=this.m_invIA*v,e.wAdd(this.m_invMassB,d),s+=this.m_invIB*f,this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c.set(e),this.m_bodyB.c_position.a=s,C.abs(p)<=x.linearSlop}},{"../Joint":5,"../Settings":7,"../common/Mat22":16,"../common/Mat33":17,"../common/Math":18,"../common/Position":19,"../common/Rot":20,"../common/Sweep":21,"../common/Transform":22,"../common/Vec2":23,"../common/Vec3":24,"../common/Velocity":25,"../util/create":51,"../util/options":52}],38:[function(t,i,o){i.exports=n;t("../util/common");var e=t("../util/create"),s=t("./PolygonShape");function n(t,i,o,e){if(!(this instanceof n))return new n(t,i,o,e);n._super.call(this),this._setAsBox(t,i,o,e)}n.prototype=e((n._super=s).prototype),n.TYPE="polygon"},{"../util/common":50,"../util/create":51,"./PolygonShape":47}],39:[function(t,i,o){i.exports=h;t("../util/common");var e=t("../util/create"),n=(t("../util/options"),t("../common/Math"),t("../common/Transform")),s=(t("../common/Rot"),t("../common/Vec2")),r=(t("../collision/AABB"),t("../Settings")),m=t("../Shape"),a=t("./EdgeShape");function h(t,i){if(!(this instanceof h))return new h(t,i);h._super.call(this),this.m_type=h.TYPE,this.m_radius=r.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,t&&t.length&&(i?this._createLoop(t):this._createChain(t))}h.prototype=e((h._super=m).prototype),h.TYPE="chain",h.prototype._createLoop=function(t){for(var i=1;i<t.length;++i)t[i-1],t[i];this.m_vertices.length=0,this.m_count=t.length+1;for(i=0;i<t.length;++i)this.m_vertices[i]=t[i].clone();return this.m_vertices[t.length]=t[0].clone(),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},h.prototype._createChain=function(t){for(var i=1;i<t.length;++i)t[i-1],t[i];this.m_count=t.length;for(i=0;i<t.length;++i)this.m_vertices[i]=t[i].clone();return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},h.prototype._setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},h.prototype._setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},h.prototype._clone=function(){var t=new h;return t.createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},h.prototype.getChildCount=function(){return this.m_count-1},h.prototype.getChildEdge=function(t,i){t.m_type=a.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[i],t.m_vertex2=this.m_vertices[i+1],0<i?(t.m_vertex0=this.m_vertices[i-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),i<this.m_count-2?(t.m_vertex3=this.m_vertices[i+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},h.prototype.getVertex=function(t){return t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},h.prototype.testPoint=function(t,i){return!1},h.prototype.rayCast=function(t,i,o,e){return new a(this.getVertex(e),this.getVertex(e+1)).rayCast(t,i,o,0)},h.prototype.computeAABB=function(t,i,o){var e=n.mul(i,this.getVertex(o)),s=n.mul(i,this.getVertex(o+1));t.combinePoints(e,s)},h.prototype.computeMass=function(t,i){t.mass=0,t.center=s.neo(),t.I=0},h.prototype.computeDistanceProxy=function(t,i){t.m_buffer[0]=this.getVertex(i),t.m_buffer[1]=this.getVertex(i+1),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius}},{"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"../util/options":52,"./EdgeShape":46}],40:[function(t,i,o){i.exports=n;t("../util/common");var e=t("../util/create"),l=(t("../util/options"),t("../common/Math")),u=(t("../common/Transform"),t("../common/Rot")),p=t("../common/Vec2"),s=(t("../collision/AABB"),t("../Settings"),t("../Shape"));function n(t,i){if(!(this instanceof n))return new n(t,i);n._super.call(this),this.m_type=n.TYPE,this.m_p=p.zero(),this.m_radius=1,"object"==typeof t&&p.isValid(t)?(this.m_p.set(t),"number"==typeof i&&(this.m_radius=i)):"number"==typeof t&&(this.m_radius=t)}n.prototype=e((n._super=s).prototype),n.TYPE="circle",n.prototype.getRadius=function(){return this.m_radius},n.prototype.getCenter=function(){return this.m_p},n.prototype.getSupportVertex=function(t){return this.m_p},n.prototype.getVertex=function(t){return this.m_p},n.prototype.getVertexCount=function(t){return 1},n.prototype._clone=function(){var t=new n;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},n.prototype.getChildCount=function(){return 1},n.prototype.testPoint=function(t,i){var o=p.add(t.p,u.mul(t.q,this.m_p)),e=p.sub(i,o);return p.dot(e,e)<=this.m_radius*this.m_radius},n.prototype.rayCast=function(t,i,o,e){var s=p.add(o.p,u.mul(o.q,this.m_p)),n=p.sub(i.p1,s),r=p.dot(n,n)-this.m_radius*this.m_radius,m=p.sub(i.p2,i.p1),a=p.dot(n,m),h=p.dot(m,m),c=a*a-h*r;if(c<0||h<l.EPSILON)return!1;var _=-(a+l.sqrt(c));return 0<=_&&_<=i.maxFraction*h&&(_/=h,t.fraction=_,t.normal=p.add(n,p.mul(_,m)),t.normal.normalize(),!0)},n.prototype.computeAABB=function(t,i,o){var e=p.add(i.p,u.mul(i.q,this.m_p));t.lowerBound.set(e.x-this.m_radius,e.y-this.m_radius),t.upperBound.set(e.x+this.m_radius,e.y+this.m_radius)},n.prototype.computeMass=function(t,i){t.mass=i*l.PI*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+p.dot(this.m_p,this.m_p))},n.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"../util/options":52}],41:[function(t,i,o){t("../util/common"),t("../util/create"),t("../common/Math");var h=t("../common/Transform"),c=t("../common/Vec2"),e=(t("../Settings"),t("../Shape"),t("../Contact")),_=t("../Manifold"),s=t("./CircleShape");function m(t,i,o,e,s){t.pointCount=0;var n=h.mul(o,i.m_p),r=h.mul(s,e.m_p),m=c.distanceSquared(r,n),a=i.m_radius+e.m_radius;a*a<m||(t.type=_.e_circles,t.localPoint.set(i.m_p),t.localNormal.setZero(),t.pointCount=1,t.points[0].localPoint.set(e.m_p),t.points[0].id.key=0)}e.addType(s.TYPE,s.TYPE,function(t,i,o,e,s,n,r){m(t,o.getShape(),i,n.getShape(),s)}),o.CollideCircles=m},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../common/Math":18,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"./CircleShape":40}],42:[function(t,i,o){t("../util/common");var b=t("../common/Math"),B=t("../common/Transform"),w=(t("../common/Rot"),t("../common/Vec2")),S=(t("../collision/AABB"),t("../Settings"),t("../Manifold")),e=t("../Contact"),s=(t("../Shape"),t("./CircleShape")),n=t("./PolygonShape");e.addType(n.TYPE,s.TYPE,function(t,i,o,e,s,n,r){!function(t,i,o,e,s){t.pointCount=0;for(var n=B.mul(s,e.m_p),r=B.mulT(o,n),m=0,a=-1/0,h=i.m_radius+e.m_radius,c=i.m_count,_=i.m_vertices,l=i.m_normals,u=0;u<c;++u){var p=w.dot(l[u],w.sub(r,_[u]));if(h<p)return;a<p&&(a=p,m=u)}var y=m,d=y+1<c?y+1:0,v=_[y],f=_[d];if(a<b.EPSILON)return t.pointCount=1,t.type=S.e_faceA,t.localNormal.set(l[m]),t.localPoint.wSet(.5,v,.5,f),t.points[0].localPoint=e.m_p,t.points[0].id.key=0;var x=w.dot(w.sub(r,v),w.sub(f,v)),A=w.dot(w.sub(r,f),w.sub(v,f));if(x<=0){if(w.distanceSquared(r,v)>h*h)return;t.pointCount=1,t.type=S.e_faceA,t.localNormal.wSet(1,r,-1,v),t.localNormal.normalize(),t.localPoint=v,t.points[0].localPoint.set(e.m_p),t.points[0].id.key=0}else if(A<=0){if(w.distanceSquared(r,f)>h*h)return;t.pointCount=1,t.type=S.e_faceA,t.localNormal.wSet(1,r,-1,f),t.localNormal.normalize(),t.localPoint.set(f),t.points[0].localPoint.set(e.m_p),t.points[0].id.key=0}else{var g=w.mid(v,f),a=w.dot(r,l[y])-w.dot(g,l[y]);if(h<a)return;t.pointCount=1,t.type=S.e_faceA,t.localNormal.set(l[y]),t.localPoint.set(g),t.points[0].localPoint.set(e.m_p),t.points[0].id.key=0}}(t,o.getShape(),i,n.getShape(),s)})},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"./CircleShape":40,"./PolygonShape":47}],43:[function(t,i,o){var b=!1,B=t("../util/common"),w=(t("../util/create"),t("../common/Math"),t("../common/Transform")),S=t("../common/Vec2"),e=(t("../common/Rot"),t("../Settings"),t("../Shape"),t("../Contact")),C=t("../Manifold"),_=t("./EdgeShape"),l=t("./ChainShape"),u=t("./CircleShape");function p(t,i,o,e,s){t.pointCount=0;var n=w.mulT(o,w.mul(s,e.m_p)),r=i.m_vertex1,m=i.m_vertex2,a=S.sub(m,r),h=S.dot(a,S.sub(m,n)),c=S.dot(a,S.sub(n,r)),_=i.m_radius+e.m_radius;if(c<=0){var l=S.clone(r),u=S.sub(n,l);if(_*_<S.dot(u,u))return;if(i.m_hasVertex0){var p=i.m_vertex0,y=r,d=S.sub(y,p);if(0<S.dot(d,S.sub(y,n)))return}return t.type=C.e_circles,t.localNormal.setZero(),t.localPoint.set(l),t.pointCount=1,t.points[0].localPoint.set(e.m_p),t.points[0].id.key=0,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=C.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=C.e_vertex)}if(h<=0){l=S.clone(m),u=S.sub(n,l);if(_*_<S.dot(u,u))return;if(i.m_hasVertex3){var v=i.m_vertex3,f=m,x=S.sub(v,f);if(0<S.dot(x,S.sub(n,f)))return}return t.type=C.e_circles,t.localNormal.setZero(),t.localPoint.set(l),t.pointCount=1,t.points[0].localPoint.set(e.m_p),t.points[0].id.key=0,t.points[0].id.cf.indexA=1,t.points[0].id.cf.typeA=C.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=C.e_vertex)}var A=S.dot(a,a);b&&B.assert(0<A);l=S.wAdd(h/A,r,c/A,m),u=S.sub(n,l);if(!(_*_<S.dot(u,u))){var g=S.neo(-a.y,a.x);S.dot(g,S.sub(n,r))<0&&g.set(-g.x,-g.y),g.normalize(),t.type=C.e_faceA,t.localNormal=g,t.localPoint.set(r),t.pointCount=1,t.points[0].localPoint.set(e.m_p),t.points[0].id.key=0,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=C.e_face,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=C.e_vertex}}e.addType(_.TYPE,u.TYPE,function(t,i,o,e,s,n,r){b&&B.assert(o.getType()==_.TYPE),b&&B.assert(n.getType()==u.TYPE);var m=o.getShape(),a=n.getShape();p(t,m,i,a,s)}),e.addType(l.TYPE,u.TYPE,function(t,i,o,e,s,n,r){b&&B.assert(o.getType()==l.TYPE),b&&B.assert(n.getType()==u.TYPE);var m=o.getShape(),a=new _;m.getChildEdge(a,e);var h=a,c=n.getShape();p(t,h,i,c,s)})},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"./ChainShape":39,"./CircleShape":40,"./EdgeShape":46}],44:[function(t,i,o){t("../util/common"),t("../util/create");var H=t("../common/Math"),Z=t("../common/Transform"),K=t("../common/Vec2"),G=t("../common/Rot"),U=t("../Settings"),e=(t("../Shape"),t("../Contact")),X=t("../Manifold"),h=t("./EdgeShape"),s=t("./ChainShape"),n=t("./PolygonShape");e.addType(h.TYPE,n.TYPE,function(t,i,o,e,s,n,r){c(t,o.getShape(),i,n.getShape(),s)}),e.addType(s.TYPE,n.TYPE,function(t,i,o,e,s,n,r){var m=o.getShape(),a=new h;m.getChildEdge(a,e),c(t,a,i,n.getShape(),s)});var Q=-1,$=1,tt=2;function r(){this.type,this.index,this.separation}var it=new r,ot=new r,et=new function(){this.vertices=[],this.normals=[],this.count=0},st=new function(){this.i1,this.i2,this.v1,this.v2,this.normal=K.zero(),this.sideNormal1=K.zero(),this.sideOffset1,this.sideNormal2=K.zero(),this.sideOffset2};function c(t,i,o,e,s){var n=Z.mulT(o,s),r=Z.mul(n,e.m_centroid),m=i.m_vertex0,a=i.m_vertex1,h=i.m_vertex2,c=i.m_vertex3,_=i.m_hasVertex0,l=i.m_hasVertex3,u=K.sub(h,a);u.normalize();var p,y=K.neo(u.y,-u.x),d=K.dot(y,K.sub(r,a)),v=0,f=0,x=!1,A=!1;if(_){var g=K.sub(a,m);g.normalize();var b=K.neo(g.y,-g.x);x=0<=K.cross(g,u),v=K.dot(b,r)-K.dot(b,m)}if(l){var B=K.sub(c,h);B.normalize();var w=K.neo(B.y,-B.x);A=0<K.cross(u,B),f=K.dot(w,r)-K.dot(w,h)}var S=K.zero(),C=K.zero(),M=K.zero();_&&l?x&&A?(p=0<=v||0<=d||0<=f)?(S.set(y),C.set(b),M.set(w)):(S.wSet(-1,y),C.wSet(-1,y),M.wSet(-1,y)):x?(p=0<=v||0<=d&&0<=f)?(S.set(y),C.set(b),M.set(y)):(S.wSet(-1,y),C.wSet(-1,w),M.wSet(-1,y)):A?(p=0<=f||0<=v&&0<=d)?(S.set(y),C.set(y),M.set(w)):(S.wSet(-1,y),C.wSet(-1,y),M.wSet(-1,b)):(p=0<=v&&0<=d&&0<=f)?(S.set(y),C.set(y),M.set(y)):(S.wSet(-1,y),C.wSet(-1,w),M.wSet(-1,b)):_?x?((p=0<=v||0<=d)?(S.set(y),C.set(b)):(S.wSet(-1,y),C.set(y)),M.wSet(-1,y)):(p=0<=v&&0<=d)?(S.set(y),C.set(y),M.wSet(-1,y)):(S.wSet(-1,y),C.set(y),M.wSet(-1,b)):l?A?(p=0<=d||0<=f)?(S.set(y),C.wSet(-1,y),M.set(w)):(S.wSet(-1,y),C.wSet(-1,y),M.set(y)):((p=0<=d&&0<=f)?(S.set(y),C.wSet(-1,y)):(S.wSet(-1,y),C.wSet(-1,w)),M.set(y)):(p=0<=d)?(S.set(y),C.wSet(-1,y),M.wSet(-1,y)):(S.wSet(-1,y),C.set(y),M.set(y)),et.count=e.m_count;for(var I=0;I<e.m_count;++I)et.vertices[I]=Z.mul(n,e.m_vertices[I]),et.normals[I]=G.mul(n.q,e.m_normals[I]);var P=2*U.polygonRadius;t.pointCount=0,it.type=$,it.index=p?0:1,it.separation=1/0;for(I=0;I<et.count;++I){(V=K.dot(S,K.sub(et.vertices[I],a)))<it.separation&&(it.separation=V)}if(it.type!=Q&&!(it.separation>P)){ot.type=Q,ot.index=-1,ot.separation=-1/0;var T=K.neo(-S.y,S.x);for(I=0;I<et.count;++I){var V,z=K.neg(et.normals[I]),L=K.dot(z,K.sub(et.vertices[I],a)),F=K.dot(z,K.sub(et.vertices[I],h));if(P<(V=H.min(L,F))){ot.type=tt,ot.index=I,ot.separation=V;break}if(0<=K.dot(z,T)){if(K.dot(K.sub(z,M),S)<-U.angularSlop)continue}else if(K.dot(K.sub(z,C),S)<-U.angularSlop)continue;V>ot.separation&&(ot.type=tt,ot.index=I,ot.separation=V)}if(!(ot.type!=Q&&ot.separation>P)){var q;q=ot.type==Q?it:ot.separation>.98*it.separation+.001?ot:it;var k=[new X.clipVertex,new X.clipVertex];if(q.type==$){t.type=X.e_faceA;var R=0,D=K.dot(S,et.normals[0]);for(I=1;I<et.count;++I){var j=K.dot(S,et.normals[I]);j<D&&(D=j,R=I)}var J=R,E=J+1<et.count?J+1:0;k[0].v=et.vertices[J],k[0].id.cf.indexA=0,k[0].id.cf.indexB=J,k[0].id.cf.typeA=X.e_face,k[0].id.cf.typeB=X.e_vertex,k[1].v=et.vertices[E],k[1].id.cf.indexA=0,k[1].id.cf.indexB=E,k[1].id.cf.typeA=X.e_face,k[1].id.cf.typeB=X.e_vertex,p?(st.i1=0,st.i2=1,st.v1=a,st.v2=h,st.normal.set(y)):(st.i1=1,st.i2=0,st.v1=h,st.v2=a,st.normal.wSet(-1,y))}else t.type=X.e_faceB,k[0].v=a,k[0].id.cf.indexA=0,k[0].id.cf.indexB=q.index,k[0].id.cf.typeA=X.e_vertex,k[0].id.cf.typeB=X.e_face,k[1].v=h,k[1].id.cf.indexA=0,k[1].id.cf.indexB=q.index,k[1].id.cf.typeA=X.e_vertex,k[1].id.cf.typeB=X.e_face,st.i1=q.index,st.i2=st.i1+1<et.count?st.i1+1:0,st.v1=et.vertices[st.i1],st.v2=et.vertices[st.i2],st.normal.set(et.normals[st.i1]);st.sideNormal1.set(st.normal.y,-st.normal.x),st.sideNormal2.wSet(-1,st.sideNormal1),st.sideOffset1=K.dot(st.sideNormal1,st.v1),st.sideOffset2=K.dot(st.sideNormal2,st.v2);var O=[new X.clipVertex,new X.clipVertex],N=[new X.clipVertex,new X.clipVertex];if(!(X.clipSegmentToLine(O,k,st.sideNormal1,st.sideOffset1,st.i1)<U.maxManifoldPoints||X.clipSegmentToLine(N,O,st.sideNormal2,st.sideOffset2,st.i2)<U.maxManifoldPoints)){q.type==$?(t.localNormal=K.clone(st.normal),t.localPoint=K.clone(st.v1)):(t.localNormal=K.clone(e.m_normals[st.i1]),t.localPoint=K.clone(e.m_vertices[st.i1]));var Y=0;for(I=0;I<U.maxManifoldPoints;++I){if(K.dot(st.normal,K.sub(N[I].v,st.v1))<=P){var W=t.points[Y];q.type==$?(W.localPoint=Z.mulT(n,N[I].v),W.id=N[I].id):(W.localPoint=N[I].v,W.id.cf.typeA=N[I].id.cf.typeB,W.id.cf.typeB=N[I].id.cf.typeA,W.id.cf.indexA=N[I].id.cf.indexB,W.id.cf.indexB=N[I].id.cf.indexA),++Y}}t.pointCount=Y}}}}},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"./ChainShape":39,"./EdgeShape":46,"./PolygonShape":47}],45:[function(t,i,o){var E=!1,O=t("../util/common"),N=(t("../common/Math"),t("../common/Transform")),Y=t("../common/Rot"),W=t("../common/Vec2"),H=(t("../collision/AABB"),t("../Settings")),Z=t("../Manifold"),e=t("../Contact"),m=(t("../Shape"),t("./PolygonShape"));function K(t,i,o,e){for(var s=t.m_count,n=o.m_count,r=t.m_normals,m=t.m_vertices,a=o.m_vertices,h=N.mulT(e,i),c=0,_=-1/0,l=0;l<s;++l){for(var u=Y.mul(h.q,r[l]),p=N.mul(h,m[l]),y=1/0,d=0;d<n;++d){var v=W.dot(u,a[d])-W.dot(u,p);v<y&&(y=v)}_<y&&(_=y,c=l)}K._maxSeparation=_,K._bestIndex=c}function a(t,i,o,e,s){t.pointCount=0;var n=i.m_radius+e.m_radius;K(i,o,e,s);var r=K._bestIndex,m=K._maxSeparation;if(!(n<m)){K(e,s,i,o);var a=K._bestIndex,h=K._maxSeparation;if(!(n<h)){var c,_,l,u,p,y;m+.1*H.linearSlop<h?(c=e,_=i,l=s,u=o,p=a,t.type=Z.e_faceB,y=1):(c=i,_=e,l=o,u=s,p=r,t.type=Z.e_faceA,y=0);var d=[new Z.clipVertex,new Z.clipVertex];!function(t,i,o,e,s,n){var r=i.m_normals,m=s.m_count,a=s.m_vertices,h=s.m_normals;E&&O.assert(0<=e&&e<i.m_count);for(var c=Y.mulT(n.q,Y.mul(o.q,r[e])),_=0,l=1/0,u=0;u<m;++u){var p=W.dot(c,h[u]);p<l&&(l=p,_=u)}var y=_,d=y+1<m?y+1:0;t[0].v=N.mul(n,a[y]),t[0].id.cf.indexA=e,t[0].id.cf.indexB=y,t[0].id.cf.typeA=Z.e_face,t[0].id.cf.typeB=Z.e_vertex,t[1].v=N.mul(n,a[d]),t[1].id.cf.indexA=e,t[1].id.cf.indexB=d,t[1].id.cf.typeA=Z.e_face,t[1].id.cf.typeB=Z.e_vertex}(d,c,l,p,_,u);var v=c.m_count,f=c.m_vertices,x=p,A=p+1<v?p+1:0,g=f[x],b=f[A],B=W.sub(b,g);B.normalize();var w=W.cross(B,1),S=W.wAdd(.5,g,.5,b),C=Y.mul(l.q,B),M=W.cross(C,1);g=N.mul(l,g),b=N.mul(l,b);var I=W.dot(M,g),P=-W.dot(C,g)+n,T=W.dot(C,b)+n,V=[new Z.clipVertex,new Z.clipVertex],z=[new Z.clipVertex,new Z.clipVertex];if(!(Z.clipSegmentToLine(V,d,W.neg(C),P,x)<2||Z.clipSegmentToLine(z,V,C,T,A)<2)){t.localNormal=w,t.localPoint=S;for(var L=0,F=0;F<z.length;++F){if(W.dot(M,z[F].v)-I<=n){var q=t.points[L];if(q.localPoint.set(N.mulT(u,z[F].v)),q.id=z[F].id,y){var k=q.id.cf,R=k.indexA,D=k.indexB,j=k.typeA,J=k.typeB;k.indexA=D,k.indexB=R,k.typeA=J,k.typeB=j}++L}}t.pointCount=L}}}}i.exports=a,e.addType(m.TYPE,m.TYPE,function(t,i,o,e,s,n,r){E&&O.assert(o.getType()==m.TYPE),E&&O.assert(n.getType()==m.TYPE),a(t,o.getShape(),i,n.getShape(),s)})},{"../Contact":3,"../Manifold":6,"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"./PolygonShape":47}],46:[function(t,i,o){i.exports=m;var e=t("../util/create"),s=(t("../util/options"),t("../Settings")),n=t("../Shape"),r=(t("../common/Math"),t("../common/Transform")),f=t("../common/Rot"),x=t("../common/Vec2");t("../collision/AABB");function m(t,i){if(!(this instanceof m))return new m(t,i);m._super.call(this),this.m_type=m.TYPE,this.m_radius=s.polygonRadius,this.m_vertex1=t?x.clone(t):x.zero(),this.m_vertex2=i?x.clone(i):x.zero(),this.m_vertex0=x.zero(),this.m_vertex3=x.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}m.prototype=e((m._super=n).prototype),m.TYPE="edge",m.prototype.setNext=function(t){return t?(this.m_vertex3.set(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},m.prototype.setPrev=function(t){return t?(this.m_vertex0.set(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},m.prototype._set=function(t,i){return this.m_vertex1.set(t),this.m_vertex2.set(i),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},m.prototype._clone=function(){var t=new m;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.set(this.m_vertex1),t.m_vertex2.set(this.m_vertex2),t.m_vertex0.set(this.m_vertex0),t.m_vertex3.set(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},m.prototype.getChildCount=function(){return 1},m.prototype.testPoint=function(t,i){return!1},m.prototype.rayCast=function(t,i,o,e){var s=f.mulT(o.q,x.sub(i.p1,o.p)),n=f.mulT(o.q,x.sub(i.p2,o.p)),r=x.sub(n,s),m=this.m_vertex1,a=this.m_vertex2,h=x.sub(a,m),c=x.neo(h.y,-h.x);c.normalize();var _=x.dot(c,x.sub(m,s)),l=x.dot(c,r);if(0==l)return!1;var u=_/l;if(u<0||i.maxFraction<u)return!1;var p=x.add(s,x.mul(u,r)),y=x.sub(a,m),d=x.dot(y,y);if(0==d)return!1;var v=x.dot(x.sub(p,m),y)/d;return!(v<0||1<v)&&(t.fraction=u,t.normal=0<_?f.mul(o.q,c).neg():f.mul(o.q,c),!0)},m.prototype.computeAABB=function(t,i,o){var e=r.mul(i,this.m_vertex1),s=r.mul(i,this.m_vertex2);t.combinePoints(e,s),t.extend(this.m_radius)},m.prototype.computeMass=function(t,i){t.mass=0,t.center.wSet(.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},m.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_vertex1),t.m_vertices.push(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/create":51,"../util/options":52}],47:[function(t,i,o){i.exports=n;t("../util/common");var e=t("../util/create"),A=(t("../util/options"),t("../common/Math")),h=t("../common/Transform"),u=t("../common/Rot"),g=t("../common/Vec2"),b=(t("../collision/AABB"),t("../Settings")),s=t("../Shape");function n(t){if(!(this instanceof n))return new n(t);n._super.call(this),this.m_type=n.TYPE,this.m_radius=b.polygonRadius,this.m_centroid=g.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,t&&t.length&&this._set(t)}n.prototype=e((n._super=s).prototype),n.TYPE="polygon",n.prototype.getVertex=function(t){return this.m_vertices[t]},n.prototype._clone=function(){var t=new n;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.set(this.m_centroid);for(var i=0;i<this.m_count;i++)t.m_vertices.push(this.m_vertices[i].clone());for(i=0;i<this.m_normals.length;i++)t.m_normals.push(this.m_normals[i].clone());return t},n.prototype.getChildCount=function(){return 1},n.prototype._set=function(t){if(t.length<3)this._setAsBox(1,1);else{for(var i=A.min(t.length,b.maxPolygonVertices),o=[],e=0,s=0;s<i;++s){for(var n=t[s],r=!0,m=0;m<e;++m)if(g.distanceSquared(n,o[m])<.25*b.linearSlopSquared){r=!1;break}r&&(o[e++]=n)}if((i=e)<3)this._setAsBox(1,1);else{var a=0,h=o[0].x;for(s=1;s<i;++s){var c=o[s].x;(h<c||c==h&&o[s].y<o[a].y)&&(a=s,h=c)}for(var _=[],l=0,u=a;;){_[l]=u;var p=0;for(m=1;m<i;++m)if(p!=u){var y=g.sub(o[p],o[_[l]]),d=(n=g.sub(o[m],o[_[l]]),g.cross(y,n));d<0&&(p=m),0==d&&n.lengthSquared()>y.lengthSquared()&&(p=m)}else p=m;if(++l,(u=p)==a)break}if(l<3)this._setAsBox(1,1);else{this.m_count=l;for(s=0;s<l;++s)this.m_vertices[s]=o[_[s]];for(s=0;s<l;++s){var v=s,f=s+1<l?s+1:0,x=g.sub(this.m_vertices[f],this.m_vertices[v]);this.m_normals[s]=g.cross(x,1),this.m_normals[s].normalize()}this.m_centroid=function(t,i){for(var o=g.zero(),e=0,s=g.zero(),n=0;n<i;++n){var r=s,m=t[n],a=n+1<i?t[n+1]:t[0],h=g.sub(m,r),c=g.sub(a,r),_=.5*g.cross(h,c);e+=_,o.wAdd(_*(1/3),r),o.wAdd(_*(1/3),m),o.wAdd(_*(1/3),a)}return o.mul(1/e),o}(this.m_vertices,l)}}}},n.prototype._setAsBox=function(t,i,o,e){if(this.m_vertices[0]=g.neo(-t,-i),this.m_vertices[1]=g.neo(t,-i),this.m_vertices[2]=g.neo(t,i),this.m_vertices[3]=g.neo(-t,i),this.m_normals[0]=g.neo(0,-1),this.m_normals[1]=g.neo(1,0),this.m_normals[2]=g.neo(0,1),this.m_normals[3]=g.neo(-1,0),this.m_count=4,g.isValid(o)){e=e||0,this.m_centroid.set(o);var s=h.identity();s.p.set(o),s.q.set(e);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=h.mul(s,this.m_vertices[n]),this.m_normals[n]=u.mul(s.q,this.m_normals[n])}},n.prototype.testPoint=function(t,i){for(var o=u.mulT(t.q,g.sub(i,t.p)),e=0;e<this.m_count;++e){if(0<g.dot(this.m_normals[e],g.sub(o,this.m_vertices[e])))return!1}return!0},n.prototype.rayCast=function(t,i,o,e){for(var s=u.mulT(o.q,g.sub(i.p1,o.p)),n=u.mulT(o.q,g.sub(i.p2,o.p)),r=g.sub(n,s),m=0,a=i.maxFraction,h=-1,c=0;c<this.m_count;++c){var _=g.dot(this.m_normals[c],g.sub(this.m_vertices[c],s)),l=g.dot(this.m_normals[c],r);if(0==l){if(_<0)return!1}else l<0&&_<m*l?(m=_/l,h=c):0<l&&_<a*l&&(a=_/l);if(a<m)return!1}return 0<=h&&(t.fraction=m,t.normal=u.mul(o.q,this.m_normals[h]),!0)},n.prototype.computeAABB=function(t,i,o){for(var e=1/0,s=1/0,n=-1/0,r=-1/0,m=0;m<this.m_count;++m){var a=h.mul(i,this.m_vertices[m]);e=A.min(e,a.x),n=A.max(n,a.x),s=A.min(s,a.y),r=A.max(r,a.y)}t.lowerBound.set(e,s),t.upperBound.set(n,r),t.extend(this.m_radius)},n.prototype.computeMass=function(t,i){for(var o=g.zero(),e=0,s=0,n=g.zero(),r=0;r<this.m_count;++r)n.add(this.m_vertices[r]);n.mul(1/this.m_count);for(r=0;r<this.m_count;++r){var m=g.sub(this.m_vertices[r],n),a=r+1<this.m_count?g.sub(this.m_vertices[r+1],n):g.sub(this.m_vertices[0],n),h=g.cross(m,a),c=.5*h;e+=c,o.wAdd(c*(1/3),m,c*(1/3),a);var _=m.x,l=m.y,u=a.x,p=a.y;s+=1/3*.25*h*(_*_+u*_+u*u+(l*l+p*l+p*p))}t.mass=i*e,o.mul(1/e),t.center.wSet(1,o,1,n),t.I=i*s,t.I+=t.mass*(g.dot(t.center,t.center)-g.dot(o,o))},n.prototype.validate=function(){for(var t=0;t<this.m_count;++t)for(var i=t,o=t<this.m_count-1?i+1:0,e=this.m_vertices[i],s=g.sub(this.m_vertices[o],e),n=0;n<this.m_count;++n)if(n!=i&&n!=o){var r=g.sub(this.m_vertices[n],e);if(g.cross(s,r)<0)return!1}return!0},n.prototype.computeDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{"../Settings":7,"../Shape":8,"../collision/AABB":11,"../common/Math":18,"../common/Rot":20,"../common/Transform":22,"../common/Vec2":23,"../util/common":50,"../util/create":51,"../util/options":52}],48:[function(t,i,o){i.exports=function(t){var i=[],o=t.max||1/0,e=t.create,s=t.allocate,n=t.release,r=t.discard,m=0,a=0,h=0,c=0;this.max=function(t){return"number"==typeof t?(o=t,this):o},this.size=function(){return i.length},this.allocate=function(){var t;return 0<i.length?t=i.shift():(m++,t="function"==typeof e?e():{}),a++,"function"==typeof s&&s(t),t},this.release=function(t){i.length<o?(h++,"function"==typeof n&&n(t),i.push(t)):(c++,"function"==typeof r&&(t=r(t)))},this.toString=function(){return" +"+m+" >"+a+" <"+h+" -"+c+" ="+i.length+"/"+o}}},{}],49:[function(t,i,o){i.exports.now=function(){return Date.now()},i.exports.diff=function(t){return Date.now()-t}},{}],50:[function(t,i,o){o.debug=function(){},o.assert=function(t,i,o){}},{}],51:[function(t,i,o){if("function"==typeof Object.create)i.exports=function(t,i){return Object.create.call(Object,t,i)};else{function e(){}i.exports=function(t,i){if(i)throw Error("Second argument is not supported!");if("object"!=typeof t||null===t)throw Error("Invalid prototype!");return e.prototype=t,new e}}},{}],52:[function(t,i,o){Object.prototype.propertyIsEnumerable;i.exports=function(t,i){for(var o in null==t&&(t={}),i)i.hasOwnProperty(o)&&void 0===t[o]&&(t[o]=i[o]);if("function"==typeof Object.getOwnPropertySymbols)for(var e=Object.getOwnPropertySymbols(i),s=0;s<e.length;s++){var n=e[s];i.propertyIsEnumerable(n)&&void 0===t[o]&&(t[n]=i[n])}return t}},{}]},{},[1])(1)});